<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="G9EWiZRZAkmLhkNRG7gEmOIhxaUUbPULBVwc7R8ik2Y">
  <meta name="msvalidate.01" content="826E9F7DFD792263CCD9EEA67320505D">
  <meta name="baidu-site-verification" content="code-qyVo5emTxH">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.iclouds.work","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="本文主要介绍客户端在使用 Kerberos 的时候如何连接 Kerberos 集群，使用 Kerberos 安全认证。其中包含 Windows 客户端， Linux 客户端安装使用记录。">
<meta property="og:type" content="article">
<meta property="og:title" content="连接 Kerberos 集群指南">
<meta property="og:url" content="http://blog.iclouds.work/2019/05/06/operations/%E8%BF%9E%E6%8E%A5%20Kerberos%20%E9%9B%86%E7%BE%A4%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="Myblog">
<meta property="og:description" content="本文主要介绍客户端在使用 Kerberos 的时候如何连接 Kerberos 集群，使用 Kerberos 安全认证。其中包含 Windows 客户端， Linux 客户端安装使用记录。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/w%3D268%3Bg%3D0/sign=9213b35de9f81a4c2632ebcfef110764/a5c27d1ed21b0ef485f59977dfc451da81cb3efd.jpg">
<meta property="og:image" content="http://qiniu.iclouds.work/Fmaqh-qBfq-rXFuXcSUNxplf9Ibu.png">
<meta property="og:image" content="http://qiniu.iclouds.work/Fkxqfdj7TUx0InXKX3w6QkbNawBp.png">
<meta property="og:image" content="http://qiniu.iclouds.work/FldFbui6VkQsUeIxVUS9zBIpFXKd.png">
<meta property="og:image" content="http://qiniu.iclouds.work/Fhof90F5SjgN4s9uGD-JU9-52gdx.png">
<meta property="og:image" content="http://qiniu.iclouds.work/FtiywmQmIg8ILbI9UX6kr9VWZePz.png">
<meta property="og:image" content="http://qiniu.iclouds.work/FukOO6s6wCNDX5vE-BuJwWmTcQvF.png">
<meta property="og:image" content="http://qiniu.iclouds.work/FhCrKMifE6Nj6ZlQGMqlcRtVKZ1C.png">
<meta property="article:published_time" content="2019-05-06T04:30:00.000Z">
<meta property="article:modified_time" content="2020-05-28T03:50:00.000Z">
<meta property="article:author" content="huagang">
<meta property="article:tag" content="Kerberos">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/w%3D268%3Bg%3D0/sign=9213b35de9f81a4c2632ebcfef110764/a5c27d1ed21b0ef485f59977dfc451da81cb3efd.jpg">


<link rel="canonical" href="http://blog.iclouds.work/2019/05/06/operations/%E8%BF%9E%E6%8E%A5%20Kerberos%20%E9%9B%86%E7%BE%A4%E6%8C%87%E5%8D%97/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.iclouds.work/2019/05/06/operations/%E8%BF%9E%E6%8E%A5%20Kerberos%20%E9%9B%86%E7%BE%A4%E6%8C%87%E5%8D%97/","path":"2019/05/06/operations/连接 Kerberos 集群指南/","title":"连接 Kerberos 集群指南"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>连接 Kerberos 集群指南 | Myblog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-200000008-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-200000008-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?c6fe2c57d92758c7a980d22eca71fd6a"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Myblog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hello World !</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Kerberos-%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">1. Kerberos 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Kerberos-Client-%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">2. Kerberos Client 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Ubuntu"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 Ubuntu</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Centos"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 Centos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Windows"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 Windows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-JVM"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 JVM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE-Kerberos-%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.</span> <span class="nav-text">3. 浏览器访问 Kerberos 服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Internet-Explorer"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 Internet Explorer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Firefox"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 Firefox</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Linux"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 Linux</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-Windows"><span class="nav-number">3.2.2.</span> <span class="nav-text">3.2.3 Windows</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-Chrome"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 Chrome</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-Linux"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 Linux</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-1-1-Chrome-%E7%AD%96%E7%95%A5%E7%BB%84%E5%90%AF%E7%94%A8%E7%99%BD%E5%90%8D%E5%8D%95"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">3.3.1.1 Chrome 策略组启用白名单</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-1-2-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E5%90%AF%E5%8A%A8"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">3.3.1.2 使用命令行参数启动</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2Windows"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.3.2Windows</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">huagang</p>
  <div class="site-description" itemprop="description">I Love You !</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/whg517" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;whg517" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/huagang517@126.com" title="E-Mail → huagang517@126.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/whg517" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.iclouds.work/2019/05/06/operations/%E8%BF%9E%E6%8E%A5%20Kerberos%20%E9%9B%86%E7%BE%A4%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="huagang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Myblog">
      <meta itemprop="description" content="I Love You !">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="连接 Kerberos 集群指南 | Myblog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          连接 Kerberos 集群指南
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-06 12:30:00" itemprop="dateCreated datePublished" datetime="2019-05-06T12:30:00+08:00">2019-05-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-05-28 11:50:00" itemprop="dateModified" datetime="2020-05-28T11:50:00+08:00">2020-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>本文主要介绍客户端在使用 Kerberos 的时候如何连接 Kerberos 集群，使用 Kerberos 安全认证。其中包含 Windows 客户端， Linux 客户端安装使用记录。</p>
<span id="more"></span>
<h2 id="1-Kerberos-介绍">1. Kerberos 介绍</h2>
<p>Kerberos 简介</p>
<p><img src="https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/w%3D268%3Bg%3D0/sign=9213b35de9f81a4c2632ebcfef110764/a5c27d1ed21b0ef485f59977dfc451da81cb3efd.jpg" alt="kerberos_pic"></p>
<p><strong>Kerberos</strong>是一种计算机网络授权协议，用来在非安全网络中，对个人通信以安全的手段进行身份认证。这个词又指<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%BA%BB%E7%9C%81%E7%90%86%E5%B7%A5%E5%AD%A6%E9%99%A2">麻省理工学院</a>为这个协议开发的一套计算机软件。</p>
<p>先来看看Kerberos协议的前提条件：</p>
<p>如下图所示，Client与KDC， KDC与Service 在协议工作前已经有了各自的共享密钥，并且由于协议中的消息无法穿透防火墙，这些条件就限制了Kerberos协议往往用于一个组织的内部。</p>
<p><img src="http://qiniu.iclouds.work/Fmaqh-qBfq-rXFuXcSUNxplf9Ibu.png" alt="kerberos"></p>
<p><strong>过程：</strong></p>
<p>Kerberos协议分为两个部分：</p>
<ol>
<li>
<p>Client向KDC发送自己的身份信息，KDC从Ticket Granting Service得到TGT(ticket-granting ticket)， 并用协议开始前Client与KDC之间的密钥将TGT加密回复给Client。</p>
<p>此时只有真正的Client才能利用它与KDC之间的密钥将加密后的TGT解密，从而获得TGT。</p>
<p>（此过程避免了Client直接向KDC发送密码，以求通过验证的不安全方式）</p>
</li>
<li>
<p>Client利用之前获得的TGT向KDC请求其他Service的Ticket，从而通过其他Service的身份鉴别。</p>
<p>Kerberos协议的重点在于第二部分，简介如下：</p>
<p><img src="http://qiniu.iclouds.work/Fkxqfdj7TUx0InXKX3w6QkbNawBp.png" alt="kerberos"></p>
<ul>
<li>Client将之前获得TGT和要请求的服务信息(服务名等)发送给KDC，KDC中的Ticket Granting Service将为Client和Service之间生成一个Session Key用于Service对Client的身份鉴别。<br>
然后KDC将这个Session Key和用户名，用户地址（IP），服务名，有效期, 时间戳一起包装成一个Ticket(这些信息最终用于Service对Client的身份鉴别)发送给Service， 不过Kerberos协议并没有直接将Ticket发送给Service，而是通过Client转发给Service.所以有了第二步。</li>
<li>此时KDC将刚才的Ticket转发给Client。由于这个Ticket是要给Service的，不能让Client看到，所以KDC用协议开始前KDC与Service之间的密钥将Ticket加密后再发送给Client。<br>
同时为了让Client和Service之间共享那个秘密(KDC在第一步为它们创建的Session Key)， KDC用Client与它之间的密钥将Session Key加密随加密的Ticket一起返回给Client。</li>
<li>为了完成Ticket的传递，Client将刚才收到的Ticket转发到Service. 由于Client不知道KDC与Service之间的密钥，所以它无法算改Ticket中的信息。同时Client将收到的Session Key解密出来，<br>
然后将自己的用户名，用户地址（IP）打包成Authenticator用Session Key加密也发送给Service。</li>
<li>Service 收到Ticket后利用它与KDC之间的密钥将Ticket中的信息解密出来，从而获得Session Key和用户名，用户地址（IP），服务名，有效期。然后再用Session Key将Authenticator解密从而获得用户名，<br>
用户地址（IP）将其与之前Ticket中解密出来的用户名，用户地址（IP）做比较从而验证Client的身份。</li>
<li>如果Service有返回结果，将其返回给Client。</li>
</ul>
</li>
</ol>
<h2 id="2-Kerberos-Client-配置">2. Kerberos Client 配置</h2>
<h3 id="2-1-Ubuntu">2.1 Ubuntu</h3>
<p>准备</p>
<p>同步时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone <span class="string">&quot;Asia/Shanghai&quot;</span> <span class="comment"># 设置系统时区</span></span><br><span class="line">timedatectl set-ntp <span class="literal">true</span> <span class="comment"># 联网自动同步到 NTP 时间服务器</span></span><br></pre></td></tr></table></figure>
<p>根据 <a target="_blank" rel="noopener" href="https://help.ubuntu.com/lts/serverguide/kerberos.html.en">Ubuntu 官方文档</a> <strong>Kerberos Linux Client</strong> 一节操作</p>
<ol>
<li>
<p>安装</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install krb5-user</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改配置</p>
<p>修改 <code>/etc/krb5.conf</code> ，配置如下</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[libdefaults]</span></span><br><span class="line">  <span class="attr">renew_lifetime</span> = <span class="number">7</span>d</span><br><span class="line">  <span class="attr">forwardable</span> = <span class="literal">true</span></span><br><span class="line">  <span class="attr">default_realm</span> = TENDATA.CN</span><br><span class="line">  <span class="attr">ticket_lifetime</span> = <span class="number">24</span>h</span><br><span class="line">  <span class="attr">dns_lookup_realm</span> = <span class="literal">false</span></span><br><span class="line">  <span class="attr">dns_lookup_kdc</span> = <span class="literal">false</span></span><br><span class="line">  <span class="attr">default_ccache_name</span> = /tmp/krb5cc_%&#123;uid&#125;</span><br><span class="line">  <span class="comment">#default_tgs_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5</span></span><br><span class="line">  <span class="comment">#default_tkt_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5</span></span><br><span class="line"></span><br><span class="line"><span class="section">[logging]</span></span><br><span class="line">  <span class="attr">default</span> = FILE:/var/log/krb5kdc.log</span><br><span class="line">  <span class="attr">admin_server</span> = FILE:/var/log/kadmind.log</span><br><span class="line">  <span class="attr">kdc</span> = FILE:/var/log/krb5kdc.log</span><br><span class="line"></span><br><span class="line"><span class="section">[realms]</span></span><br><span class="line">  <span class="attr">TENDATA.CN</span> = &#123;</span><br><span class="line">    <span class="attr">admin_server</span> = m1.node.hadoop</span><br><span class="line">    <span class="attr">kdc</span> = <span class="number">192.168</span>.<span class="number">10.1</span></span><br><span class="line">    <span class="attr">kdc</span> = <span class="number">192.168</span>.<span class="number">10.2</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置域名解析</p>
<p>修改 hosts 文件，增加如下解析记录。</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">192.168.10.1  m1.node.hadoop</span><br><span class="line">192.168.10.2  m2.node.hadoop</span><br><span class="line">192.168.10.3  m3.node.hadoop</span><br><span class="line"></span><br><span class="line">192.168.10.10 d1.node.hadoop</span><br><span class="line">192.168.10.11 d2.node.hadoop</span><br><span class="line">192.168.10.12 d3.node.hadoop</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用 Kerberos Client</p>
<p>使用 <code>kinit</code> 获取 tgt</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kevin@ubuntu-kevin:~$ kinit whg</span><br><span class="line">Password for whg@TENDATA.CN:</span><br><span class="line"></span><br><span class="line">kevin@ubuntu-kevin:~$ klist</span><br><span class="line">Ticket cache: FILE:/tmp/krb5cc_1000</span><br><span class="line">Default principal: whg@TENDATA.CN</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">2019-05-06T09:45:56  2019-05-07T09:45:55  krbtgt/TENDATA.CN@TENDATA.CN</span><br></pre></td></tr></table></figure>
<p>使用 <code>kdestroy</code> 销毁 tgt</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kevin@ubuntu-kevin:~$ kdestroy</span><br><span class="line"></span><br><span class="line">kevin@ubuntu-kevin:~$ klist</span><br><span class="line">klist: No credentials cache found (filename: /tmp/krb5cc_1000)</span><br></pre></td></tr></table></figure>
<p>命令使用参数和其他命令请阅读 <a target="_blank" rel="noopener" href="https://web.mit.edu/kerberos/krb5-latest/doc/user/user_commands/index.html">Kerberos 用户命令</a></p>
</li>
<li>
<p>访问相关服务</p>
<p>使用 <code>curl</code> 访问 Kerberos 认证的页面。</p>
<p>正常访问不会出现 <code>Error 401 Authentication required</code> 。</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">kevin@ubuntu-kevin:~$ curl -k --negotiate -u: -H &quot;Content-Type: application/json&quot; -X GET http://m1.node.hadoop:50070/</span><br><span class="line">&lt;!--</span><br><span class="line">  Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="line">  contributor license agreements.  See the NOTICE file distributed with</span><br><span class="line">  this work for additional information regarding copyright ownership.</span><br><span class="line">  The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="line">  (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="line">  the License.  You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">  Unless required by applicable law or agreed to in writing, software</span><br><span class="line">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line">  See the License for the specific language governing permissions and</span><br><span class="line">  limitations under the License.</span><br><span class="line">--&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span><br><span class="line">    &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;REFRESH&quot; content=&quot;0;url=dfshealth.html&quot; /&gt;</span><br><span class="line">&lt;title&gt;Hadoop Administration&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>或者访问 <code>curl -L -k --negotiate -u: -H &quot;Content-Type: application/json&quot; -X GET http://m1.node.hadoop:50070/webhdfs/v1/?op=LISTSTATUS</code> 正常出现 HDFS 文件列表(JSON 格式数据)，没有 401 错误即代表正常访问</p>
</li>
</ol>
<p><strong>Error 401 Authentication required：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html;charset=utf-8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Error 401 Authentication required<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span>HTTP ERROR 401<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Problem accessing /webhdfs/v1/. Reason:</span><br><span class="line"><span class="tag">&lt;<span class="name">pre</span>&gt;</span>    Authentication required<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-Centos">2.2 Centos</h3>
<p>准备</p>
<p>同步时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone <span class="string">&quot;Asia/Shanghai&quot;</span> <span class="comment"># 设置系统时区</span></span><br><span class="line">timedatectl set-ntp <span class="literal">true</span> <span class="comment"># 联网自动同步到 NTP 时间服务器</span></span><br></pre></td></tr></table></figure>
<ol>
<li>安装 Kerberos Client</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install krb5-workstation</span><br></pre></td></tr></table></figure>
<p>其余步骤和 Ubuntu 操作相同。</p>
<h3 id="2-3-Windows">2.3 Windows</h3>
<p>Windows 默认已经支持 Kerberos，但需要使用 加入 Active Directory ，以获取 tgt。在使用 openladp 的情况下需要配置 AD proxy，这种方式比较麻烦。MIT 提供 <a target="_blank" rel="noopener" href="https://web.mit.edu/kerberos/dist/index.html">Kerberos for Windows</a> 来更方便的使用 Kerberos 认证。</p>
<p>没有使用 Windows 默认 kerberos 支持，当有程序调用Windows 集成身份验证的时候也就会认证失败。例如 IE，Chrome 浏览器登陆 Kerberos 认证的网站时，会出现 <code>HTTP ERROR 403</code> 错误。</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.simba.com/products/Hive/doc/ODBC_InstallGuide/win/content/odbc/hi/kerberos.htm">Configuring Kerberos Authentication for Windows</a></p>
<p>注意：在选择 kfw 版本应该与后面安装浏览器版本一致，推荐安装 64-bit kfw，因为会向下兼容</p>
<ol>
<li>
<p>下载安装</p>
<p><a target="_blank" rel="noopener" href="https://web.mit.edu/kerberos/dist/index.html">Kerberos for Windows</a></p>
<p>安装时推荐选择 “Complete” 安装</p>
<p><img src="http://qiniu.iclouds.work/FldFbui6VkQsUeIxVUS9zBIpFXKd.png" alt="kerberos_for_windows_install"></p>
</li>
<li>
<p>配置</p>
<p>kfw 64位 默认安装在 <code>C:\Program Files\MIT\Kerberos</code> 下，当然这不是重点。 kfw 会加载 <code>C:\ProgramData\MIT\Kerberos5\krb5.ini</code> 的配置文件。</p>
<blockquote>
<p><code>ProgramData</code> 目录默认是隐藏的。</p>
</blockquote>
<p>修改该配置文件内容为：</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[libdefaults]</span></span><br><span class="line">  <span class="attr">renew_lifetime</span> = <span class="number">7</span>d</span><br><span class="line">  <span class="attr">forwardable</span> = <span class="literal">true</span></span><br><span class="line">  <span class="attr">default_realm</span> = TENDATA.CN</span><br><span class="line">  <span class="attr">ticket_lifetime</span> = <span class="number">24</span>h</span><br><span class="line">  <span class="attr">dns_lookup_realm</span> = <span class="literal">false</span></span><br><span class="line">  <span class="attr">dns_lookup_kdc</span> = <span class="literal">false</span></span><br><span class="line">  <span class="attr">default_ccache_name</span> = /tmp/krb5cc_%&#123;uid&#125;</span><br><span class="line">  <span class="comment">#default_tgs_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5</span></span><br><span class="line">  <span class="comment">#default_tkt_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5</span></span><br><span class="line"></span><br><span class="line"><span class="section">[logging]</span></span><br><span class="line">  <span class="attr">default</span> = FILE:/var/log/krb5kdc.log</span><br><span class="line">  <span class="attr">admin_server</span> = FILE:/var/log/kadmind.log</span><br><span class="line">  <span class="attr">kdc</span> = FILE:/var/log/krb5kdc.log</span><br><span class="line"></span><br><span class="line"><span class="section">[realms]</span></span><br><span class="line">  <span class="attr">TENDATA.CN</span> = &#123;</span><br><span class="line">    <span class="attr">admin_server</span> = m1.node.hadoop</span><br><span class="line">    <span class="attr">kdc</span> = <span class="number">192.168</span>.<span class="number">10.1</span></span><br><span class="line">    <span class="attr">kdc</span> = <span class="number">192.168</span>.<span class="number">10.2</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置系统属性：</p>
<p>打开 <code>控制面板</code> -&gt; 选择 <code>系统和安全</code> -&gt; 选择 <code>系统</code> -&gt; 选择 <code>高级系统设置</code> 打开 <code>系统属性</code> 面板 -&gt; 点击 <code>高级</code> 选项卡 -&gt; 打开环境变量</p>
<p>新建系统变量，变量名称为 <code>KRB5CCNAME</code> 变量值为 <code>C:\temp\krb5cache</code>  。前提时 <code>C:\temp\</code> 目录存在，<code>krb5cache</code> 不需要创建，在使用 <code>kinit</code> 命令的时候会自动生成该文件。</p>
<p>如果 <code>krb5.ini</code> 的配置文件不在默认目录可以使用变量名 <code>KRB5_CONFIG</code> 指定，变量值为该文件的绝对路径</p>
</li>
<li>
<p>使用</p>
<p>在 CMD 中使用 <code>kinit</code> 获取 tgt。</p>
<p>由于 Windows 支持 Kerberos ，所有部分命令默认时 Windows 的。比如 <code>klist</code> 。</p>
<p>修改环境变量，让 kfw 命令覆盖 Windows。</p>
<p>编辑 <code>Path</code> 环境变量，将 <code>kerberos</code> 变量上移至最上面即可。</p>
<p><img src="http://qiniu.iclouds.work/Fhof90F5SjgN4s9uGD-JU9-52gdx.png" alt="up_kerberos_bin"></p>
<p>在 CMD 中使用 <code>klist</code> 即可查看以获取的 tgt</p>
</li>
</ol>
<p><strong>注意：</strong></p>
<p>由于 Java 也实现了 kerberos client 认证机制，在 JDK 的 <code>bin</code> 目录提供了 <code>kinit</code> 、 <code>klist</code> 等相关命令，在配置Path 环境变量时，Kerberos 的优先级应该比 JDK 的要高。</p>
<p><strong>403</strong> 分析：</p>
<p>在没有安装 kfw 时，系统已经具有 <code>klist</code> 命令，该命令位于 <code>C:\WINDOWS\system32</code> 。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;klist</span><br><span class="line"></span><br><span class="line">当前登录 ID 是 0:0x73218</span><br><span class="line"></span><br><span class="line">缓存的票证: (0)</span><br><span class="line"></span><br><span class="line">C:\WINDOWS\system32&gt;klist sessions</span><br><span class="line"></span><br><span class="line">当前登录 ID 是 0:0x73218</span><br><span class="line">[0] 会话 0 0:0x136dc999 DESKTOP-5KM5T43\Administrator NTLM:Network</span><br><span class="line">[1] 会话 0 0:0x134bf7a2 DESKTOP-5KM5T43\Administrator NTLM:Network</span><br></pre></td></tr></table></figure>
<p>相关命令使用前查看 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/klist">klist</a></p>
<h3 id="2-4-JVM">2.4 JVM</h3>
<p>根据 <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/10/security/introduction-jaas-and-java-gss-api-tutorials1.htm#JSSEC-GUID-202DE2FD-E2CA-44D1-9391-50127913538E">Java Platform, Standard Edition Security Developer’s Guide</a><br>
描述，Java 为开发人员提供了 JAAS 和 Java GSS-API 来使用 Kerberos 认证。前者是直接认证，后者是使用调用底层认证。</p>
<p><strong>注意：</strong> 根据 JCE 描述，由于一些国家的进口管制限制，一些版本的 JDK 或者 JRE 允许强，但有限的加密策略。所以如果需要无限长度加密策略，<br>
需要下载 <code>Java Cryptography Extension (JCE)</code> 支持。详细描述请查看 JCE 压缩包中的 README.txt。而 Kerberos 的加密正式需要无限长度支持。<br>
下载地址为 <a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files 8 Download</a> 。<br>
下载后解压到 <code>JAVA_HOME\jre\lib\security</code> 即可。</p>
<ol>
<li>
<p>配置</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/10/security/kerberos-requirements1.htm#JSSEC-GUID-EAA2758B-3071-4CDA-AEF1-D76F5271E998">Kerberos Requirements</a> 中描述了<br>
JDK 是如何使用 Kerberos 的。它支持系统属性值，和 <code>krb5.conf</code> 配置文件读取。为了便于使用，下面仅配置使用 <code>krb5.conf</code></p>
<p><strong>注意：</strong> 系统属性值比配置有更高的优先级！</p>
<p>JDK 查找配置文件的算法如下：</p>
<ul>
<li>
<p>系统属性 ``java.security.krb5.conf` 指定文件位置</p>
</li>
<li>
<p>查找配置文件位置 (java-home 为 JDK 安装目录)</p>
<ul>
<li><code>&lt;java-home&gt;\conf\security</code> (Windows)</li>
<li><code>&lt;java-home&gt;/conf/security</code>  (Solaris, Linux, and macOS)</li>
</ul>
</li>
<li>
<p>如果上述没有找到，则查找如下位置：</p>
<ul>
<li>
<p><code>/etc/krb5/krb5.conf</code> (Solaris)</p>
</li>
<li>
<p><code>C:\Windows\krb5.ini</code> (Windows)</p>
</li>
<li>
<p><code>/etc/krb5.conf</code> (Linux)</p>
</li>
<li>
<p><code>~/Library/Preferences/edu.mit.Kerberos</code>, <code>/Library/Preferences/edu.mit.Kerberos</code>, or <code>/etc/krb5.conf</code> (macOS)</p>
</li>
</ul>
</li>
</ul>
<p>所以，在 Windows 中，应该把 <code>krb5.conf</code> 更名为 <code>krb5.ini</code> 放在 <code>C:\Windows\krb5.ini</code> 。</p>
</li>
<li>
<p>验证</p>
<p>在 CMD 下，进入到 <code>JAVA_HOME\bin\</code> 中，执行 <code>kinit</code> 和 <code>klist</code> 。关于命令的具体使用，请查看 <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/10/tools/security-tools-and-commands.htm#JSWOR691">Security Tools and Commands</a></p>
</li>
</ol>
<h2 id="3-浏览器访问-Kerberos-服务">3. 浏览器访问 Kerberos 服务</h2>
<p>参考文章 <a target="_blank" rel="noopener" href="https://ping.force.com/Support/PingFederate/Integrations/How-to-configure-supported-browsers-for-Kerberos-NTLM">How to configure supported browsers for Kerberos and NTLM</a></p>
<p>PingFederate Integrated Windows Authentication (IWA)适配器支持Kerberos和NTLM身份验证协议，但是需要配置一些浏览器来使用它们。</p>
<p>对于Kerberos和NTLM身份验证，PingFederate IWA适配器使用SPNEGO(Simple and Protected GSS-API Negotiation)机制协商Kerberos或NTLM作为底层身份验证协议。下面的每个浏览器都支持SPNEGO，但是由于浏览器和操作系统的结合，存在的差异可能会影响在每个实例中协商的协议。</p>
<p>The PingFederate IWA Adapter supports the following browsers:</p>
<ul>
<li>Internet Explorer</li>
<li>Mozilla Firefox</li>
<li>Google Chrome</li>
<li>Apple Safari</li>
</ul>
<h3 id="3-1-Internet-Explorer">3.1 Internet Explorer</h3>
<p>鉴于 Windows 原因，不进行配置。</p>
<h3 id="3-2-Firefox">3.2 Firefox</h3>
<blockquote>
<p>当前 Firefox 版本 64.0.2(64-bit)</p>
</blockquote>
<p>参考 <a target="_blank" rel="noopener" href="http://people.redhat.com/mikeb/negotiate/">Configuring Firefox for Negotiate Authentication</a> 、 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Integrated_authentication">Integrated Authentication</a></p>
<h4 id="3-2-1-Linux">3.2.1 Linux</h4>
<ol>
<li>
<p>在地址栏中键入about:config，点击 <code>I accept the risk !</code> ，进入配置页面</p>
<p><img src="http://qiniu.iclouds.work/FtiywmQmIg8ILbI9UX6kr9VWZePz.png" alt="firefox_config"></p>
</li>
<li>
<p>配置 SPNEGO authentication</p>
<p>配置 <code>network.negotiate-auth.trusted-uris</code> 为允许使用浏览器进行SPNEGO身份验证的站点， 支持统配。多个站点使用逗号隔开。</p>
<p><img src="http://qiniu.iclouds.work/FukOO6s6wCNDX5vE-BuJwWmTcQvF.png" alt="forefox_config_negotiate"></p>
<p>然后使用 <code>kinit</code> 获取认证 tgt 之后，打开 Chrome 访问服务页面。没有出现 401 即为正常。</p>
</li>
</ol>
<h4 id="3-2-3-Windows">3.2.3 Windows</h4>
<p>注意：Firefox 浏览器版本应与前面安装的 kfw 版本一致，否则会出现 401 。如果 kfw 为 64bit 则不用关注这一点。</p>
<p>和 Linux 相同，修改 Firefox 配置</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">network.negotiate-auth.trusted-uris</span><br><span class="line">network.auth.use-sspi</span><br></pre></td></tr></table></figure>
<p>然后使用 <code>kinit</code> 获取认证 tgt 之后，打开 Chrome 访问服务页面。没有出现 401 即为正常。</p>
<h3 id="3-3-Chrome">3.3 Chrome</h3>
<h4 id="3-3-1-Linux">3.3.1 Linux</h4>
<p>根据 <a target="_blank" rel="noopener" href="https://www.chromium.org/developers/design-documents/http-authentication">Chrome HTTP authentication</a> 中 <strong>Integrated Authentication</strong> 描述 Chrome 是支持 Kerberos 和 NTLM 认证的。默认不会启用，只有从代理接收身份验证协商或者在白名单的服务器协商时，才会启用继承身份验证。</p>
<h5 id="3-3-1-1-Chrome-策略组启用白名单">3.3.1.1 Chrome 策略组启用白名单</h5>
<p>添加白名单可以通过 <a target="_blank" rel="noopener" href="https://dev.chromium.org/administrators/policy-list-3#AuthServerWhitelist">AuthServerWhitelist</a> 策略设置。多个白名单用以逗号分隔。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://dev.chromium.org/administrators/linux-quick-start">Linux Quick Start</a></p>
<p>对于Chromium，策略配置文件位于/etc/chromium之下，对于谷歌Chrome，策略配置文件位于/etc/opt/chrome之下。在这些目录中保存着两组策略:一组是管理员需要并强制执行的，另一组是推荐给用户但不是必需的。这两组在:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/opt/chrome/policies/managed/</span><br><span class="line">/etc/opt/chrome/policies/recommended/</span><br></pre></td></tr></table></figure>
<p>如果这些目录不存在，请创建它们:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">mkdir</span> /etc/opt/chrome/policies</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">mkdir</span> /etc/opt/chrome/policies/managed</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">mkdir</span> /etc/opt/chrome/policies/recommended</span></span><br></pre></td></tr></table></figure>
<p>确保非管理员用户无法写入/托管下的文件;否则，他们可能只是覆盖您的策略来获得他们想要的配置!</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">chmod</span> -w /etc/opt/chrome/policies/managed</span></span><br></pre></td></tr></table></figure>
<p>要设置所需的策略，请在 <code>/etc/opt/chrome/policies/managed/</code> 下创建一个名为 <code>test_policy.json</code> 的文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">touch</span> /etc/opt/chrome/policies/managed/test_policy.json</span></span><br></pre></td></tr></table></figure>
<p>在这个文件中，放入以下内容:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;AuthServerWhitelist&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.node.hadoop&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>就是这样!下次在该机器上启动谷歌Chrome时，主页将被锁定到这个值。</p>
<p>在地址栏输入 <code>chrome:policy</code> 查看当前策略</p>
<p><img src="http://qiniu.iclouds.work/FhCrKMifE6Nj6ZlQGMqlcRtVKZ1C.png" alt="chrome_policy"></p>
<p>在使用 <code>kinit</code> 获取认证 tgt 之后，打开 Chrome 访问服务页面。没有出现 401 即为正常。</p>
<h5 id="3-3-1-2-使用命令行参数启动">3.3.1.2 使用命令行参数启动</h5>
<p>根据 <a target="_blank" rel="noopener" href="https://www.chromium.org/developers/how-tos/run-chromium-with-flags">Run Chromium with flags</a> 中描述，Chromium(和Chrome)支持接受命令行标志(或“开关”)，以便启用特定功能或修改默认功能。</p>
<p>当前可用参数可以查看 <a target="_blank" rel="noopener" href="https://peter.sh/experiments/chromium-command-line-switches/">List of Chromium Command Line Switches</a> 。<br>
可以使用 <a target="_blank" rel="noopener" href="https://peter.sh/experiments/chromium-command-line-switches/#auth-server-whitelist">–auth-server-whitelist</a> 参数启用白名单功能。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome --auth-server-whitelist=<span class="string">&quot;.node.hadoop&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-2Windows">3.3.2Windows</h4>
<p>由于 Chrome 自身不带有 Gssapi，而是调用操作系统类库，而且依赖于 <code>Internet 选项</code> 配置。因此不在配置。</p>
<p>具体内容请参考 <a target="_blank" rel="noopener" href="https://www.chromium.org/developers/design-documents/http-authentication">Chrome HTTP authentication</a> 中 <code>Negotiate external libraries</code> 部分</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Kerberos/" rel="tag"># Kerberos</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/01/01/programming/python/Python%20PEP8%20%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" rel="prev" title="Python PEP8 编码规范">
                  <i class="fa fa-chevron-left"></i> Python PEP8 编码规范
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/05/28/cloudnative/python_web_cloudnative/" rel="next" title="Python Web CloudNative [未完]">
                  Python Web CloudNative [未完] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">huagang</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://unpkg.com/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
