<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.iclouds.work","root":"/","images":"/images","scheme":"Mist","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="由于在使用 Openldap 苦于直接看以英文文档太麻烦，反正也是要阅读就边看边做笔记，于是有了次文档。记录内容呢也只是根据自己需要选择性翻译。文章内容直接由 google 翻译软件翻译，可能存在不通顺之处，还望大家多多指出。在 markdown 转换到 html 过程中可能有部分尖括号引用内容，导致丢失或者显示有误，请大家参照官方文档对比。">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenLDAP Software 2.4 Administrator&#39;s Guide">
<meta property="og:url" content="http://blog.iclouds.work/2017/11/20/documents/openldap_administrators_guide/index.html">
<meta property="og:site_name" content="Myblog">
<meta property="og:description" content="由于在使用 Openldap 苦于直接看以英文文档太麻烦，反正也是要阅读就边看边做笔记，于是有了次文档。记录内容呢也只是根据自己需要选择性翻译。文章内容直接由 google 翻译软件翻译，可能存在不通顺之处，还望大家多多指出。在 markdown 转换到 html 过程中可能有部分尖括号引用内容，导致丢失或者显示有误，请大家参照官方文档对比。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qiniu.iclouds.work/FmRtJjELzSWkM7K8VC21jahAN4SS.png">
<meta property="og:image" content="https://qiniu.iclouds.work/FoylQKTYLfguYkfrAUxV1bcWeofE.png">
<meta property="og:image" content="https://qiniu.iclouds.work/Fn9FyhrGdS01P9RVlzfAuSJLfmUH.png">
<meta property="og:image" content="https://qiniu.iclouds.work/FpRVHSwbdNwpOccDGg141q4ayWKR.png">
<meta property="article:published_time" content="2017-11-20T06:52:25.000Z">
<meta property="article:modified_time" content="2020-05-28T03:50:00.000Z">
<meta property="article:author" content="huagang">
<meta property="article:tag" content="openldap">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qiniu.iclouds.work/FmRtJjELzSWkM7K8VC21jahAN4SS.png">


<link rel="canonical" href="http://blog.iclouds.work/2017/11/20/documents/openldap_administrators_guide/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>OpenLDAP Software 2.4 Administrator's Guide | Myblog</title>
  

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c6fe2c57d92758c7a980d22eca71fd6a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Myblog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hello World !</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97"><span class="nav-number">1.</span> <span class="nav-text">2 快速入门指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E8%8E%B7%E5%8F%96%E8%BD%AF%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">2.1 获取软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%89%93%E5%BC%80%E5%88%86%E5%8F%91%E5%8C%85%E6%89%93%E5%BC%80"><span class="nav-number">1.2.</span> <span class="nav-text">2.2 打开分发包打开</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%AE%A1%E6%9F%A5%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.</span> <span class="nav-text">2.3 审查文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%BF%90%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.</span> <span class="nav-text">2.4 运行配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E6%9E%84%E5%BB%BA%E8%BD%AF%E4%BB%B6"><span class="nav-number">1.5.</span> <span class="nav-text">2.5 构建软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="nav-number">1.6.</span> <span class="nav-text">2.7 安装软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.7.</span> <span class="nav-text">2.8 编辑配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-%E5%AF%BC%E5%85%A5%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.8.</span> <span class="nav-text">2.9 导入配置数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-10-%E5%90%AF%E5%8A%A8SLAPD"><span class="nav-number">1.9.</span> <span class="nav-text">2.10 启动SLAPD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-11-%E5%B0%86%E5%88%9D%E5%A7%8B%E6%9D%A1%E7%9B%AE%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%82%A8%E7%9A%84%E7%9B%AE%E5%BD%95"><span class="nav-number">1.10.</span> <span class="nav-text">2.11 将初始条目添加到您的目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-%E7%9C%8B%E7%9C%8B%E5%AE%83%E6%98%AF%E5%90%A6%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.11.</span> <span class="nav-text">2.12 看看它是否工作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E9%85%8D%E7%BD%AE-slapd"><span class="nav-number">2.</span> <span class="nav-text">5 配置 slapd</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E9%85%8D%E7%BD%AE%E5%B8%83%E5%B1%80"><span class="nav-number">2.1.</span> <span class="nav-text">5.1 配置布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="nav-number">2.2.</span> <span class="nav-text">5.2 配置指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-cn-config"><span class="nav-number">2.2.1.</span> <span class="nav-text">5.2.1. cn&#x3D;config</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-1-olcIdleTimeout-lt-integer-gt"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">5.2.1.1 olcIdleTimeout: &lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-2-olcLogLevel-lt-integer-gt"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">5.2.1.2 olcLogLevel: &lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-3-olcReferral-lt-URI-gt"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">5.2.1.3 olcReferral &lt;URI&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-4-%E6%9D%A1%E7%9B%AE%E6%A0%B7%E4%BE%8B"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">5.2.1.4 条目样例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-cn-module"><span class="nav-number">2.2.2.</span> <span class="nav-text">5.2.2 cn&#x3D;module</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-1-olcModuleLoad%EF%BC%9A-lt-filename-gt"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">5.2.2.1 olcModuleLoad：&lt;filename&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-2-olcModulePath-lt-pathspec-gt"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">5.2.2.2 olcModulePath: &lt;pathspec&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-3-%E6%9D%A1%E7%9B%AE%E6%A0%B7%E4%BE%8B"><span class="nav-number">2.2.2.3.</span> <span class="nav-text">5.2.2.3 条目样例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-3-cn-schema"><span class="nav-number">2.2.3.</span> <span class="nav-text">5.2.3 cn&#x3D;schema</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-1-olcAttributeTypes"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">5.2.3.1 olcAttributeTypes</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-2-olcObjectClasses"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">5.2.3.2 olcObjectClasses</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-3-%E6%9D%A1%E7%9B%AE%E6%A0%B7%E4%BE%8B"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">5.2.3.3 条目样例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-4-%E5%90%8E%E7%AB%AF%E7%89%B9%E5%AE%9A%E6%8C%87%E4%BB%A4"><span class="nav-number">2.2.4.</span> <span class="nav-text">5.2.4 后端特定指令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-4-1-olcBackend-lt-type-gt"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">5.2.4.1 olcBackend: &lt;type&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-4-2-%E6%9D%A1%E7%9B%AE%E6%A0%B7%E4%BE%8B"><span class="nav-number">2.2.4.2.</span> <span class="nav-text">5.2.4.2 条目样例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%B9%E5%AE%9A%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="nav-number">2.2.5.</span> <span class="nav-text">5.2.5 数据库特定的指令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-1-olcDatabase-lt-index-gt-lt-type-gt"><span class="nav-number">2.2.5.1.</span> <span class="nav-text">5.2.5.1 olcDatabase: [{&lt;index&gt;}]&lt;type&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-2-olcAccess"><span class="nav-number">2.2.5.2.</span> <span class="nav-text">5.2.5.2 olcAccess</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-3-olcReadonly-TRUE-FALSE"><span class="nav-number">2.2.5.3.</span> <span class="nav-text">5.2.5.3 olcReadonly { TRUE | FALSE }</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-4-olcRootDN-lt-DN-gt"><span class="nav-number">2.2.5.4.</span> <span class="nav-text">5.2.5.4 olcRootDN: &lt;DN&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-5-olcRootPW-lt-password-gt"><span class="nav-number">2.2.5.5.</span> <span class="nav-text">5.2.5.5 olcRootPW: &lt;password&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-6-olcSizeLimit-lt-integer-gt"><span class="nav-number">2.2.5.6.</span> <span class="nav-text">5.2.5.6 olcSizeLimit: &lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-7-olcSuffix-lt-dn-suffix-gt"><span class="nav-number">2.2.5.7.</span> <span class="nav-text">5.2.5.7 olcSuffix: &lt;dn suffix&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-8-olcSyncrepl"><span class="nav-number">2.2.5.8.</span> <span class="nav-text">5.2.5.8. olcSyncrepl</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-9-olcTimeLimit-lt-integer-gt"><span class="nav-number">2.2.5.9.</span> <span class="nav-text">5.2.5.9 olcTimeLimit: &lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-10-olcUpdateref-lt-URL-gt"><span class="nav-number">2.2.5.10.</span> <span class="nav-text">5.2.5.10 olcUpdateref: &lt;URL&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-5-11-%E6%9D%A1%E7%9B%AE%E6%A1%88%E4%BE%8B"><span class="nav-number">2.2.5.11.</span> <span class="nav-text">5.2.5.11 条目案例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-6-BDB-and-HDB-Database-Directives"><span class="nav-number">2.2.6.</span> <span class="nav-text">5.2.6 BDB and HDB Database Directives</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-1-olcDbDirectory-lt-directory-gt"><span class="nav-number">2.2.6.1.</span> <span class="nav-text">5.2.6.1. olcDbDirectory: &lt;directory&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-2-olcDbCachesize%EF%BC%9A-lt-integer-gt"><span class="nav-number">2.2.6.2.</span> <span class="nav-text">5.2.6.2 olcDbCachesize：&lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-3-olcDbCheckpoint-lt-kbyte-gt-lt-min-gt"><span class="nav-number">2.2.6.3.</span> <span class="nav-text">5.2.6.3 olcDbCheckpoint:  &lt;kbyte&gt; &lt;min&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-4-olcDbConfig-lt-DB-CONFIG-setting-gt"><span class="nav-number">2.2.6.4.</span> <span class="nav-text">5.2.6.4 olcDbConfig: &lt;DB_CONFIG setting&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-5-olcDbNosync-TRUE-FALSE"><span class="nav-number">2.2.6.5.</span> <span class="nav-text">5.2.6.5 olcDbNosync: { TRUE | FALSE }</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-6-olcDbIDLcacheSize%EF%BC%9A-lt-integer-gt"><span class="nav-number">2.2.6.6.</span> <span class="nav-text">5.2.6.6 olcDbIDLcacheSize：&lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-7-olcDbIndex-lt-attrlist-gt-default-pres-eq-approx-sub-none"><span class="nav-number">2.2.6.7.</span> <span class="nav-text">5.2.6.7 olcDbIndex: {&lt;attrlist&gt; | default} [pres,eq,approx,sub,none]</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-8-olcDbLinearIndex-TRUE-FALSE"><span class="nav-number">2.2.6.8.</span> <span class="nav-text">5.2.6.8 olcDbLinearIndex: { TRUE | FALSE }</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-9-olcDbMode-lt-octal-gt-lt-symbolic-gt"><span class="nav-number">2.2.6.9.</span> <span class="nav-text">5.2.6.9 olcDbMode: { &lt;octal&gt; | &lt;symbolic&gt; }</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-10-olcDbSearchStack-lt-integer-gt"><span class="nav-number">2.2.6.10.</span> <span class="nav-text">5.2.6.10 olcDbSearchStack: &lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-11-olcDbShmKey-lt-integer-gt"><span class="nav-number">2.2.6.11.</span> <span class="nav-text">5.2.6.11 olcDbShmKey: &lt;integer&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-6-12-%E8%BE%93%E5%87%BA%E6%A0%B7%E4%BE%8B"><span class="nav-number">2.2.6.12.</span> <span class="nav-text">5.2.6.12 输出样例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E9%85%8D%E7%BD%AE%E4%B8%BE%E4%BE%8B"><span class="nav-number">2.3.</span> <span class="nav-text">5.3 配置举例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E5%B0%86%E6%97%A7%E6%A0%B7%E5%BC%8Fslapd-conf%EF%BC%885%EF%BC%89%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAcn-config%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.4.</span> <span class="nav-text">5.4 将旧样式slapd.conf（5）文件转换为cn&#x3D;config格式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-slapd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">6 slapd配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="nav-number">3.1.</span> <span class="nav-text">6.1 配置文件格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%8C%87%E4%BB%A4"><span class="nav-number">3.2.</span> <span class="nav-text">6.2 配置文件指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-%E5%85%A8%E5%B1%80%E6%8C%87%E4%BB%A4"><span class="nav-number">3.2.1.</span> <span class="nav-text">6.2.1 全局指令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-1-1-access-to"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">6.2.1.1 access to</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-2-attributetype-lt"><span class="nav-number">3.2.2.</span> <span class="nav-text">6.2.1.2 attributetype &lt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-3-idletimeout-lt-integer-gt"><span class="nav-number">3.2.3.</span> <span class="nav-text">6.2.1.3 idletimeout &lt;integer&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-4-include-lt-filename-gt"><span class="nav-number">3.2.4.</span> <span class="nav-text">6.2.1.4 include &lt;filename&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-5-loglevel-lt-level-gt"><span class="nav-number">3.2.5.</span> <span class="nav-text">6.2.1.5. loglevel &lt;level&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-6-objectclass-lt"><span class="nav-number">3.2.6.</span> <span class="nav-text">6.2.1.6 objectclass &lt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-7-referral-lt-URI-gt"><span class="nav-number">3.2.7.</span> <span class="nav-text">6.2.1.7 referral &lt;URI&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-8-sizelimit-lt-integer-gt"><span class="nav-number">3.2.8.</span> <span class="nav-text">6.2.1.8 sizelimit &lt;integer&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-9-timelimit-lt-integer-gt"><span class="nav-number">3.2.9.</span> <span class="nav-text">6.2.1.9 timelimit &lt;integer&gt;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2-%E4%B8%80%E8%88%AC%E5%90%8E%E7%AB%AF%E6%8C%87%E4%BB%A4"><span class="nav-number">3.3.</span> <span class="nav-text">6.2.2 一般后端指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-2-1-backend-lt-type-gt"><span class="nav-number">3.3.1.</span> <span class="nav-text">6.2.2.1 backend &lt;type&gt;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-3-%E4%B8%80%E8%88%AC%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8C%87%E4%BB%A4"><span class="nav-number">3.4.</span> <span class="nav-text">6.2.3 一般数据库指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-1-database-lt-type-gt"><span class="nav-number">3.4.1.</span> <span class="nav-text">6.2.3.1 database &lt;type&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-2-limits-lt-selector-gt-lt-limit-gt-lt-limit-gt-%E2%80%A6"><span class="nav-number">3.4.2.</span> <span class="nav-text">6.2.3.2 limits &lt;selector&gt; &lt;limit&gt; [&lt;limit&gt; […]]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-3-readonly-on-off"><span class="nav-number">3.4.3.</span> <span class="nav-text">6.2.3.3 readonly { on | off }</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-4-rootdn-lt-DN-gt"><span class="nav-number">3.4.4.</span> <span class="nav-text">6.2.3.4 rootdn &lt;DN&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-5-rootpw-lt-password-gt"><span class="nav-number">3.4.5.</span> <span class="nav-text">6.2.3.5 rootpw &lt;password&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-6-suffix-lt-dn-suffix-gt"><span class="nav-number">3.4.6.</span> <span class="nav-text">6.2.3.6 suffix &lt;dn suffix&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-7-syncrepl"><span class="nav-number">3.4.7.</span> <span class="nav-text">6.2.3.7 syncrepl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-8-updateref-lt-URL-gt"><span class="nav-number">3.4.8.</span> <span class="nav-text">6.2.3.8 updateref &lt;URL&gt;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-4-BDB%E5%92%8CHDB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8C%87%E4%BB%A4"><span class="nav-number">3.5.</span> <span class="nav-text">6.2.4 BDB和HDB数据库指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-4-1-directory-lt-directory-gt"><span class="nav-number">3.5.1.</span> <span class="nav-text">6.2.4.1 directory &lt;directory&gt;</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">6.3 配置文件示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E8%BF%90%E8%A1%8Cslapd"><span class="nav-number">5.</span> <span class="nav-text">7 运行slapd</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9"><span class="nav-number">5.1.</span> <span class="nav-text">7.1 命令行选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E5%BC%80%E5%A7%8Bslapd"><span class="nav-number">5.2.</span> <span class="nav-text">7.2 开始slapd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E5%81%9C%E6%AD%A2slapd"><span class="nav-number">5.3.</span> <span class="nav-text">7.3 停止slapd</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">6.</span> <span class="nav-text">8 访问控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.1.</span> <span class="nav-text">8.1 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-%E9%80%9A%E8%BF%87%E9%9D%99%E6%80%81%E9%85%8D%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">6.2.</span> <span class="nav-text">8.2 通过静态配置访问控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-1-%E4%BB%80%E4%B9%88%E6%9D%A5%E6%8E%A7%E5%88%B6%E8%AE%BF%E9%97%AE"><span class="nav-number">6.2.1.</span> <span class="nav-text">8.2.1 什么来控制访问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-2-%E8%B0%81%E6%8E%88%E4%BA%88%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="nav-number">6.2.2.</span> <span class="nav-text">8.2.2 谁授予访问权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-3-%E8%8E%B7%E5%BE%97%E6%8E%88%E6%9D%83"><span class="nav-number">6.2.3.</span> <span class="nav-text">8.2.3 获得授权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-4-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E8%AF%84%E4%BC%B0"><span class="nav-number">6.2.4.</span> <span class="nav-text">8.2.4 访问控制评估</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-5-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.2.5.</span> <span class="nav-text">8.2.5 访问控制示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-%E9%80%9A%E8%BF%87%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">6.3.</span> <span class="nav-text">8.3 通过动态配置访问控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-1-%E4%BB%80%E4%B9%88%E6%9D%A5%E6%8E%A7%E5%88%B6%E8%AE%BF%E9%97%AE"><span class="nav-number">6.3.1.</span> <span class="nav-text">8.3.1 什么来控制访问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-2-%E8%B0%81%E6%8E%88%E4%BA%88%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="nav-number">6.3.2.</span> <span class="nav-text">8.3.2 谁授予访问权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-3-%E8%8E%B7%E5%BE%97%E6%8E%88%E6%9D%83"><span class="nav-number">6.3.3.</span> <span class="nav-text">8.3.3 获得授权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-4-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E8%AF%84%E4%BC%B0"><span class="nav-number">6.3.4.</span> <span class="nav-text">8.3.4 访问控制评估</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-5-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.3.5.</span> <span class="nav-text">8.3.5 访问控制示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-6-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E8%AE%A2%E8%B4%AD"><span class="nav-number">6.3.6.</span> <span class="nav-text">8.3.6 访问控制订购</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%B8%B8%E8%A7%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.4.</span> <span class="nav-text">8.4 访问控制常见示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-1-%E5%9F%BA%E6%9C%ACACL"><span class="nav-number">6.4.1.</span> <span class="nav-text">8.4.1 基本ACL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-2-%E5%8C%B9%E9%85%8D%E5%8C%BF%E5%90%8D%E5%92%8C%E7%BB%8F%E8%BF%87%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E7%94%A8%E6%88%B7"><span class="nav-number">6.4.2.</span> <span class="nav-text">8.4.2 匹配匿名和经过身份验证的用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-3-%E6%8E%A7%E5%88%B6rootdn%E8%AE%BF%E9%97%AE"><span class="nav-number">6.4.3.</span> <span class="nav-text">8.4.3 控制rootdn访问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-4-%E4%BD%BF%E7%94%A8%E7%BB%84%E7%AE%A1%E7%90%86%E8%AE%BF%E9%97%AE"><span class="nav-number">6.4.4.</span> <span class="nav-text">8.4.4 使用组管理访问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-5-%E6%8E%88%E4%BA%88%E5%AF%B9%E5%B1%9E%E6%80%A7%E5%AD%90%E9%9B%86%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="nav-number">6.4.5.</span> <span class="nav-text">8.4.5 授予对属性子集的访问权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-6-%E5%85%81%E8%AE%B8%E7%94%A8%E6%88%B7%E5%86%99%E5%85%A5%E5%85%B6%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%A1%E7%9B%AE"><span class="nav-number">6.4.6.</span> <span class="nav-text">8.4.6 允许用户写入其下的所有条目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-7-%E5%85%81%E8%AE%B8%E5%88%9B%E5%BB%BA%E6%9D%A1%E7%9B%AE"><span class="nav-number">6.4.7.</span> <span class="nav-text">8.4.7 允许创建条目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-8-%E5%9C%A8Access-Control%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E6%8F%90%E7%A4%BA"><span class="nav-number">6.4.8.</span> <span class="nav-text">8.4.8 在Access Control中使用正则表达式的提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-9-%E5%9F%BA%E4%BA%8E%E5%AE%89%E5%85%A8%E5%BC%BA%E5%BA%A6%E5%9B%A0%E7%B4%A0%EF%BC%88ssf%EF%BC%89%E6%8E%88%E4%BA%88%E5%92%8C%E6%8B%92%E7%BB%9D%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="nav-number">6.4.9.</span> <span class="nav-text">8.4.9 基于安全强度因素（ssf）授予和拒绝访问权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-10-%E5%BD%93%E4%BA%8B%E6%83%85%E4%B8%8D%E6%8C%89%E9%A2%84%E6%9C%9F%E5%B7%A5%E4%BD%9C%E6%97%B6"><span class="nav-number">6.4.10.</span> <span class="nav-text">8.4.10 当事情不按预期工作时</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-%E9%9B%86-%E6%A0%B9%E6%8D%AE%E5%85%B3%E7%B3%BB%E6%8E%88%E4%BA%88%E6%9D%83%E9%99%90"><span class="nav-number">6.5.</span> <span class="nav-text">8.5 集 - 根据关系授予权限</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-1-%E7%BE%A4%E7%BB%84"><span class="nav-number">6.5.1.</span> <span class="nav-text">8.5.1 群组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-2-%E6%B2%A1%E6%9C%89DN%E8%AF%AD%E6%B3%95%E7%9A%84%E7%BB%84ACL"><span class="nav-number">6.5.2.</span> <span class="nav-text">8.5.2 没有DN语法的组ACL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-3-%E4%BB%A5%E4%B8%8B%E5%8F%82%E8%80%83"><span class="nav-number">6.5.3.</span> <span class="nav-text">8.5.3 以下参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E6%A8%A1%E5%BC%8F%E8%A7%84%E8%8C%83"><span class="nav-number">7.</span> <span class="nav-text">13 模式规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-%E5%88%86%E5%B8%83%E5%BC%8F%E6%A8%A1%E5%BC%8F%E6%96%87%E4%BB%B6"><span class="nav-number">7.1.</span> <span class="nav-text">13.1 分布式模式文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-%E6%89%A9%E5%B1%95%E6%9E%B6%E6%9E%84"><span class="nav-number">7.2.</span> <span class="nav-text">13.2 扩展架构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#13-2-1-%E5%AF%B9%E8%B1%A1%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="nav-number">7.2.1.</span> <span class="nav-text">13.2.1 对象标识符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-2-2-%E5%91%BD%E5%90%8D%E5%85%83%E7%B4%A0"><span class="nav-number">7.2.2.</span> <span class="nav-text">13.2.2 命名元素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-2-3-%E6%9C%AC%E5%9C%B0%E6%9E%B6%E6%9E%84%E6%96%87%E4%BB%B6"><span class="nav-number">7.2.3.</span> <span class="nav-text">13.2.3 本地架构文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-2-4-%E5%B1%9E%E6%80%A7%E7%B1%BB%E5%9E%8B%E8%A7%84%E8%8C%83"><span class="nav-number">7.2.4.</span> <span class="nav-text">13.2.4 属性类型规范</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-%E4%BD%BF%E7%94%A8SASL"><span class="nav-number">8.</span> <span class="nav-text">15 使用SASL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#15-1-SASL%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">8.1.</span> <span class="nav-text">15.1 SASL安全注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-2-SASL%E8%AE%A4%E8%AF%81"><span class="nav-number">8.2.</span> <span class="nav-text">15.2 SASL认证</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#15-2-1-GSSAPI"><span class="nav-number">8.2.1.</span> <span class="nav-text">15.2.1 GSSAPI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-2-2-KERBEROS-V4"><span class="nav-number">8.2.2.</span> <span class="nav-text">15.2.2 KERBEROS_V4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-2-3-DIGEST-MD5"><span class="nav-number">8.2.3.</span> <span class="nav-text">15.2.3 DIGEST-MD5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-2-4-EXTERNAL"><span class="nav-number">8.2.4.</span> <span class="nav-text">15.2.4 EXTERNAL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#15-2-4-1-TLS%E8%AE%A4%E8%AF%81%E8%BA%AB%E4%BB%BD%E6%A0%BC%E5%BC%8F"><span class="nav-number">8.2.4.1.</span> <span class="nav-text">15.2.4.1 TLS认证身份格式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#15-2-4-2-IPC-ldapi-Identity-Format"><span class="nav-number">8.2.4.2.</span> <span class="nav-text">15.2.4.2 IPC (ldapi:&#x2F;&#x2F;&#x2F;) Identity Format</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-2-5-%E6%98%A0%E5%B0%84%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E8%BA%AB%E4%BB%BD"><span class="nav-number">8.2.5.</span> <span class="nav-text">15.2.5 映射身份验证身份</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-2-6-%E7%9B%B4%E6%8E%A5%E6%98%A0%E5%B0%84"><span class="nav-number">8.2.6.</span> <span class="nav-text">15.2.6 直接映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-2-7-%E5%9F%BA%E4%BA%8E%E6%90%9C%E7%B4%A2%E7%9A%84%E6%98%A0%E5%B0%84"><span class="nav-number">8.2.7.</span> <span class="nav-text">15.2.7 基于搜索的映射</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-3-SASL%E4%BB%A3%E7%90%86%E6%8E%88%E6%9D%83"><span class="nav-number">8.3.</span> <span class="nav-text">15.3 SASL代理授权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#15-3-1-%E4%BB%A3%E7%90%86%E6%8E%88%E6%9D%83%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">8.3.1.</span> <span class="nav-text">15.3.1 代理授权的使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-3-2-SASL%E6%8E%88%E6%9D%83%E8%BA%AB%E4%BB%BD"><span class="nav-number">8.3.2.</span> <span class="nav-text">15.3.2 SASL授权身份</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-3-3-%E4%BB%A3%E7%90%86%E6%8E%88%E6%9D%83%E8%A7%84%E5%88%99"><span class="nav-number">8.3.3.</span> <span class="nav-text">15.3.3 代理授权规则</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#15-3-3-1-%E4%BB%A3%E7%90%86%E6%8E%88%E6%9D%83%E8%A7%84%E5%88%99%E8%AF%B4%E6%98%8E"><span class="nav-number">8.3.3.1.</span> <span class="nav-text">15.3.3.1 代理授权规则说明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#15-3-3-2-%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE"><span class="nav-number">8.3.3.2.</span> <span class="nav-text">15.3.3.2 策略配置</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-%E7%9B%91%E6%B5%8B"><span class="nav-number">9.</span> <span class="nav-text">20 监测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#20-1-%E9%80%9A%E8%BF%87cn-config-5-%E7%9B%91%E6%8E%A7%E9%85%8D%E7%BD%AE"><span class="nav-number">9.1.</span> <span class="nav-text">20.1 通过cn&#x3D;config(5)监控配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-2-%E9%80%9A%E8%BF%87slapd-conf-5-%E7%9B%91%E8%A7%86%E9%85%8D%E7%BD%AE"><span class="nav-number">9.2.</span> <span class="nav-text">20.2 通过slapd.conf(5)监视配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-3-%E8%AE%BF%E9%97%AE%E7%9B%91%E6%8E%A7%E4%BF%A1%E6%81%AF"><span class="nav-number">9.3.</span> <span class="nav-text">20.3 访问监控信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-4-%E7%9B%91%E6%8E%A7%E4%BF%A1%E6%81%AF"><span class="nav-number">9.4.</span> <span class="nav-text">20.4 监控信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-1-%E5%90%8E%E7%AB%AF"><span class="nav-number">9.4.1.</span> <span class="nav-text">20.4.1 后端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-2-Connections"><span class="nav-number">9.4.2.</span> <span class="nav-text">20.4.2 Connections</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-3-Databases"><span class="nav-number">9.4.3.</span> <span class="nav-text">20.4.3 Databases</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-4-Listener"><span class="nav-number">9.4.4.</span> <span class="nav-text">20.4.4 Listener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-5-Log"><span class="nav-number">9.4.5.</span> <span class="nav-text">20.4.5 Log</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-6-Operations"><span class="nav-number">9.4.6.</span> <span class="nav-text">20.4.6 Operations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-7-Overlays"><span class="nav-number">9.4.7.</span> <span class="nav-text">20.4.7 Overlays</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-8-SASL"><span class="nav-number">9.4.8.</span> <span class="nav-text">20.4.8 SASL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-9-Statistics"><span class="nav-number">9.4.9.</span> <span class="nav-text">20.4.9 Statistics</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-10-Threads"><span class="nav-number">9.4.10.</span> <span class="nav-text">20.4.10 Threads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-11-Time"><span class="nav-number">9.4.11.</span> <span class="nav-text">20.4.11 Time</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-4-12-TLS"><span class="nav-number">9.4.12.</span> <span class="nav-text">20.4.12 TLS</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-4-13-Waiters"><span class="nav-number">9.5.</span> <span class="nav-text">20.4.13 Waiters</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">huagang</p>
  <div class="site-description" itemprop="description">I Love You !</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/whg517" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;whg517" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/huagang517@126.com" title="E-Mail → huagang517@126.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/whg517" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.iclouds.work/2017/11/20/documents/openldap_administrators_guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="huagang">
      <meta itemprop="description" content="I Love You !">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Myblog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OpenLDAP Software 2.4 Administrator's Guide
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-20 14:52:25" itemprop="dateCreated datePublished" datetime="2017-11-20T14:52:25+08:00">2017-11-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-05-28 11:50:00" itemprop="dateModified" datetime="2020-05-28T11:50:00+08:00">2020-05-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Documents/" itemprop="url" rel="index"><span itemprop="name">Documents</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>由于在使用 Openldap 苦于直接看以英文文档太麻烦，反正也是要阅读就边看边做笔记，于是有了次文档。记录内容呢也只是根据自己需要选择性翻译。<br>文章内容直接由 google 翻译软件翻译，可能存在不通顺之处，还望大家多多指出。在 markdown 转换到 html 过程中可能有部分尖括号引用内容，<br>导致丢失或者显示有误，请大家参照官方文档对比。</p>
<span id="more"></span>

<p>后期我会不定期优化文档，补全文档。</p>
<p>The OpenLDAP Project &lt;<a target="_blank" rel="noopener" href="http://www.openldap.org/">http://www.openldap.org/</a>&gt;</p>
<h2 id="2-快速入门指南"><a href="#2-快速入门指南" class="headerlink" title="2 快速入门指南"></a>2 快速入门指南</h2><p>以下是OpenLDAP软件2.4的快速入门指南，包括独立版 LDAP守护进程，<em>slapd</em>（8）。</p>
<p>这意味着让您了解安装和配置<a target="_blank" rel="noopener" href="http://www.openldap.org/software/">OpenLDAP软件</a>所需的基本步骤。应与本文档的其他章节，手册页以及发行版提供的其他材料（如<code>INSTALL</code>文档）或<a target="_blank" rel="noopener" href="http://www.openldap.org/">OpenLDAP</a>网站（<a target="_blank" rel="noopener" href="http://www.openldap.org/">http://www.OpenLDAP.org</a>）一起使用OpenLDAP软件常问问题（<a target="_blank" rel="noopener" href="http://www.openldap.org/faq/?file=2">http://www.OpenLDAP.org/faq/?file=2</a>）。</p>
<p>如果您打算认真运行OpenLDAP软件，那么在尝试安装软件之前，您应该查看所有这些文档。</p>
<p><strong>注意：</strong>此快速入门指南不使用强身份验证，也不使用任何完整性或机密保护服务。这些服务在OpenLDAP管理员指南的其他章节中介绍。</p>
<h3 id="2-1-获取软件"><a href="#2-1-获取软件" class="headerlink" title="2.1 获取软件"></a>2.1 获取软件</h3><p>您可以按照OpenLDAP软件下载页面（<a target="_blank" rel="noopener" href="http://www.openldap.org/software/download/">http://www.openldap.org/software/download/</a>）上的说明<strong>获取软件</strong>副本。建议新用户从最新<em>版本</em>开始。</p>
<h3 id="2-2-打开分发包打开"><a href="#2-2-打开分发包打开" class="headerlink" title="2.2 打开分发包打开"></a>2.2 打开分发包打开</h3><p>源目录，将目录更改到那里，然后使用以下命令解压缩分发：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunzip -c openldap-VERSION.tgz | tar xvfB -</span><br></pre></td></tr></table></figure>

<p>然后重新定位到分发目录中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd openldap-VERSION</span><br></pre></td></tr></table></figure>

<p>您必须使用版本名称替换<code>VERSION</code>。</p>
<h3 id="2-3-审查文件"><a href="#2-3-审查文件" class="headerlink" title="2.3 审查文件"></a>2.3 审查文件</h3><p>您现在应该查看发行版<code>随附</code>的<code>版权</code>，<code>许可证</code>，<code>自述</code>文件和<code>INSTALL</code>文档。该<code>版权</code>和<code>许可</code>提供可接受的使用，复制和OpenLDAP软件的保修期限制信息。</p>
<p>您还应该查看本文档的其他章节。特别是，本文档的“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/install.html">构建和安装OpenLDAP软件”</a>一章提供了有关必备软件和安装步骤的详细信息。</p>
<h3 id="2-4-运行配置"><a href="#2-4-运行配置" class="headerlink" title="2.4 运行配置"></a>2.4 运行配置</h3><p>您将需要运行提供的<code>配置</code>脚本来<em>配置</em>在系统上构建的分发。该<code>配置</code>脚本接受许多命令行选项启用或禁用可选的软件功能。通常默认值是可以的，但是您可能想要更改它们。要获取<code>配置</code>接受的选项的完整列表，请使用<code>--help</code>选项：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --help</span><br></pre></td></tr></table></figure>

<p>但是，考虑到您正在使用本指南，我们假设您是勇敢的，只需让<code>配置</code>确定什么是最好的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure>

<p>假设<code>configure</code>不会不喜欢你的系统，你可以继续构建软件。如果<code>configure</code>没有抱怨，那么您可能需要去软件常见问题解答<em>安装</em> 部分<br>（<a target="_blank" rel="noopener" href="http://www.openldap.org/faq/?file=8">http://www.openldap.org/faq/?file=8</a>）和/或实际阅读“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/install.html">构建和安装OpenLDAP软件”</a>一章的文件。</p>
<h3 id="2-5-构建软件"><a href="#2-5-构建软件" class="headerlink" title="2.5 构建软件"></a>2.5 构建软件</h3><p>下一步是构建软件。这一步有两个部分，首先我们构建依赖关系，然后编译软件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make depend</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>两个都应该完成没有错误。</p>
<p>2.6 测试构建</p>
<p>为了确保正确的构建，您应该运行测试套件（只需要几分钟）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make test</span><br></pre></td></tr></table></figure>

<p>适用于您的配置的测试将运行，它们应该通过。可能会跳过某些测试，如复制测试。</p>
<h3 id="2-7-安装软件"><a href="#2-7-安装软件" class="headerlink" title="2.7 安装软件"></a>2.7 安装软件</h3><p>您现在可以安装该软件了; 这通常需要<em>超级用户</em>权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root -c &#x27;make install&#x27;</span><br></pre></td></tr></table></figure>

<p>现在应该将所有内容安装在<code>/ usr / local下</code>（或者<code>configure</code>使用的任何安装前缀）。</p>
<h3 id="2-8-编辑配置文件"><a href="#2-8-编辑配置文件" class="headerlink" title="2.8 编辑配置文件"></a>2.8 编辑配置文件</h3><p>使用您喜欢的编辑器编辑提供的<em>slapd.ldif</em>示例（通常安装为<code>/usr/local/etc/openldap/slapd.ldif</code>）以包含MDB数据库定义的形式：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=mdb,cn=config</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">objectClass: olcMdbConfig</span><br><span class="line">olcDatabase: mdb</span><br><span class="line">OlcDbMaxSize: 1073741824</span><br><span class="line">olcSuffix: dc=&lt;MY-DOMAIN&gt;,dc=&lt;COM&gt;</span><br><span class="line">olcRootDN: cn=Manager,dc=&lt;MY-DOMAIN&gt;,dc=&lt;COM&gt;</span><br><span class="line">olcRootPW: secret</span><br><span class="line">olcDbDirectory: /usr/local/var/openldap-data</span><br><span class="line">olcDbIndex: objectClass eq</span><br></pre></td></tr></table></figure>

<p>请务必使用您域名的相应网域组件替换<code>&lt;MY-DOMAIN&gt;</code>和<code>&lt;COM&gt;</code>。例如，对于<code>example.com</code>，请使用：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=mdb,cn=config</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">objectClass: olcMdbConfig</span><br><span class="line">olcDatabase: mdb</span><br><span class="line">OlcDbMaxSize: 1073741824</span><br><span class="line">olcSuffix: dc=example,dc=com</span><br><span class="line">olcRootDN: cn=Manager,dc=example,dc=com</span><br><span class="line">olcRootPW: secret</span><br><span class="line">olcDbDirectory: /usr/local/var/openldap-data</span><br><span class="line">olcDbIndex: objectClass eq</span><br></pre></td></tr></table></figure>

<p>如果您的域包含其他组件，例如<code>eng.uni.edu.eu</code>，请使用：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=mdb,cn=config</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">objectClass: olcMdbConfig</span><br><span class="line">olcDatabase: mdb</span><br><span class="line">OlcDbMaxSize: 1073741824</span><br><span class="line">olcSuffix: dc=eng,dc=uni,dc=edu,dc=eu</span><br><span class="line">olcRootDN: cn=Manager,dc=eng,dc=uni,dc=edu,dc=eu</span><br><span class="line">olcRootPW: secret</span><br><span class="line">olcDbDirectory: /usr/local/var/openldap-data</span><br><span class="line">olcDbIndex: objectClass eq</span><br></pre></td></tr></table></figure>

<h3 id="2-9-导入配置数据库"><a href="#2-9-导入配置数据库" class="headerlink" title="2.9 导入配置数据库"></a>2.9 导入配置数据库</h3><p>现在，您可以通过运行以下命令来导入您的配置数据库供<em>slapd</em>（8）使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root -c /usr/local/sbin/slapadd -n 0 -F /usr/local/etc/slapd.d -l /usr/local/etc/openldap/slapd.ldif</span><br></pre></td></tr></table></figure>

<h3 id="2-10-启动SLAPD"><a href="#2-10-启动SLAPD" class="headerlink" title="2.10 启动SLAPD"></a>2.10 启动SLAPD</h3><p>您现在可以通过运行以下命令启动独立LDAP守护程序<em>slapd</em>（8）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root -c /usr/local/libexec/slapd -F /usr/local/etc/slapd.d</span><br></pre></td></tr></table></figure>

<p>要检查服务器是否正在运行和配置，您可以使用<em>ldapsearch</em>（1）运行搜索。默认情况下，<em>ldapsearch</em>安装为<code>/usr/local/bin/ldapsearch</code>：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -b &#x27;&#x27; -s base &#x27;(objectclass=*)&#x27; namingContexts</span><br></pre></td></tr></table></figure>

<p>请注意在命令参数周围使用单引号来防止shell解释特殊字符。这应该返回：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dn:</span><br><span class="line">namingContexts: dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>有关运行<em>slapd</em>（8）的详细信息，请参见<em>slapd</em>（8）手册页和本文档的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/runningslapd.html">Running slapd</a>章节。</p>
<h3 id="2-11-将初始条目添加到您的目录"><a href="#2-11-将初始条目添加到您的目录" class="headerlink" title="2.11 将初始条目添加到您的目录"></a>2.11 将初始条目添加到您的目录</h3><p>您可以使用<em>ldapadd</em>（1）向LDAP目录添加条目。<em>ldapadd</em>希望输入LDIF形成。我们将分两步进行：</p>
<ol>
<li>创建一个LDIF文件</li>
<li>运行ldapadd</li>
</ol>
<p>使用您喜欢的编辑器并创建一个包含以下内容的LDIF文件：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dn: dc=&lt;MY-DOMAIN&gt;,dc=&lt;COM&gt;</span><br><span class="line">objectclass: dcObject</span><br><span class="line">objectclass: organization</span><br><span class="line">o: &lt;MY ORGANIZATION&gt;</span><br><span class="line">dc: &lt;MY-DOMAIN&gt;</span><br><span class="line"></span><br><span class="line">dn: cn=Manager,dc=&lt;MY-DOMAIN&gt;,dc=&lt;COM&gt;</span><br><span class="line">objectclass: organizationalRole</span><br><span class="line">cn: Manager</span><br></pre></td></tr></table></figure>

<p>请务必使用您域名的相应网域组件替换<code>&lt;MY-DOMAIN&gt;</code>和<code>&lt;COM&gt;</code>。 应以组织名称替换<code>&lt;我的组织&gt;</code>。剪切和粘贴时，请确保从示例中修剪任何前导和尾随空格。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dn: dc=example,dc=com</span><br><span class="line">objectclass: dcObject</span><br><span class="line">objectclass: organization</span><br><span class="line">o: Example Company</span><br><span class="line">dc: example</span><br><span class="line"></span><br><span class="line">dn: cn=Manager,dc=example,dc=com</span><br><span class="line">objectclass: organizationalRole</span><br><span class="line">cn: Manager</span><br></pre></td></tr></table></figure>

<p>现在，您可以运行<em>ldapadd</em>（1）将这些条目插入到目录中。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapadd -x -D &quot;cn=Manager,dc=&lt;MY-DOMAIN&gt;,dc=&lt;COM&gt;&quot; -W -f example.ldif</span><br></pre></td></tr></table></figure>

<p>请务必使用您域名的相应网域组件替换<code>&lt;MY-DOMAIN&gt;</code>和<code>&lt;COM&gt;</code>。系统将提示您输入<code>slapd.conf中</code>指定的“<code>secret</code> ” 。例如，对于<code>example.com</code>，请使用：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapadd -x -D &quot;cn=Manager,dc=example,dc=com&quot; -W -f example.ldif</span><br></pre></td></tr></table></figure>

<p>其中<code>example.ldif</code>是您上面创建的文件。</p>
<p>有关目录创建的其他信息，请参见本文档的“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/dbtools.html">数据库创建和维护工具”</a>一章。</p>
<h3 id="2-12-看看它是否工作"><a href="#2-12-看看它是否工作" class="headerlink" title="2.12 看看它是否工作"></a>2.12 看看它是否工作</h3><p>现在我们准备好验证添加的条目在您的目录中。您可以使用任何LDAP客户端来执行此操作，但我们的示例使用<em>ldapsearch</em>（1）工具。请记住将<code>dc=example,dc=com</code>替换为您网站的正确值：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -b &#x27;dc=example,dc=com&#x27; &#x27;(objectclass=*)&#x27;</span><br></pre></td></tr></table></figure>

<p>此命令将搜索并检索数据库中的每个条目。</p>
<p>您现在可以使用<em>ldapadd</em>（1）或其他LDAP客户端添加更多条目，尝试各种配置选项，后端安排等。</p>
<p>请注意，默认情况下，<em>slapd</em>（8）数据库授予对<em>超级用户</em>（除了<code>rootdn</code>配置指令指定）之外的<em>所有人的读访问权限</em>。强烈建议您建立控制以限制对授权用户的访问。访问<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/access-control.html">控制</a>章节讨论<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/access-control.html">访问控制</a>。还鼓励您阅读<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/security.html">安全注意事项</a>，<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/sasl.html">使用SASL</a>和<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/tls.html">使用TLS</a>部分。**``</p>
<p>以下章节提供了有关制作，安装和运行<em>slapd</em>（8）的更多详细信息。</p>
<h2 id="5-配置-slapd"><a href="#5-配置-slapd" class="headerlink" title="5 配置 slapd"></a>5 配置 slapd</h2><p>OpenLDAP 2.3和更高版本已经转换为使用动态运行时配置引擎 <em>slapd-config</em>（5）</p>
<ul>
<li>完全启用了LDAP</li>
<li>使用标准LDAP操作进行管理</li>
<li>将其配置数据存储在 LDIF数据库，一般在<code>/usr/local/etc/openldap/slapd.d</code>目录下。</li>
<li>允许slapd的所有配置选项随时更改，通常不要求服务器重新启动，以使更改生效</li>
</ul>
<p>本章介绍<em>slapd-config</em>（5）配置系统的一般格式，其次是常用设置的详细说明。</p>
<p>旧版本<em>slapd.conf</em>（5）文件仍然受支持，但其使用已被弃用，并且对其的支持将在未来的OpenLDAP版本中被撤销。在下一章将介绍通过<em>slapd.conf</em>（5）配置<em>slapd</em>（8）。</p>
<p><strong>注：</strong>虽然<em>slapd-config</em>（5）系统存储了其作为（基于文本）LDIF文件的配置，你应该<em>永远不要</em>直接编辑任何LDIF文件。应通过LDAP操作执行配置更改，例如<em>ldapadd</em>（1），<em>ldapdelete</em>（1）或<em>ldapmodify</em>（1）。</p>
<h3 id="5-1-配置布局"><a href="#5-1-配置布局" class="headerlink" title="5.1 配置布局"></a>5.1 配置布局</h3><p>slapd配置存储为具有预定义模式和DIT的特殊LDAP目录。有特定的objectClasses用于承载全局配置选项，模式定义，后端和数据库定义以及各种其他项目。示例配置树如图5.1所示。</p>
<p><img src="https://qiniu.iclouds.work/FmRtJjELzSWkM7K8VC21jahAN4SS.png" alt="图 5.1"></p>
<p>其他对象可以是配置的一部分，但是为了清楚起见，从图示中省略。</p>
<p>该 <em>slapd-config</em> 配置树有一个非常特殊的结构。树的根名为<code>cn=config</code> ，并包含全局配置设置。附加设置包含在单独的子条目中：</p>
<ul>
<li>动态加载的模块<ul>
<li>只有使用<code>--enable-modules</code>选项来配置软件时，才可以使用这些。</li>
</ul>
</li>
<li>模式定义<ul>
<li>该<code>cn=schema，cn=config</code>条目包含了系统架构（所有架构是硬编码的slapd）。<code>cn=schema</code> 的<br>子条目，<code>cn=config</code>包含从配置文件加载或在运行时添加的用户模式。</li>
</ul>
</li>
<li>后端特定配置</li>
<li>数据库特定配置<ul>
<li>数据库条目的子节点定义了覆盖。</li>
<li>数据库和叠加也可能有其他杂项的子项。</li>
</ul>
</li>
</ul>
<p>LDIF文件的常规规则适用于配置信息：以<code>＃</code> 字符开头的注释行将被忽略。如果一行以单个空格开始，它被认为是前一行的延续（即使前一行是注释），并且单个前导空格被删除。条目用空白行分隔。</p>
<p>配置LDIF的一般布局如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># global configuration settings</span><br><span class="line">dn: cn=config</span><br><span class="line">objectClass: olcGlobal</span><br><span class="line">cn: config</span><br><span class="line">&lt;global config settings&gt;</span><br><span class="line"></span><br><span class="line"># schema definitions</span><br><span class="line">dn: cn=schema,cn=config</span><br><span class="line">objectClass: olcSchemaConfig</span><br><span class="line">cn: schema</span><br><span class="line">&lt;system schema&gt;</span><br><span class="line"></span><br><span class="line">dn: cn=&#123;X&#125;core,cn=schema,cn=config</span><br><span class="line">objectClass: olcSchemaConfig</span><br><span class="line">cn: &#123;X&#125;core</span><br><span class="line">&lt;core schema&gt;</span><br><span class="line"></span><br><span class="line"># additional user-specified schema</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"># backend definitions</span><br><span class="line">dn: olcBackend=&lt;typeA&gt;,cn=config</span><br><span class="line">objectClass: olcBackendConfig</span><br><span class="line">olcBackend: &lt;typeA&gt;</span><br><span class="line">&lt;backend-specific settings&gt;</span><br><span class="line"></span><br><span class="line"># database definitions</span><br><span class="line">dn: olcDatabase=&#123;X&#125;&lt;typeA&gt;,cn=config</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">olcDatabase: &#123;X&#125;&lt;typeA&gt;</span><br><span class="line">&lt;database-specific settings&gt;</span><br><span class="line"></span><br><span class="line"># subsequent definitions and settings</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>上面列出的一些条目的名称中有数字索引<code>“&#123;X&#125;”</code>。虽然大多数配置设置具有固有的顺序依赖性（即，一个设置必须在后续设置之前生效），LDAP数据库本质上是无序的。数字索引用于在配置数据库中强制执行一致的排序，以便保留所有排序依赖关系。在大多数情况下，不必提供指数; 它将根据创建条目的顺序自动生成。</p>
<p>配置指令被指定为各个属性的值。slapd配置中使用的大多数属性和对象类在其名称中具有前缀<code>“olc”</code> （OpenLDAP Configuration）。通常，属性和旧式<code>slapd.conf</code>配置关键字之间存在一一对应关系，使用关键字作为属性名称，并附加“olc”前缀。</p>
<p>配置指令可能会引用参数。如果是这样，这些参数就被空格分开。如果一个参数包含空格，参数应该用双引号括起来<code>“像这样”</code>。在下面的描述中，应该用实际文本替换的参数在括号<code>&lt;&gt;</code>中显示。</p>
<p>该分发包含将安装在<code>/usr/local/etc/openldap</code>目录中的示例配置文件。<code>/usr/local/etc/openldap/schema</code>目录中也提供了一些包含模式定义（属性类型和对象类）的文件。</p>
<h3 id="5-2-配置指令"><a href="#5-2-配置指令" class="headerlink" title="5.2 配置指令"></a>5.2 配置指令</h3><p>节详细介绍常用的配置指令。有关完整列表，请参阅<em>slapd-config</em>（5）手册页。本节将以自上而下的顺序处理配置指令，从<code>cn=config</code>条目中的全局伪指令开始。将对每个指令及其默认值（如果有）以及其使用示例进行描述。</p>
<h4 id="5-2-1-cn-config"><a href="#5-2-1-cn-config" class="headerlink" title="5.2.1. cn=config"></a>5.2.1. cn=config</h4><p>此条目中包含的指令通常适用于整个服务器。他们大多数是系统或连接导向，而不是数据库相关。此条目必须具有<code>olcGlobal objectClass</code>。</p>
<h5 id="5-2-1-1-olcIdleTimeout-lt-integer-gt"><a href="#5-2-1-1-olcIdleTimeout-lt-integer-gt" class="headerlink" title="5.2.1.1 olcIdleTimeout: &lt;integer&gt;"></a>5.2.1.1 olcIdleTimeout: &lt;integer&gt;</h5><p>指定强制关闭空闲客户端连接之前等待的秒数。值为0，默认值，禁用此功能。</p>
<h5 id="5-2-1-2-olcLogLevel-lt-integer-gt"><a href="#5-2-1-2-olcLogLevel-lt-integer-gt" class="headerlink" title="5.2.1.2 olcLogLevel: &lt;integer&gt;"></a>5.2.1.2 olcLogLevel: &lt;integer&gt;</h5><p>此指令指定调试语句和操作统计信息应该被syslog的级别（当前记录到<em>syslogd</em>（8）<code>LOG_LOCAL4</code>设施）。您必须配置OpenLDAP<code>--enable-debug</code>（默认值）才能工作（除了始终启用的两个统计级别之外）。日志级别可以被指定为整数或关键字。可以使用多个日志级别，并且级别是相加的。要显示什么级别对应于什么样的调试，用<code>-d?</code>调用slapd 或查阅下表。&lt;level&gt;的可能值为：</p>
<p>表5.1：调试级别</p>
<table>
<thead>
<tr>
<th><strong>Level</strong></th>
<th><strong>Keyword</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>-1</td>
<td>any</td>
<td>enable all debugging</td>
</tr>
<tr>
<td>0</td>
<td></td>
<td>no debugging</td>
</tr>
<tr>
<td>1</td>
<td>(0x1 trace)</td>
<td>trace function calls</td>
</tr>
<tr>
<td>2</td>
<td>(0x2 packets)</td>
<td>debug packet handling</td>
</tr>
<tr>
<td>4</td>
<td>(0x4 args)</td>
<td>heavy trace debugging</td>
</tr>
<tr>
<td>8</td>
<td>(0x8 conns)</td>
<td>connection management</td>
</tr>
<tr>
<td>16</td>
<td>(0x10 BER)</td>
<td>print out packets sent and received</td>
</tr>
<tr>
<td>32</td>
<td>(0x20 filter)</td>
<td>search filter processing</td>
</tr>
<tr>
<td>64</td>
<td>(0x40 config)</td>
<td>configuration processing</td>
</tr>
<tr>
<td>128</td>
<td>(0x80 ACL)</td>
<td>access control list processing</td>
</tr>
<tr>
<td>256</td>
<td>(0x100 stats)</td>
<td>stats log connections/operations/results</td>
</tr>
<tr>
<td>512</td>
<td>(0x200 stats2)</td>
<td>stats log entries sent</td>
</tr>
<tr>
<td>1024</td>
<td>(0x400 shell)</td>
<td>print communication with shell backends</td>
</tr>
<tr>
<td>2048</td>
<td>(0x800 parse)</td>
<td>print entry parsing debugging</td>
</tr>
<tr>
<td>16384</td>
<td>(0x4000 sync)</td>
<td>syncrepl consumer processing</td>
</tr>
<tr>
<td>32768</td>
<td>(0x8000 none)</td>
<td>only messages that get logged whatever log level is set</td>
</tr>
</tbody></table>
<p>期望的日志级别可以作为单个整数输入，该整数将（ORed）所需的级别（十进制或十六进制符号）组合为整数列表（在内部进行ORed操作），或作为显示的名称列表在括号之间，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">olcLogLevel 129</span><br><span class="line">olcLogLevel 0x81</span><br><span class="line">olcLogLevel 128 1</span><br><span class="line">olcLogLevel 0x80 0x1</span><br><span class="line">olcLogLevel acl trace</span><br></pre></td></tr></table></figure>

<p>是等同的</p>
<p><strong>例子：</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcLogLevel -1</span><br></pre></td></tr></table></figure>

<p>这将导致大量的调试信息被记录。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcLogLevel conns filter</span><br></pre></td></tr></table></figure>

<p>只需记录连接并搜索过滤器处理。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcLogLevel none</span><br></pre></td></tr></table></figure>

<p>记录无论配置的日志级别如何记录的消息。这不同于在不发生日志记录时将日志级别设置为0。至少需要“<code>无”</code>级才能记录高优先级消息。</p>
<p><strong>默认：</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcLogLevel stats</span><br></pre></td></tr></table></figure>

<p>默认情况下配置基本统计记录。但是，如果未定义<code>olcLogLevel</code>，则不会发生日志记录（相当于0级）。</p>
<h5 id="5-2-1-3-olcReferral-lt-URI-gt"><a href="#5-2-1-3-olcReferral-lt-URI-gt" class="headerlink" title="5.2.1.3 olcReferral &lt;URI&gt;"></a>5.2.1.3 olcReferral &lt;URI&gt;</h5><p>此指令指定当slapd找不到本地数据库来处理请求时要传回的引用。</p>
<p><strong>例：</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcReferral: ldap://root.openldap.org</span><br></pre></td></tr></table></figure>

<p>这将在OpenLDAP项目中将非本地查询引用到全局根LDAP服务器。智能LDAP客户端可以在该服务器上重新询问他们的查询，但请注意，大多数这些客户端只会知道如何处理包含主机部分和可选的可分辨名称部分的简单LDAP URL。</p>
<h5 id="5-2-1-4-条目样例"><a href="#5-2-1-4-条目样例" class="headerlink" title="5.2.1.4 条目样例"></a>5.2.1.4 条目样例</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=config</span><br><span class="line">objectClass: olcGlobal</span><br><span class="line">cn: config</span><br><span class="line">olcIdleTimeout: 30</span><br><span class="line">olcLogLevel: Stats</span><br><span class="line">olcReferral: ldap://root.openldap.org</span><br></pre></td></tr></table></figure>

<h4 id="5-2-2-cn-module"><a href="#5-2-2-cn-module" class="headerlink" title="5.2.2 cn=module"></a>5.2.2 cn=module</h4><p>如果在配置slapd时启用对动态加载模块的支持，则可以使用<code>cn=module</code>条目来指定要加载的模块集。模块条目必须具有<code>olcModuleList objectClass</code>。</p>
<h5 id="5-2-2-1-olcModuleLoad：-lt-filename-gt"><a href="#5-2-2-1-olcModuleLoad：-lt-filename-gt" class="headerlink" title="5.2.2.1 olcModuleLoad：&lt;filename&gt;"></a>5.2.2.1 olcModuleLoad：&lt;filename&gt;</h5><p>指定要加载的动态可加载模块的名称。文件名可以是绝对路径名或简单文件名。在<code>olcModulePath</code>指令指定的目录中搜索非绝对名称。</p>
<h5 id="5-2-2-2-olcModulePath-lt-pathspec-gt"><a href="#5-2-2-2-olcModulePath-lt-pathspec-gt" class="headerlink" title="5.2.2.2 olcModulePath: &lt;pathspec&gt;"></a>5.2.2.2 olcModulePath: &lt;pathspec&gt;</h5><p>指定要加载的动态可加载模块的名称。文件名可以是绝对路径名或简单文件名。在<code>olcModulePath</code>指令指定的目录中搜索非绝对名称。</p>
<h5 id="5-2-2-3-条目样例"><a href="#5-2-2-3-条目样例" class="headerlink" title="5.2.2.3 条目样例"></a>5.2.2.3 条目样例</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=module&#123;0&#125;,cn=config</span><br><span class="line">objectClass: olcModuleList</span><br><span class="line">cn: module&#123;0&#125;</span><br><span class="line">olcModuleLoad: /usr/local/lib/smbk5pwd.la</span><br><span class="line"></span><br><span class="line">dn: cn=module&#123;1&#125;,cn=config</span><br><span class="line">objectClass: olcModuleList</span><br><span class="line">cn: module&#123;1&#125;</span><br><span class="line">olcModulePath: /usr/local/lib:/usr/local/lib/slapd</span><br><span class="line">olcModuleLoad: accesslog.la</span><br><span class="line">olcModuleLoad: pcache.la</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-cn-schema"><a href="#5-2-3-cn-schema" class="headerlink" title="5.2.3 cn=schema"></a>5.2.3 cn=schema</h4><p><code>cn=schema</code> 条目包含在slapd中硬编码的所有模式定义。因此，此条目中的值由slapd生成，因此在配置文件中不需要提供模式值。仍然必须定义该条目，以作为用户定义的模式添加到底部的基础。模式条目必须具有<code>olcSchemaConfig objectClass</code>。</p>
<h5 id="5-2-3-1-olcAttributeTypes"><a href="#5-2-3-1-olcAttributeTypes" class="headerlink" title="5.2.3.1 olcAttributeTypes"></a>5.2.3.1 olcAttributeTypes</h5><p>&lt;<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4512.txt">RFC4512</a> Attribute Type Description&gt;</p>
<p>此指令定义属性类型。有关如何使用此指令的信息，请参阅“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/schema.html">模式规范”</a>一章。</p>
<h5 id="5-2-3-2-olcObjectClasses"><a href="#5-2-3-2-olcObjectClasses" class="headerlink" title="5.2.3.2 olcObjectClasses"></a>5.2.3.2 olcObjectClasses</h5><p>&lt;<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4512.txt">RFC4512</a> Object Class Description&gt;</p>
<p>该指令定义了一个对象类。有关如何使用此指令的信息，请参阅“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/schema.html">模式规范”</a>一章。</p>
<h5 id="5-2-3-3-条目样例"><a href="#5-2-3-3-条目样例" class="headerlink" title="5.2.3.3 条目样例"></a>5.2.3.3 条目样例</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=schema,cn=config</span><br><span class="line">objectClass: olcSchemaConfig</span><br><span class="line">cn: schema</span><br><span class="line"></span><br><span class="line">dn: cn=test,cn=schema,cn=config</span><br><span class="line">objectClass: olcSchemaConfig</span><br><span class="line">cn: test</span><br><span class="line">olcAttributeTypes: ( 1.1.1</span><br><span class="line">  NAME &#x27;testAttr&#x27;</span><br><span class="line">  EQUALITY integerMatch</span><br><span class="line">  SYNTAX 1.3.6.1.4.1.1466.115.121.1.27 )</span><br><span class="line">olcAttributeTypes: ( 1.1.2 NAME &#x27;testTwo&#x27; EQUALITY caseIgnoreMatch</span><br><span class="line">  SUBSTR caseIgnoreSubstringsMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.44 )</span><br><span class="line">olcObjectClasses: ( 1.1.3 NAME &#x27;testObject&#x27;</span><br><span class="line">  MAY ( testAttr $ testTwo ) AUXILIARY )</span><br></pre></td></tr></table></figure>

<h4 id="5-2-4-后端特定指令"><a href="#5-2-4-后端特定指令" class="headerlink" title="5.2.4 后端特定指令"></a>5.2.4 后端特定指令</h4><p>后端指令适用于所有相同类型的数据库实例，根据该指令，数据库指令可能会被覆盖。后端条目必须具有<code>olcBackendConfig objectClass</code>。</p>
<h5 id="5-2-4-1-olcBackend-lt-type-gt"><a href="#5-2-4-1-olcBackend-lt-type-gt" class="headerlink" title="5.2.4.1 olcBackend: &lt;type&gt;"></a>5.2.4.1 olcBackend: &lt;type&gt;</h5><p>该指令命名后端特定的配置条目。<code>&lt;type&gt;</code>应于表5.2中列出的支持的后端类型之一。</p>
<p><strong>表5.2：数据库后端:</strong></p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>bdb</td>
<td>Berkeley DB事务后端（已弃用）</td>
</tr>
<tr>
<td>config</td>
<td>Slapd配置后端</td>
</tr>
<tr>
<td>dnssrv</td>
<td>DNS SRV后端</td>
</tr>
<tr>
<td>hdb</td>
<td>bdb后端的分层变体（已弃用）</td>
</tr>
<tr>
<td>ldap</td>
<td>轻量级目录访问协议（Proxy）后端</td>
</tr>
<tr>
<td>ldif</td>
<td>轻量级数据交换格式后端</td>
</tr>
<tr>
<td>mdb</td>
<td>内存映射DB后端</td>
</tr>
<tr>
<td>meta</td>
<td>元目录后端</td>
</tr>
<tr>
<td>monitor</td>
<td>监视后端</td>
</tr>
<tr>
<td>passwd</td>
<td>提供对<em>passwd的</em>只读访问（5）</td>
</tr>
<tr>
<td>perl</td>
<td>Perl可编程后端</td>
</tr>
<tr>
<td>shell</td>
<td>Shell（外部程序）后端</td>
</tr>
<tr>
<td>sql</td>
<td>SQL可编程后端</td>
</tr>
</tbody></table>
<p><strong>例：</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcBackend：bdb</span><br></pre></td></tr></table></figure>

<p>没有为此条目定义其他指令。特定的后端类型可以为其特定用途定义附加属性，但是迄今为止还没有定义。因此，这些指令通常不会出现在任何实际配置中。</p>
<h5 id="5-2-4-2-条目样例"><a href="#5-2-4-2-条目样例" class="headerlink" title="5.2.4.2 条目样例"></a>5.2.4.2 条目样例</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dn：olcBackend=bdb，cn=config</span><br><span class="line">objectClass:olcBackendConfig</span><br><span class="line">olcBackend:bdb</span><br></pre></td></tr></table></figure>

<h4 id="5-2-5-数据库特定的指令"><a href="#5-2-5-数据库特定的指令" class="headerlink" title="5.2.5 数据库特定的指令"></a>5.2.5 数据库特定的指令</h4><p>每个类型的数据库都支持本节中的指令。数据库条目必须具有<code>olcDatabaseConfig objectClass</code>。</p>
<h5 id="5-2-5-1-olcDatabase-lt-index-gt-lt-type-gt"><a href="#5-2-5-1-olcDatabase-lt-index-gt-lt-type-gt" class="headerlink" title="5.2.5.1 olcDatabase: [{&lt;index&gt;}]&lt;type&gt;"></a>5.2.5.1 olcDatabase: [{&lt;index&gt;}]&lt;type&gt;</h5><p>该指令命名一个特定的数据库实例。可以提供数字<code>&#123;&lt;index&gt;&#125;</code>来区分相同类型的多个数据库。通常可以省略索引，slapd将自动生成。<code>&lt;type&gt;</code>应于表5.2或列出的支持的后端类型之一<code>前端</code>类型。</p>
<p>该<code>前端</code>是用来保存应适用于所有其他数据库的数据库级选项一个特殊的数据库。后续数据库定义也可以覆盖一些前端设置。</p>
<p>在配置数据库也是特殊的; 无论是<code>配置</code>和<code>前端</code>数据库总是隐式创建的，即使他们没有明确配置，以及它们的任何其他数据库之前创建。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDatabase: bdb</span><br></pre></td></tr></table></figure>

<p>这标志着一个新的开始 BDB 数据库实例。</p>
<h5 id="5-2-5-2-olcAccess"><a href="#5-2-5-2-olcAccess" class="headerlink" title="5.2.5.2 olcAccess"></a>5.2.5.2 olcAccess</h5><p>: to &lt;what&gt; [ by &lt;who&gt; [&lt;accesslevel&gt;] [&lt;control&gt;] ]+</p>
<p>该指令通过一个或多个请求者（由&lt;who&gt;指定）向一组条目和/或属性（由&lt;what&gt;指定）访问（由&lt;accesslevel&gt;指定）。有关基本用途，请参阅本指南的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/access-control.html">访问控制</a>部分。</p>
<p><strong>注意：</strong>如果没有指定<code>olcAccess</code>指令，默认访问控制策略（<code>* by * read</code>）允许所有用户（通过身份验证和匿名）读取访问权限。</p>
<p><strong>注意：</strong>在前端定义的访问控件附加到所有其他数据库的控件。</p>
<h5 id="5-2-5-3-olcReadonly-TRUE-FALSE"><a href="#5-2-5-3-olcReadonly-TRUE-FALSE" class="headerlink" title="5.2.5.3 olcReadonly { TRUE | FALSE }"></a>5.2.5.3 olcReadonly { TRUE | FALSE }</h5><p>该指令将数据库置于“只读”模式。任何修改数据库的尝试将返回“不愿意执行”的错误。如果设置在消费者身上，syncrepl发送的修改仍然会发生。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcReadonly：FALSE</span><br></pre></td></tr></table></figure>

<h5 id="5-2-5-4-olcRootDN-lt-DN-gt"><a href="#5-2-5-4-olcRootDN-lt-DN-gt" class="headerlink" title="5.2.5.4 olcRootDN: &lt;DN&gt;"></a>5.2.5.4 olcRootDN: &lt;DN&gt;</h5><p>此指令指定不受该数据库操作的访问控制或管理限制限制的DN。DN不需要引用此数据库中的条目，甚至不在目录中。DN可以指SASL身份。</p>
<p>基于入门的示例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcRootDN: &quot;cn=Manager,dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>基于SASL的示例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcRootDN: &quot;uid=root,cn=example.com,cn=digest-md5,cn=auth&quot;</span><br></pre></td></tr></table></figure>

<p>有关<a href="%5Bhttps://www.openldap.org/doc/admin24/sasl.html#SASL%20Authentication%5D(https://www.openldap.org/doc/admin24/sasl.html#SASL%20Authentication)">SASL认证身份</a>的信息，<br>请参阅<a href="%5Bhttps://www.openldap.org/doc/admin24/sasl.html#SASL%20Authentication%5D(https://www.openldap.org/doc/admin24/sasl.html#SASL%20Authentication)">SASL认证</a>部分。</p>
<h5 id="5-2-5-5-olcRootPW-lt-password-gt"><a href="#5-2-5-5-olcRootPW-lt-password-gt" class="headerlink" title="5.2.5.5 olcRootPW: &lt;password&gt;"></a>5.2.5.5 olcRootPW: &lt;password&gt;</h5><p>该指令可用于为rootdn指定DN的密码（当rootdn设置为数据库中的DN时）。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcRootPW: secret</span><br></pre></td></tr></table></figure>

<p>还允许在<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc2307.txt">RFC2307</a>表单中提供密码的散列。 <em>slappasswd</em>（8）可用于生成密码哈希。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcRootPW: &#123;SSHA&#125;ZKKuqbEKJfKSXhUbHG3fG8MDn9j1v4QN</span><br></pre></td></tr></table></figure>

<p>散列是使用命令<code>slappasswd -s secret</code>生成的。</p>
<h5 id="5-2-5-6-olcSizeLimit-lt-integer-gt"><a href="#5-2-5-6-olcSizeLimit-lt-integer-gt" class="headerlink" title="5.2.5.6 olcSizeLimit: &lt;integer&gt;"></a>5.2.5.6 olcSizeLimit: &lt;integer&gt;</h5><p>此指令指定从搜索操作返回的最大条目数。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcSizeLimit: 500</span><br></pre></td></tr></table></figure>

<p>关详细信息，请参阅本指南的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/limits.html">“限制”</a>部分和slapd-config（5）。</p>
<h5 id="5-2-5-7-olcSuffix-lt-dn-suffix-gt"><a href="#5-2-5-7-olcSuffix-lt-dn-suffix-gt" class="headerlink" title="5.2.5.7 olcSuffix: &lt;dn suffix&gt;"></a>5.2.5.7 olcSuffix: &lt;dn suffix&gt;</h5><p>此指令指定将传递给此后端数据库的查询的DN后缀。可以给出多个后缀行，并且每个数据库定义通常需要至少一个。（一些后端类型，如<code>前端</code>和<code>监视器</code>使用硬编码后缀，可能不会在配置中被覆盖。）</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcSuffix：&quot;dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>以<code>dc=example,dc=com</code>结尾的DN的查询将传递给此后端。</p>
<p><strong>注意：</strong></p>
<p>当选择要传递查询的后端时，slapd按照配置顺序查看每个数据库定义中的后缀值。因此，如果一个数据库后缀是另一个数据库后缀，则必须在配置中显示。</p>
<h5 id="5-2-5-8-olcSyncrepl"><a href="#5-2-5-8-olcSyncrepl" class="headerlink" title="5.2.5.8. olcSyncrepl"></a>5.2.5.8. olcSyncrepl</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">olcSyncrepl: rid=&lt;replica ID&gt;</span><br><span class="line">                provider=ldap[s]://&lt;hostname&gt;[:port]</span><br><span class="line">                [type=refreshOnly|refreshAndPersist]</span><br><span class="line">                [interval=dd:hh:mm:ss]</span><br><span class="line">                [retry=[&lt;retry interval&gt; &lt;# of retries&gt;]+]</span><br><span class="line">                searchbase=&lt;base DN&gt;</span><br><span class="line">                [filter=&lt;filter str&gt;]</span><br><span class="line">                [scope=sub|one|base]</span><br><span class="line">                [attrs=&lt;attr list&gt;]</span><br><span class="line">                [attrsonly]</span><br><span class="line">                [sizelimit=&lt;limit&gt;]</span><br><span class="line">                [timelimit=&lt;limit&gt;]</span><br><span class="line">                [schemachecking=on|off]</span><br><span class="line">                [bindmethod=simple|sasl]</span><br><span class="line">                [binddn=&lt;DN&gt;]</span><br><span class="line">                [saslmech=&lt;mech&gt;]</span><br><span class="line">                [authcid=&lt;identity&gt;]</span><br><span class="line">                [authzid=&lt;identity&gt;]</span><br><span class="line">                [credentials=&lt;passwd&gt;]</span><br><span class="line">                [realm=&lt;realm&gt;]</span><br><span class="line">                [secprops=&lt;properties&gt;]</span><br><span class="line">                [starttls=yes|critical]</span><br><span class="line">                [tls_cert=&lt;file&gt;]</span><br><span class="line">                [tls_key=&lt;file&gt;]</span><br><span class="line">                [tls_cacert=&lt;file&gt;]</span><br><span class="line">                [tls_cacertdir=&lt;path&gt;]</span><br><span class="line">                [tls_reqcert=never|allow|try|demand]</span><br><span class="line">                [tls_cipher_suite=&lt;ciphers&gt;]</span><br><span class="line">                [tls_crlcheck=none|peer|all]</span><br><span class="line">                [logbase=&lt;base DN&gt;]</span><br><span class="line">                [logfilter=&lt;filter str&gt;]</span><br><span class="line">                [syncdata=default|accesslog|changelog]</span><br></pre></td></tr></table></figure>

<p>该指令通过将当前的<em>slapd</em>（8）建立为运行syncrepl复制引擎的复制用户站点来将当前数据库指定为主内容的副本。主数据库位于由<code>provider</code>参数指定的复制提供程序站点。<br>使用LDAP内容同步协议，副本数据库与主内容保持最新。有关<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4533.txt">协议</a>的更多信息，请参阅<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4533.txt">RFC4533</a>。</p>
<p><code>RID</code>参数用于当前的识别<code>的syncrepl</code>复制消费者服务器内的指令，其中<code>&lt;replica ID&gt;</code>唯一地识别由当前所描述的的syncrepl规范<code>的syncrepl</code>指令。<code>&lt;replica ID&gt;</code>为非负数，长度不超过三位十进制数字。</p>
<p><code>provider</code>参数指定包含主内容作为LDAP URI复制提供者站点。<code>provider</code>参数指定的方案，主机和可选地其中该提供者的slapd实例可以发现一个端口。<br>域名或IP地址可以用于&lt;hostname&gt;。示例是<code>ldap://provider.example.com：389</code>或<code>ldaps://192.168.1.1：636</code>。如果未指定&lt;port&gt;，则使用标准LDAP端口号（389或636）。<br>请注意，syncrepl使用消费者启动的协议，因此其规范位于消费者站点，而<code>replica</code>规范位于提供者站点。<code>syncrepl</code>和<code>replica</code>指令定义了两个独立的复制机制。它们不代表彼此的复制对等体。</p>
<p>使用搜索规范作为其结果集定义syncrepl副本的内容。消费者slapd将根据搜索规范将搜索请求发送给提供商slapd。<br>搜索规范包括<code>searchbase</code>，<code>scope</code>，<code>filter</code>，<code>attrs</code>，<code>attrsonly</code>，<code>sizeLimit</code>和<code>timelimit</code>参数如在正常搜索规范。该<code>searchbase</code>参数没有默认值，<br>必须指定。的<code>scope</code>默认为<code>sub</code>中，<code>filter</code>默认为<code>（objectclass=*）</code>，<code>attrs</code>默认为<code>“*，+”</code>来复制所有用户和操作属性，<br>默认情况下，<code>attrsonly</code>未设置。双方的<code>sizeLimit</code>和<code>timelimit</code>默认为“无限制”，只有正整数或“无限制”可能被指定。</p>
<p>该 LDAP内容同步协议有两种操作类型：<code>refreshOnly</code>和<code>refreshAndPersist</code>。操作类型由<code>type</code>参数指定。在<code>refreshOnly</code>操作中，<br>在每次同步操作结束之后的间隔时间周期性地重新调度下一个同步搜索操作。间隔由<code>interval</code>参数指定。默认设置为一天。在<code>refreshAndPersist</code>操作中，<br>同步搜索在提供者<em>slapd</em>实例中保持不变。对主副本的进一步更新将生成<code>searchResultEntry</code> 到消费者slapd作为搜索响应的持续同步搜索。</p>
<p>如果在复制期间发生错误，消费者将尝试根据重试参数重新连接，该重试参数是&lt;retry interval&gt;和&lt;＃of retries&gt; 的列表。例如，<code>retry =&quot;60 10 300 3&quot;</code>可让消费者重新开始前10次，<br>每60秒重试一次，然后在停止重试之前每300秒重试三次。+在&lt;＃重试次数&gt;中意味着无限期的重试，直到成功。</p>
<p>可以通过打开<code>schemachecking</code>参数，在LDAP Sync使用者站点上强制执行模式检查。如果它被打开，则每个复制的条目将被检查其模式，因为条目存储在副本内容中。副本中的每个条目都应包含模式定义所需的属性。如果它被关闭，条目将被存储，而不检查模式一致性。默认是关闭。</p>
<p>该<code>binddn</code>参数给出了DN绑定为进行syncrepl搜索到提供者的slapd。它应该是具有对主数据库中的复制内容的读取访问权限的DN。</p>
<p>该<code>bindmethod</code>是<code>simple</code>还是<code>SASL</code>，取决于是否简单基于密码的认证或SASL连接到提供商<em>slapd</em>实例时要使用身份验证。</p>
<p>除非有足够的数据完整性和机密性保护（例如TLS或IPsec），否则不应使用简单认证。简单的身份验证需要指定<code>binddn</code>和<code>credentials</code>参数。</p>
<p>通常建议使用SASL认证。SASL身份验证需要使用<code>saslmech</code>参数来指定机制。根据机制，可以分别使用<code>authcid</code>和<code>credentials</code>来指定身份验证身份和/或凭据。所述<code>authzid</code>参数可以被用来指定一个授权身份。</p>
<p><code>realm</code>参数指定其中的某些机制认证中的身份的境界。该<code>secprops</code>参数指定Cyrus  SASL安全属性。</p>
<p>该<code>STARTTLS</code>参数指定使用扩展操作认证的供应商之前建立TLS会话启动TLS的。如果提供了<code>critical</code>参数，则如果StartTLS请求失败，则该会话将中止。<br>否则syncrepl会话继续而不使用TLS。tls_reqcert设置默认为<code>“demand”</code>，其他TLS设置默认与主slapd TLS设置相同。</p>
<p>消费者不是复制整个条目，而是可以查询数据修改的日志。这种操作模式称为<em>delta syncrepl</em>。除了上述参数之外，必须对要使用的日志适当地设置<code>logbase</code>和<code>logfilter</code>参数。<br>所述<code>syncdata</code>参数必须设置为<code>“accesslog”</code>如果日志符合<em>slapo-ACCESSLOG</em>（5）日志格式，或<code>“更改日志”</code>如果日志符合过时的<em>更改日志</em>的格式。如果<code>syncdata</code>参数被省略或设置为<code>“default”，</code>则日志参数将被忽略。</p>
<p><em>syncrepl</em> 复制机制是由支持<em>BDB</em>，<em>hdb</em>，以及 <em>mdb</em>后端。</p>
<p>有关如何使用此指令的详细信息，请参阅本指南的“ [LDAP同步复制”](<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/replication.html#LDAP%20Sync%20Replication">http://www.openldap.org/doc/admin24/replication.html#LDAP Sync Replication</a>)一章。</p>
<h5 id="5-2-5-9-olcTimeLimit-lt-integer-gt"><a href="#5-2-5-9-olcTimeLimit-lt-integer-gt" class="headerlink" title="5.2.5.9 olcTimeLimit: &lt;integer&gt;"></a>5.2.5.9 olcTimeLimit: &lt;integer&gt;</h5><p>此指令指定slapd将花费回答搜索请求的最大秒数（实时）。如果此时尚未完成请求，将返回指示超时时间的结果。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcTimeLimit: 3600</span><br></pre></td></tr></table></figure>

<p>有关详细信息，请参阅本指南的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/limits.html">“限制”</a>部分和slapd-config（5）。</p>
<h5 id="5-2-5-10-olcUpdateref-lt-URL-gt"><a href="#5-2-5-10-olcUpdateref-lt-URL-gt" class="headerlink" title="5.2.5.10 olcUpdateref: &lt;URL&gt;"></a>5.2.5.10 olcUpdateref: &lt;URL&gt;</h5><p>该指令仅适用于从属slapd。它指定返回到在副本上提交更新请求的客户端的URL。如果指定多次，每个网址 被提供。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcUpdateref: ldap://master.example.net</span><br></pre></td></tr></table></figure>

<h5 id="5-2-5-11-条目案例"><a href="#5-2-5-11-条目案例" class="headerlink" title="5.2.5.11 条目案例"></a>5.2.5.11 条目案例</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=frontend,cn=config</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">objectClass: olcFrontendConfig</span><br><span class="line">olcDatabase: frontend</span><br><span class="line">olcReadOnly: FALSE</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=config,cn=config</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">olcDatabase: config</span><br><span class="line">olcRootDN: cn=Manager,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<h4 id="5-2-6-BDB-and-HDB-Database-Directives"><a href="#5-2-6-BDB-and-HDB-Database-Directives" class="headerlink" title="5.2.6 BDB and HDB Database Directives"></a>5.2.6 BDB and HDB Database Directives</h4><p>此类别中的指令适用于 BDB 和 HDB 两个数据库。除了上面定义的通用数据库指令之外，它们还用于olcDatabase条目。有关BDB / HDB配置指令的完整参考，请参见<em>slapd-bdb</em>（5）。<br>除了<code>olcDatabaseConfig objectClass</code>之外，BDB和HDB数据库条目必须分别具有<code>olcBdbConfig</code>和<code>olcHdbConfig objectClass</code>。</p>
<h5 id="5-2-6-1-olcDbDirectory-lt-directory-gt"><a href="#5-2-6-1-olcDbDirectory-lt-directory-gt" class="headerlink" title="5.2.6.1. olcDbDirectory: &lt;directory&gt;"></a>5.2.6.1. olcDbDirectory: &lt;directory&gt;</h5><p>此伪指令指定包含数据库和关联索引的BDB文件的目录。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbDirectory: /usr/local/var/openldap-data</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-2-olcDbCachesize：-lt-integer-gt"><a href="#5-2-6-2-olcDbCachesize：-lt-integer-gt" class="headerlink" title="5.2.6.2 olcDbCachesize：&lt;integer&gt;"></a>5.2.6.2 olcDbCachesize：&lt;integer&gt;</h5><p>此指令指定由BDB后端数据库实例维护的内存中缓存条目的大小。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbCachesize: 1000</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-3-olcDbCheckpoint-lt-kbyte-gt-lt-min-gt"><a href="#5-2-6-3-olcDbCheckpoint-lt-kbyte-gt-lt-min-gt" class="headerlink" title="5.2.6.3 olcDbCheckpoint:  &lt;kbyte&gt; &lt;min&gt;"></a>5.2.6.3 olcDbCheckpoint:  &lt;kbyte&gt; &lt;min&gt;</h5><p>此指令指定检查点BDB事务日志的频率。检查点操作将数据库缓冲区刷新到磁盘，并在日志中写入检查点记录。如果已经写入了<code>&lt;kbyte&gt;</code>数据或自上次检查点起已经过了<code>&lt;min&gt;</code>分钟，则检查点将发生。两个参数默认为零，在这种情况下，它们将被忽略。当<code>&lt;min&gt;</code>参数不为零时，内部任务将每分钟运行一分钟以执行检查点。有关详细信息，请参阅Berkeley DB参考指南。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbCheckpoint: 1024 10</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-4-olcDbConfig-lt-DB-CONFIG-setting-gt"><a href="#5-2-6-4-olcDbConfig-lt-DB-CONFIG-setting-gt" class="headerlink" title="5.2.6.4 olcDbConfig: &lt;DB_CONFIG setting&gt;"></a>5.2.6.4 olcDbConfig: &lt;DB_CONFIG setting&gt;</h5><p>此属性指定要放置在数据库目录的<code>DB_CONFIG</code>文件中的配置指令。在服务器启动时，如果尚未存在此类文件，则将创建<code>DB_CONFIG</code>文件，并将此属性中的设置写入。如果文件存在，其内容将被读取并显示在此属性中。该属性是多值的，以适应多个配置指令。没有提供默认值，但是在这里使用适当的设置来获得最佳的服务器性能是至关重要的。</p>
<p>对此属性所做的任何更改都将写入<code>DB_CONFIG</code>文件，并将导致数据库环境重置，以便更改可立即生效。如果环境缓存大并且最近没有被检查点，这种重置操作可能需要很长时间。在使用LDAP修改更改此属性之前，建议您使用Berkeley DB <em>db_checkpoint</em>实用程序手动执行单个检查点。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">olcDbConfig: set_cachesize 0 10485760 0</span><br><span class="line">olcDbConfig: set_lg_bsize 2097512</span><br><span class="line">olcDbConfig: set_lg_dir /var/tmp/bdb-log</span><br><span class="line">olcDbConfig: set_flags DB_LOG_AUTOREMOVE</span><br></pre></td></tr></table></figure>

<p>在本示例中，BDB缓存设置为10MB，BDB事务日志缓冲区大小设置为2MB，并将事务日志文件存储在<code>/var/tmp/bdb-log</code>目录中。<br>另外还设置一个标志来告知BDB一旦它们的内容被检查点并且不再需要就删除事务日志文件。没有此设置，事务日志文件将继续累积，直到其他一些清除过程删除它们。<br>有关详细信息，请参见<code>db_archive</code>命令的Berkeley DB文档。有关Berkeley DB标志的完整列表，请参阅 - <a target="_blank" rel="noopener" href="http://www.oracle.com/technology/documentation/berkeley-db/db/api_c/env_set_flags.html">http://www.oracle.com/technology/documentation/berkeley-db/db/api_c/env_set_flags.html</a></p>
<p>理想情况下，BDB缓存必须至少与数据库的工作集一样大，日志缓冲区大小应足够大以适应大多数事务而不会溢出，并且日志目录必须与主数据库文件在单独的物理磁盘上。数据库目录和日志目录应与用于常规系统活动（例如根，引导或交换文件系统）的磁盘分开。有关更多详细信息，请参阅FAQ-o-Matic和Berkeley DB文档。</p>
<h5 id="5-2-6-5-olcDbNosync-TRUE-FALSE"><a href="#5-2-6-5-olcDbNosync-TRUE-FALSE" class="headerlink" title="5.2.6.5 olcDbNosync: { TRUE | FALSE }"></a>5.2.6.5 olcDbNosync: { TRUE | FALSE }</h5><p>此选项会导致磁盘数据库内容在更改时不会立即与内存更改同步。将此选项设置为<code>TRUE</code>可能会牺牲数据完整性来提高性能。该指令与使用具有相同的效果</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbConfig: set_flags DB_TXN_NOSYNC</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-6-olcDbIDLcacheSize：-lt-integer-gt"><a href="#5-2-6-6-olcDbIDLcacheSize：-lt-integer-gt" class="headerlink" title="5.2.6.6 olcDbIDLcacheSize：&lt;integer&gt;"></a>5.2.6.6 olcDbIDLcacheSize：&lt;integer&gt;</h5><p>在索引插槽中指定内存中索引缓存的大小。默认值为零。较大的值将加快索引条目的频繁搜索。最佳大小将取决于数据库的数据和搜索特性，但使用三倍的条目缓存大小是一个很好的起点。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbIDLcacheSize: 3000</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-7-olcDbIndex-lt-attrlist-gt-default-pres-eq-approx-sub-none"><a href="#5-2-6-7-olcDbIndex-lt-attrlist-gt-default-pres-eq-approx-sub-none" class="headerlink" title="5.2.6.7 olcDbIndex: {&lt;attrlist&gt; | default} [pres,eq,approx,sub,none]"></a>5.2.6.7 olcDbIndex: {&lt;attrlist&gt; | default} [pres,eq,approx,sub,none]</h5><p>该指令指定为给定属性维护的索引。如果只给出一个<code>&lt;attrlist&gt;</code>，则会保留默认索引。索引关键字对应于可在LDAP搜索过滤器中使用的常见匹配类型。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">olcDbIndex: default pres,eq</span><br><span class="line">olcDbIndex: uid</span><br><span class="line">olcDbIndex: cn,sn pres,eq,sub</span><br><span class="line">olcDbIndex: objectClass eq</span><br></pre></td></tr></table></figure>

<p>第一行设置默认的索引集，以保持呈现和相等。第二行导致为<code>uid</code>属性类型维护默认（pres，eq）索引集。第三行导致为<code>cn</code>和<code>sn</code>属性类型维护当前，等于和子字符串索引。第四行导致<code>objectClass</code>属性类型的相等索引。</p>
<p>不等式匹配没有索引关键字。通常这些匹配不使用索引。然而，一些属性确实支持基于等式索引的不等式匹配的索引。</p>
<p>子串的索引可以更明确地指定为<code>subinitial</code>，<code>subany</code>，或<code>subfinal</code>，对应于字符串匹配滤波器的三种可能的组分。一个小数中间索引仅索引出现在属性值开头的子字符串。子索引仅索引出现在属性值末尾的子字符串，而子索引则会在值中任何位置发生子字符串索引。</p>
<p>请注意，默认情况下，为属性设置索引也会影响该属性的每个子类型。例如，在<code>name</code>属性上设置一个相等的索引会导致<code>cn</code>，<code>sn</code>和从<code>name</code>继承的每个其他属性被索引。</p>
<p>缺省情况下，没有维护索引。通常建议保持对象类的最小等同索引。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbindex: objectClass eq</span><br></pre></td></tr></table></figure>

<p>应根据在数据库中使用的最常见的搜索来配置其他索引。除非属性在数据库中很少出现，否则不应为属性配置存在索引，并且在正常使用目录期间，属性上的出现搜索会非常频繁地出现。大多数应用程序不使用存在搜索，因此通常存在索引不是很有用。</p>
<p>如果slapd运行时此设置发生更改，则将运行内部任务以生成已更改的索引数据。所有的服务器操作都能像索引器一样正常工作。如果在索引任务完成之前slapd已停止，则索引将必须使用slapindex工具手动完成。</p>
<h5 id="5-2-6-8-olcDbLinearIndex-TRUE-FALSE"><a href="#5-2-6-8-olcDbLinearIndex-TRUE-FALSE" class="headerlink" title="5.2.6.8 olcDbLinearIndex: { TRUE | FALSE }"></a>5.2.6.8 olcDbLinearIndex: { TRUE | FALSE }</h5><p>如果此设置为<code>TRUE</code>， slapindex将一次为一个属性索引。默认设置为<code>FALSE</code>，在这种情况下，条目的所有索引属性都将同时处理。启用时，每个索引属性都被单独处理，使用遍历整个数据库的多次遍历。当数据库大小超过BDB缓存大小时，此选项可提高slapindex性能。当BDB缓存足够大时，不需要此选项并降低性能。同样默认情况下，slapadd执行完整的索引，因此不需要单独的slapindex运行。使用此选项，slapadd不进行索引编译，并且必须使用slapindex。</p>
<h5 id="5-2-6-9-olcDbMode-lt-octal-gt-lt-symbolic-gt"><a href="#5-2-6-9-olcDbMode-lt-octal-gt-lt-symbolic-gt" class="headerlink" title="5.2.6.9 olcDbMode: { &lt;octal&gt; | &lt;symbolic&gt; }"></a>5.2.6.9 olcDbMode: { &lt;octal&gt; | &lt;symbolic&gt; }</h5><p>此指令指定新创建的数据库索引文件应具有的文件保护模式。这可以是<code>0600</code>或<code>-rw -------</code></p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbMode：0600</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-10-olcDbSearchStack-lt-integer-gt"><a href="#5-2-6-10-olcDbSearchStack-lt-integer-gt" class="headerlink" title="5.2.6.10 olcDbSearchStack: &lt;integer&gt;"></a>5.2.6.10 olcDbSearchStack: &lt;integer&gt;</h5><p>指定用于搜索过滤器评估的堆栈的深度。搜索过滤器在堆栈中进行评估，以适应嵌套的<code>AND</code> /<code>OR</code>条款。为每个服务器线程分配单个堆栈。堆栈的深度决定了如何复杂的过滤器可以被评估，而不需要额外的内存分配。比搜索堆栈深度嵌套的过滤器将导致为该特定搜索操作分配单独的堆栈。这些单独的分配可能对服务器性能造成严重的负面影响，但是指定太多堆栈也将消耗大量内存。每个搜索在32位计算机上每级使用512K字节，或64位计算机上每级的1024K字节。默认堆栈深度为16，因此在32位和64位机器上分别使用每个线程8MB或16MB。同样512KB大小的单个堆栈槽由编译时常数设置，如果需要可以更改;</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbSearchStack: 16</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-11-olcDbShmKey-lt-integer-gt"><a href="#5-2-6-11-olcDbShmKey-lt-integer-gt" class="headerlink" title="5.2.6.11 olcDbShmKey: &lt;integer&gt;"></a>5.2.6.11 olcDbShmKey: &lt;integer&gt;</h5><p>指定共享内存BDB环境的密钥。默认情况下，BDB环境使用内存映射文件。如果指定了非零值，它将被用作标识将容纳环境的共享内存区域的键。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcDbShmKey: 42</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6-12-输出样例"><a href="#5-2-6-12-输出样例" class="headerlink" title="5.2.6.12 输出样例"></a>5.2.6.12 输出样例</h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=hdb,cn=config</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">objectClass: olcHdbConfig</span><br><span class="line">olcDatabase: hdb</span><br><span class="line">olcSuffix: &quot;dc=example,dc=com&quot;</span><br><span class="line">olcDbDirectory: /usr/local/var/openldap-data</span><br><span class="line">olcDbCacheSize: 1000</span><br><span class="line">olcDbCheckpoint: 1024 10</span><br><span class="line">olcDbConfig: set_cachesize 0 10485760 0</span><br><span class="line">olcDbConfig: set_lg_bsize 2097152</span><br><span class="line">olcDbConfig: set_lg_dir /var/tmp/bdb-log</span><br><span class="line">olcDbConfig: set_flags DB_LOG_AUTOREMOVE</span><br><span class="line">olcDbIDLcacheSize: 3000</span><br><span class="line">olcDbIndex: objectClass eq</span><br></pre></td></tr></table></figure>

<h3 id="5-3-配置举例"><a href="#5-3-配置举例" class="headerlink" title="5.3 配置举例"></a>5.3 配置举例</h3><p>以下是一个示例配置，散布说明文字。它定义了两个数据库来处理不同的部分X.500树; 两者都是BDB数据库实例。显示的行号仅供参考，不包括在实际文件中。首先，全局配置部分：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.    # example config file - global configuration entry</span><br><span class="line">2.    dn: cn=config</span><br><span class="line">3.    objectClass: olcGlobal</span><br><span class="line">4.    cn: config</span><br><span class="line">5.    olcReferral: ldap://root.openldap.org</span><br><span class="line">6.</span><br></pre></td></tr></table></figure>

<p>第1行是一条评论。第2-4行将其标识为全局配置条目。第5行上的<code>olcReferral：</code>指令意味着不属于下面定义的数据库之一的查询将被引用到在主机<code>root.openldap.org</code>上的标准端口（389）上运行的LDAP服务器。第6行是空白行，表示此条目的结尾。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 7.    # internal schema</span><br><span class="line"> 8.    dn: cn=schema,cn=config</span><br><span class="line"> 9.    objectClass: olcSchemaConfig</span><br><span class="line">10.    cn: schema</span><br><span class="line">11.</span><br></pre></td></tr></table></figure>

<p>第7行是一条评论。第8-10行将此标识为模式子树的根。此条目中的实际模式定义将被硬编码为slapd，因此在此处未指定其他属性。第11行是空白行，表示此条目的结尾。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">12.    # include the core schema</span><br><span class="line">13.    include: file:///usr/local/etc/openldap/schema/core.ldif</span><br><span class="line">14.</span><br></pre></td></tr></table></figure>

<p>第12行是一条评论。第13行是以LDIF格式访问<em>核心</em>模式定义的LDIF include指令。第14行是空行。</p>
<p>接下来是数据库定义。第一个数据库是其全局应用于所有其他数据库的特殊<code>前端</code>数据库。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">15.    # global database parameters</span><br><span class="line">16.    dn: olcDatabase=frontend,cn=config</span><br><span class="line">17.    objectClass: olcDatabaseConfig</span><br><span class="line">18.    olcDatabase: frontend</span><br><span class="line">19.    olcAccess: to * by * read</span><br><span class="line">20.</span><br></pre></td></tr></table></figure>

<p>第15行是一条评论。第16-18行将此条目标识为全局数据库条目。第19行是一个全局访问控制。它适用于所有条目（在任何适用的特定于数据库的访问控制之后）。第20行是空行。</p>
<p>下一个条目定义了配置后端。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">21.    # set a rootpw for the config database so we can bind.</span><br><span class="line">22.    # deny access to everyone else.</span><br><span class="line">23.    dn: olcDatabase=config,cn=config</span><br><span class="line">24.    objectClass: olcDatabaseConfig</span><br><span class="line">25.    olcDatabase: config</span><br><span class="line">26.    olcRootPW: &#123;SSHA&#125;XKYnrjvGT3wZFQrDD5040US592LxsdLy</span><br><span class="line">27.    olcAccess: to * by * none</span><br><span class="line">28.</span><br></pre></td></tr></table></figure>

<p>第21-22行是评论。第23-25行将此条目标识为配置数据库条目。第26行定义了该数据库的<em>超级用户</em>密码。（DN默认为<em>“cn = config”</em>。）第27行拒绝对该数据库的所有访问，因此只有超级用户才能访问该数据库。（这已经是配置数据库中的默认访问权限，这里只是列出了说明，并且重申，除非明确配置超级用户身份验证的方式，否则配置数据库将无法访问。）</p>
<p>第28行是空行。</p>
<p>下一个条目定义了一个BDB后端，它将处理对树的“dc = example，dc = com”部分中的事物的查询。指数将被维护为几个属性，并且<code>userPassword</code>属性被保护免受未经授权的访问。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">29.    # BDB definition for example.com</span><br><span class="line">30.    dn: olcDatabase=bdb,cn=config</span><br><span class="line">31.    objectClass: olcDatabaseConfig</span><br><span class="line">32.    objectClass: olcBdbConfig</span><br><span class="line">33.    olcDatabase: bdb</span><br><span class="line">34.    olcSuffix: dc=example,dc=com</span><br><span class="line">35.    olcDbDirectory: /usr/local/var/openldap-data</span><br><span class="line">36.    olcRootDN: cn=Manager,dc=example,dc=com</span><br><span class="line">37.    olcRootPW: secret</span><br><span class="line">38.    olcDbIndex: uid pres,eq</span><br><span class="line">39.    olcDbIndex: cn,sn pres,eq,approx,sub</span><br><span class="line">40.    olcDbIndex: objectClass eq</span><br><span class="line">41.    olcAccess: to attrs=userPassword</span><br><span class="line">42.      by self write</span><br><span class="line">43.      by anonymous auth</span><br><span class="line">44.      by dn.base=&quot;cn=Admin,dc=example,dc=com&quot; write</span><br><span class="line">45.      by * none</span><br><span class="line">46.    olcAccess: to *</span><br><span class="line">47.      by self write</span><br><span class="line">48.      by dn.base=&quot;cn=Admin,dc=example,dc=com&quot; write</span><br><span class="line">49.      by * read</span><br></pre></td></tr></table></figure>

<p>第29行是一条评论。30-33行将此条目标识为BDB数据库配置条目。第34行指定查询传递给此数据库的DN后缀。第35行指定数据库文件将在其中生存的目录。</p>
<p>36和37行标识数据库<em>超级用户</em>条目和相关密码。此条目不受访问控制或大小或时间限制的限制。</p>
<p>第38至40行表示维持各种属性的索引。</p>
<p>第41至49行为此数据库中的条目指定访问控制。对于所有适用的条目，<code>userPassword</code>属性可由条目本身和“admin”条目写入。它可以用于认证/授权目的，但是不可读。所有其他属性可由条目和“admin”条目写入，但可由所有用户（经过身份验证或不被认证）读取。</p>
<p>第50行是空白行，表示此条目的结尾。</p>
<p>下一个条目定义另一个BDB数据库。这个处理涉及<code>dc=example,dc=net</code> subtree的查询，但是由与第一个数据库相同的实体进行管理。请注意，没有第60行，由于第19行的全局访问规则，读访问将被允许。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">51.    # BDB definition for example.net</span><br><span class="line">52.    dn: olcDatabase=bdb,cn=config</span><br><span class="line">53.    objectClass: olcDatabaseConfig</span><br><span class="line">54.    objectClass: olcBdbConfig</span><br><span class="line">55.    olcDatabase: bdb</span><br><span class="line">56.    olcSuffix: &quot;dc=example,dc=net&quot;</span><br><span class="line">57.    olcDbDirectory: /usr/local/var/openldap-data-net</span><br><span class="line">58.    olcRootDN: &quot;cn=Manager,dc=example,dc=com&quot;</span><br><span class="line">59.    olcDbIndex: objectClass eq</span><br><span class="line">60.    olcAccess: to * by users read</span><br></pre></td></tr></table></figure>

<h3 id="5-4-将旧样式slapd-conf（5）文件转换为cn-config格式"><a href="#5-4-将旧样式slapd-conf（5）文件转换为cn-config格式" class="headerlink" title="5.4 将旧样式slapd.conf（5）文件转换为cn=config格式"></a>5.4 将旧样式<em>slapd.conf</em>（5）文件转换为<em>cn=config</em>格式</h3><p>在转换为<em>cn=config</em>格式之前，您应该确保配置后端在您现有的配置文件中正确配置。虽然配置后端始终存在于slapd内，但默认情况下只能由其rootDN访问，并且没有分配默认凭据，除非您明确配置一种认证方式，否则将无法使用。</p>
<p>如果您还没有<code>database config</code>部分，请在<code>slapd.conf</code>的末尾添加如下内容</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">database config</span><br><span class="line">rootpw VerySecret</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>由于配置后端可用于将任意代码加载到slapd进程中，因此仔细保护用于访问它的任何凭据是非常重要的。由于简单的密码容易受到密码猜测攻击，通常最好省略rootpw，只能使用SASL身份验证配置rootDN。</p>
<p>现有的<em>slapd.conf</em>（5）文件可以使用<em>slaptest</em>（8）或任何照片工具转换为新格式：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaptest -f /usr/local/etc/openldap/slapd.conf -F /usr/local/etc/openldap/slapd.d</span><br></pre></td></tr></table></figure>

<p>测试您可以使用默认<em>rootdn</em>和<em>上面</em>配置的<em>rootpw</em>访问<code>cn=config</code>下的条目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -D cn=config -w VerySecret -b cn=config</span><br></pre></td></tr></table></figure>

<p>然后可以丢弃旧的<em>slapd.conf</em>（5）文件。如果不使用默认目录路径，请确保使用*-F<em>选项启动</em>slapd*（8）以指定配置目录。</p>
<p><strong>注意：</strong>从slapd.conf格式转换为slapd.d格式时，任何包含的文件也将集成到生成的配置数据库中。</p>
<h2 id="6-slapd配置文件"><a href="#6-slapd配置文件" class="headerlink" title="6 slapd配置文件"></a>6 slapd配置文件</h2><p>本章介绍通过<em>slapd.conf</em>（5）配置文件配置<em>slapd</em>（8）。 <em>slapd.conf</em>（5）已被弃用，只有当您的站点需要尚未更新的后台之一才能使用较新的<em>slapd-config</em>（5）系统时，才能使用它。在上一章中介绍了通过<em>slapd-config</em>（5）配置<em>slapd</em>（8）。</p>
<p><em>slapd.conf</em>（5）文件通常安装在<code>/usr/local/etc/openldap</code> 目录。可以通过命令行选项将备用配置文件位置指定为<em>slapd</em>（8）。</p>
<h3 id="6-1-配置文件格式"><a href="#6-1-配置文件格式" class="headerlink" title="6.1 配置文件格式"></a>6.1 配置文件格式</h3><p>在<em>slapd.conf</em>（5）文件由三种类型的配置信息：全局的，特定后台和特定数据库的。首先指定全局信息，然后指定与特定后端类型相关联的信息，然后跟随特定数据库实例关联的信息。可以在后端和 / 或数据库指令中覆盖全局伪指令，并且数据库伪指令可以覆盖后端伪指令。</p>
<p>以“<code>＃</code> ”字符开头的空行和注释行将被忽略。如果一行以空格开头，则被认为是上一行的延续（即使上一行是注释）。</p>
<p>slapd.conf的一般格式如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># global configuration directives</span><br><span class="line">&lt;global config directives&gt;</span><br><span class="line"></span><br><span class="line"># backend definition</span><br><span class="line">backend &lt;typeA&gt;</span><br><span class="line">&lt;backend-specific directives&gt;</span><br><span class="line"></span><br><span class="line"># first database definition &amp; config directives</span><br><span class="line">database &lt;typeA&gt;</span><br><span class="line">&lt;database-specific directives&gt;</span><br><span class="line"></span><br><span class="line"># second database definition &amp; config directives</span><br><span class="line">database &lt;typeB&gt;</span><br><span class="line">&lt;database-specific directives&gt;</span><br><span class="line"></span><br><span class="line"># second database definition &amp; config directives</span><br><span class="line">database &lt;typeA&gt;</span><br><span class="line">&lt;database-specific directives&gt;</span><br><span class="line"></span><br><span class="line"># subsequent backend &amp; database definitions &amp; config directives</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>配置指令可能会引用参数。如果是这样，他们被空白分隔开来。如果一个参数包含空格，参数应该用双引号括起来<code>“像这样”</code>。如果参数包含双引号或反斜杠字符“<code>\</code> ”，则该字符前面应该有一个反斜杠字符“<code>\</code> ”。</p>
<p>该分发包含将安装在<code>/usr/local/etc/openldap</code>目录中的示例配置文件。<code>/usr/local/etc/openldap/schema</code>目录中也提供了一些包含模式定义（属性类型和对象类）的文件。</p>
<h3 id="6-2-配置文件指令"><a href="#6-2-配置文件指令" class="headerlink" title="6.2 配置文件指令"></a>6.2 配置文件指令</h3><p>本节详细介绍常用的配置指令。有关完整列表，请参阅<em>slapd.conf</em>（5）手册页。本节将配置文件指令分为全局，后端特定和特定于数据的类别，描述每个指令及其默认值（如果有），并给出其使用示例。</p>
<h4 id="6-2-1-全局指令"><a href="#6-2-1-全局指令" class="headerlink" title="6.2.1 全局指令"></a>6.2.1 全局指令</h4><p>本节中描述的指令适用于所有后端和数据库，除非在后端或数据库定义中特别覆盖。应该用实际文本替换的参数显示在括号<code>&lt;&gt;</code>中。</p>
<h5 id="6-2-1-1-access-to"><a href="#6-2-1-1-access-to" class="headerlink" title="6.2.1.1 access to"></a>6.2.1.1 access to</h5><p>[ by &lt;who&gt; [&lt;accesslevel&gt;] [&lt;control&gt;] ]+</p>
<p>该指令通过一个或多个请求者（由&lt;who&gt;指定）向一组条目和/或属性（由&lt;what&gt;指定）访问（由&lt;accesslevel&gt;指定）。有关基本用途，请参阅本指南的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/access-control.html">访问控制</a>部分。</p>
<p><strong>注意：</strong>如果没有指定<code>访问</code>指令，则默认访问控制策略<code>access to * by * read</code>，允许所有身份验证和匿名用户都可以读取访问权限。</p>
<h4 id="6-2-1-2-attributetype-lt"><a href="#6-2-1-2-attributetype-lt" class="headerlink" title="6.2.1.2 attributetype &lt;"></a>6.2.1.2 attributetype &lt;</h4><p><a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4512.txt">RFC4512</a> Attribute Type Description&gt;</p>
<p>此指令定义属性类型。有关如何使用此指令的信息，请参阅“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/schema.html">模式规范”</a>一章</p>
<h4 id="6-2-1-3-idletimeout-lt-integer-gt"><a href="#6-2-1-3-idletimeout-lt-integer-gt" class="headerlink" title="6.2.1.3 idletimeout &lt;integer&gt;"></a>6.2.1.3 idletimeout &lt;integer&gt;</h4><p>指定强制关闭空闲客户端连接之前等待的秒数。idletimeout为0，默认值为禁用此功能。</p>
<h4 id="6-2-1-4-include-lt-filename-gt"><a href="#6-2-1-4-include-lt-filename-gt" class="headerlink" title="6.2.1.4 include &lt;filename&gt;"></a>6.2.1.4 include &lt;filename&gt;</h4><p>该指令指定slapd应该在继续当前文件的下一行之前从给定文件中读取其他配置信息。包含的文件应遵循正常的slapd配置文件格式。该文件通常用于包含包含模式规范的文件。</p>
<p><strong>注意：</strong>使用这个指令时应该小心 - 嵌套的include指令的数量没有很小的限制，没有进行环路检测。</p>
<h4 id="6-2-1-5-loglevel-lt-level-gt"><a href="#6-2-1-5-loglevel-lt-level-gt" class="headerlink" title="6.2.1.5. loglevel &lt;level&gt;"></a>6.2.1.5. loglevel &lt;level&gt;</h4><p>此指令指定调试语句和操作统计信息应该被syslog的级别（当前记录到<em>syslogd</em>（8）<code>LOG_LOCAL4</code>设施）。您必须配置OpenLDAP<code>--enable-debug</code>（默认值）才能工作（除了始终启用的两个统计级别之外）。日志级别可以被指定为整数或关键字。可以使用多个日志级别，并且级别是相加的。要显示什么号码对应于什么样的调试，用<code>-d?</code>调用slapd 或查阅下表。&lt;integer&gt;的可能值为：</p>
<p><strong>表6.1：调试级别:</strong></p>
<table>
<thead>
<tr>
<th><strong>水平</strong></th>
<th><strong>描述</strong></th>
<th><strong>关键词</strong></th>
</tr>
</thead>
<tbody><tr>
<td>-1</td>
<td>启用所有调试</td>
<td>任何</td>
</tr>
<tr>
<td>0</td>
<td>没有调试</td>
<td></td>
</tr>
<tr>
<td>1</td>
<td>跟踪函数调用</td>
<td>（0x1跟踪）</td>
</tr>
<tr>
<td>2</td>
<td>调试数据包处理</td>
<td>（0x2数据包）</td>
</tr>
<tr>
<td>4</td>
<td>重调查</td>
<td>（0x4 args）</td>
</tr>
<tr>
<td>8</td>
<td>连接管理</td>
<td>（0x8连接）</td>
</tr>
<tr>
<td>16</td>
<td>打印发送和接收的数据包</td>
<td>（0x10 BER）</td>
</tr>
<tr>
<td>32</td>
<td>搜索过滤处理</td>
<td>（0x20过滤器）</td>
</tr>
<tr>
<td>64</td>
<td>配置处理</td>
<td>（0x40配置）</td>
</tr>
<tr>
<td>128</td>
<td>访问控制列表处理</td>
<td>（0x80 ACL）</td>
</tr>
<tr>
<td>256</td>
<td>统计日志连接/操作/结果</td>
<td>（0x100统计）</td>
</tr>
<tr>
<td>512</td>
<td>统计日志条目发送</td>
<td>（0x200 stats2）</td>
</tr>
<tr>
<td>1024</td>
<td>打印与后台的通讯</td>
<td>（0x400 shell）</td>
</tr>
<tr>
<td>2048</td>
<td>打印输入解析调试</td>
<td>（0x800解析）</td>
</tr>
<tr>
<td>16384</td>
<td>syncrepl消费者处理</td>
<td>（0x4000同步）</td>
</tr>
<tr>
<td>32768</td>
<td>只有设置了记录日志级别的消息</td>
<td>（0x8000无）</td>
</tr>
</tbody></table>
<p>期望的日志级别可以作为单个整数输入，该整数将（ORed）所需的级别（十进制或十六进制符号）组合为整数列表（在内部进行ORed操作），或作为显示的名称列表在括号之间，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loglevel 129</span><br><span class="line">loglevel 0x81</span><br><span class="line">loglevel 128 1</span><br><span class="line">loglevel 0x80 0x1</span><br><span class="line">loglevel acl跟踪</span><br></pre></td></tr></table></figure>

<p>是等同的</p>
<p>例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel -1</span><br></pre></td></tr></table></figure>

<p>这将导致大量的调试信息被记录。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel conns filter</span><br></pre></td></tr></table></figure>

<p>只需记录连接并搜索过滤器处理。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel none</span><br></pre></td></tr></table></figure>

<p>记录无论配置的日志级别如何记录的消息。这不同于在不发生日志记录时将日志级别设置为0。至少需要“<code>None ”</code>级才能记录高优先级消息。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel stats</span><br></pre></td></tr></table></figure>

<p>默认情况下配置基本统计记录。但是，如果未定义日志级别，则不会发生日志记录（相当于0级别）。</p>
<h4 id="6-2-1-6-objectclass-lt"><a href="#6-2-1-6-objectclass-lt" class="headerlink" title="6.2.1.6 objectclass &lt;"></a>6.2.1.6 objectclass &lt;</h4><p><a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4512.txt">RFC4512</a> Object Class Description&gt;</p>
<p>该指令定义了一个对象类。有关如何使用此指令的信息，请参阅“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/schema.html">模式规范”</a>一章。</p>
<h4 id="6-2-1-7-referral-lt-URI-gt"><a href="#6-2-1-7-referral-lt-URI-gt" class="headerlink" title="6.2.1.7 referral &lt;URI&gt;"></a>6.2.1.7 referral &lt;URI&gt;</h4><p>此指令指定当slapd找不到本地数据库来处理请求时要传回的引用。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">referral ldap://root.openldap.org</span><br></pre></td></tr></table></figure>

<p>这将在OpenLDAP项目中将非本地查询引用到全局根LDAP服务器。智能LDAP客户端可以在该服务器上重新询问他们的查询，但请注意，大多数这些客户端只会知道如何处理包含主机部分和可选的可分辨名称部分的简单LDAP URL。</p>
<h4 id="6-2-1-8-sizelimit-lt-integer-gt"><a href="#6-2-1-8-sizelimit-lt-integer-gt" class="headerlink" title="6.2.1.8 sizelimit &lt;integer&gt;"></a>6.2.1.8 sizelimit &lt;integer&gt;</h4><p>此指令指定从搜索操作返回的最大条目数。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sizelimit 500</span><br></pre></td></tr></table></figure>

<p>有关详细信息，请参阅本指南的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/limits.html">“限制”</a>部分和<em>slapd.conf</em>（5）。</p>
<h4 id="6-2-1-9-timelimit-lt-integer-gt"><a href="#6-2-1-9-timelimit-lt-integer-gt" class="headerlink" title="6.2.1.9 timelimit &lt;integer&gt;"></a>6.2.1.9 timelimit &lt;integer&gt;</h4><p>此指令指定slapd将花费回答搜索请求的最大秒数（实时）。如果此时尚未完成请求，将返回指示超时时间的结果。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timelimit 3600</span><br></pre></td></tr></table></figure>

<p>有关详细信息，请参阅本指南的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/limits.html">“限制”</a>部分和<em>slapd.conf</em>（5）。</p>
<h3 id="6-2-2-一般后端指令"><a href="#6-2-2-一般后端指令" class="headerlink" title="6.2.2 一般后端指令"></a>6.2.2 一般后端指令</h3><p>本节中的指令仅适用于定义它们的后端。它们由每种后端支持。后端指令适用于所有相同类型的数据库实例，根据该指令，数据库指令可能会被覆盖。</p>
<h4 id="6-2-2-1-backend-lt-type-gt"><a href="#6-2-2-1-backend-lt-type-gt" class="headerlink" title="6.2.2.1 backend &lt;type&gt;"></a>6.2.2.1 backend &lt;type&gt;</h4><p>后端该指令标志着后端声明的开始。<code>&lt;type&gt;</code>应于表6.2中列出的支持的后端类型之一。</p>
<p><strong>表6.2：数据库后端:</strong></p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>bdb</td>
<td>Berkeley DB事务后端（已弃用）</td>
</tr>
<tr>
<td>dnssrv</td>
<td>DNS SRV后端</td>
</tr>
<tr>
<td>hdb</td>
<td>bdb后端的分层变体（已弃用）</td>
</tr>
<tr>
<td>ldap</td>
<td>轻量级目录访问协议（Proxy）后端</td>
</tr>
<tr>
<td>mdb</td>
<td>内存映射DB后端</td>
</tr>
<tr>
<td>meta</td>
<td>元目录后端</td>
</tr>
<tr>
<td>monitor</td>
<td>监视后端</td>
</tr>
<tr>
<td>passwd</td>
<td>提供对<em>passwd的</em>只读访问（5）</td>
</tr>
<tr>
<td>perl</td>
<td>Perl可编程后端</td>
</tr>
<tr>
<td>shell</td>
<td>Shell（外部程序）后端</td>
</tr>
<tr>
<td>sql</td>
<td>SQL可编程后端</td>
</tr>
</tbody></table>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">backend bdb</span><br></pre></td></tr></table></figure>

<p>这标志着一个新的开始 BDB 后端定义</p>
<h3 id="6-2-3-一般数据库指令"><a href="#6-2-3-一般数据库指令" class="headerlink" title="6.2.3 一般数据库指令"></a>6.2.3 一般数据库指令</h3><p>本节中的指令仅适用于定义它们的数据库。它们由每种类型的数据库支持。</p>
<h4 id="6-2-3-1-database-lt-type-gt"><a href="#6-2-3-1-database-lt-type-gt" class="headerlink" title="6.2.3.1 database &lt;type&gt;"></a>6.2.3.1 database &lt;type&gt;</h4><p>该指令标志着数据库实例声明的开始。<code>&lt;类型&gt;</code>应于表6.2中列出的支持的后端类型之一。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database bdb</span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-2-limits-lt-selector-gt-lt-limit-gt-lt-limit-gt-…"><a href="#6-2-3-2-limits-lt-selector-gt-lt-limit-gt-lt-limit-gt-…" class="headerlink" title="6.2.3.2 limits &lt;selector&gt; &lt;limit&gt; [&lt;limit&gt; […]]"></a>6.2.3.2 limits &lt;selector&gt; &lt;limit&gt; [&lt;limit&gt; […]]</h4><p>根据操作的启动器或基本DN指定时间和大小限制。</p>
<p>有关详细信息，请参阅本指南的<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/limits.html">“限制”</a>部分和<em>slapd.conf</em>（5）。</p>
<h4 id="6-2-3-3-readonly-on-off"><a href="#6-2-3-3-readonly-on-off" class="headerlink" title="6.2.3.3 readonly { on | off }"></a>6.2.3.3 readonly { on | off }</h4><p>该指令将数据库置于“只读”模式。任何修改数据库的尝试将返回“不愿意执行”的错误。如果设置在消费者身上，syncrepl发送的修改仍然会发生。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readonly off</span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-4-rootdn-lt-DN-gt"><a href="#6-2-3-4-rootdn-lt-DN-gt" class="headerlink" title="6.2.3.4 rootdn &lt;DN&gt;"></a>6.2.3.4 rootdn &lt;DN&gt;</h4><p>此指令指定不受该数据库操作的访问控制或管理限制限制的DN。DN不需要引用此数据库中的条目，甚至不在目录中。DN可以指SASL身份。</p>
<p>基于入门的示例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootdn &quot;cn=Manager,dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>基于SASL的示例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootdn &quot;uid=root,cn=example.com,cn=digest-md5,cn=auth&quot;</span><br></pre></td></tr></table></figure>

<p>有关<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/sasl.html#SASL%20Authentication">SASL认证身份</a>的信息，请参阅<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/sasl.html#SASL%20Authentication">SASL认证</a>部分。</p>
<h4 id="6-2-3-5-rootpw-lt-password-gt"><a href="#6-2-3-5-rootpw-lt-password-gt" class="headerlink" title="6.2.3.5 rootpw &lt;password&gt;"></a>6.2.3.5 rootpw &lt;password&gt;</h4><p>该指令可用于为rootdn指定DN的密码（当rootdn设置为数据库中的DN时）。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootpw secret</span><br></pre></td></tr></table></figure>

<p>还可以在<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc2307.txt">RFC2307</a>表单中提供密码散列。 <em>slappasswd</em>（8）可用于生成密码哈希。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootpw &#123;SSHA&#125;ZKKuqbEKJfKSXhUbHG3fG8MDn9j1v4QN</span><br></pre></td></tr></table></figure>

<p>散列是使用命令<code>slappasswd -s secret</code>生成的。</p>
<h4 id="6-2-3-6-suffix-lt-dn-suffix-gt"><a href="#6-2-3-6-suffix-lt-dn-suffix-gt" class="headerlink" title="6.2.3.6 suffix &lt;dn suffix&gt;"></a>6.2.3.6 suffix &lt;dn suffix&gt;</h4><p>此指令指定将传递给此后端数据库的查询的DN后缀。可以给出多个后缀行，每个数据库定义至少需要一个。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">suffix &quot;dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>以“<code>dc = example,dc = com</code>”结尾的DN的查询将传递给此后端。</p>
<p><strong>注意：</strong>当选择要传递查询的后端时，slapd按照它们在文件中显示的顺序查看每个数据库定义中的后缀行。因此，如果一个数据库后缀是另一个数据库后缀，则它必须出现在配置文件中。</p>
<h4 id="6-2-3-7-syncrepl"><a href="#6-2-3-7-syncrepl" class="headerlink" title="6.2.3.7 syncrepl"></a>6.2.3.7 syncrepl</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">syncrepl rid=&lt;replica ID&gt;</span><br><span class="line">                provider=ldap[s]://&lt;hostname&gt;[:port]</span><br><span class="line">                searchbase=&lt;base DN&gt;</span><br><span class="line">                [type=refreshOnly|refreshAndPersist]</span><br><span class="line">                [interval=dd:hh:mm:ss]</span><br><span class="line">                [retry=[&lt;retry interval&gt; &lt;# of retries&gt;]+]</span><br><span class="line">                [filter=&lt;filter str&gt;]</span><br><span class="line">                [scope=sub|one|base]</span><br><span class="line">                [attrs=&lt;attr list&gt;]</span><br><span class="line">                [exattrs=&lt;attr list&gt;]</span><br><span class="line">                [attrsonly]</span><br><span class="line">                [sizelimit=&lt;limit&gt;]</span><br><span class="line">                [timelimit=&lt;limit&gt;]</span><br><span class="line">                [schemachecking=on|off]</span><br><span class="line">                [network-timeout=&lt;seconds&gt;]</span><br><span class="line">                [timeout=&lt;seconds&gt;]</span><br><span class="line">                [bindmethod=simple|sasl]</span><br><span class="line">                [binddn=&lt;DN&gt;]</span><br><span class="line">                [saslmech=&lt;mech&gt;]</span><br><span class="line">                [authcid=&lt;identity&gt;]</span><br><span class="line">                [authzid=&lt;identity&gt;]</span><br><span class="line">                [credentials=&lt;passwd&gt;]</span><br><span class="line">                [realm=&lt;realm&gt;]</span><br><span class="line">                [secprops=&lt;properties&gt;]</span><br><span class="line">                [keepalive=&lt;idle&gt;:&lt;probes&gt;:&lt;interval&gt;]</span><br><span class="line">                [starttls=yes|critical]</span><br><span class="line">                [tls_cert=&lt;file&gt;]</span><br><span class="line">                [tls_key=&lt;file&gt;]</span><br><span class="line">                [tls_cacert=&lt;file&gt;]</span><br><span class="line">                [tls_cacertdir=&lt;path&gt;]</span><br><span class="line">                [tls_reqcert=never|allow|try|demand]</span><br><span class="line">                [tls_cipher_suite=&lt;ciphers&gt;]</span><br><span class="line">                [tls_crlcheck=none|peer|all]</span><br><span class="line">                [tls_protocol_min=&lt;major&gt;[.&lt;minor&gt;]]</span><br><span class="line">                [suffixmassage=&lt;real DN&gt;]</span><br><span class="line">                [logbase=&lt;base DN&gt;]</span><br><span class="line">                [logfilter=&lt;filter str&gt;]</span><br><span class="line">                [syncdata=default|accesslog|changelog]</span><br></pre></td></tr></table></figure>

<p>该指令通过将当前的<em>slapd</em>（8）建立为运行syncrepl复制引擎的复制用户站点来将当前数据库指定为主内容的副本。主数据库位于由<code>provider</code>参数指定的复制提供程序站点。使用LDAP内容同步协议，副本数据库与主内容保持最新。有关<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4533.txt">协议</a>的更多信息，请参阅<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4533.txt">RFC4533</a>。</p>
<p><code>RID</code>参数用于当前的识别<code>的syncrepl</code>复制消费者服务器内的指令，其中<code>&lt;replica ID&gt;</code>唯一地识别由当前所描述的的syncrepl规范<code>syncrepl</code>指令。<code>&lt;replica ID&gt;</code>为非负数，长度不超过三位十进制数字。</p>
<p><code>provider</code>参数指定包含主内容作为LDAP URI复制提供者站点。<code>provider</code>参数指定的方案，主机和可选地其中该提供者的slapd实例可以发现一个端口。域名或IP地址可以用于&lt;hostname&gt;。示例是<code>ldap://provider.example.com:389</code>或<code>ldaps://192.168.1.1:636</code>。如果未指定&lt;port&gt;，则使用标准LDAP端口号（389或636）。请注意，syncrepl使用消费者启动的协议，因此其规范位于消费者站点，而<code>副本</code>规范位于提供者站点。<code>syncrepl</code>和<code>副本</code>指令定义了两个独立的复制机制。它们不代表彼此的复制对等体。</p>
<p>使用搜索规范作为其结果集定义syncrepl副本的内容。消费者slapd将根据搜索规范将搜索请求发送给提供商slapd。<br>搜索规范包括<code>searchbase</code>，<code>scope</code>，<code>filter</code>，<code>attrs</code>，<code>exattrs</code>，<code>attrsonly</code>，<code>sizeLimit</code>和<code>timelimit</code>参数如在正常搜索规范。该<code>searchbase</code>参数没有默认值，<br>必须指定。scope 默认为<code>sub</code>中，<code>filter</code>默认为<code>（objectclass= *）</code>，<code>attrs</code>默认为<code>“*，+”</code>来复制所有用户和操作属性，默认情况下<code>attrsonly</code>是未设置的。双方<code>的sizeLimit</code>和<code>时限</code>默认为“无限制”，只有正整数或“无限制”可能被指定。该<code>exattrs</code>选项也可被用来指定应该从输入的条目被省略属性。</p>
<p>该 LDAP内容同步协议有两种操作类型：<code>refreshOnly</code>和<code>refreshAndPersist</code>。操作类型由<code>type</code>参数指定。<br>在<code>refreshOnly</code>操作中，在每次同步操作结束之后的间隔时间周期性地重新调度下一个同步搜索操作。间隔由<code>interval</code>参数指定。默认设置为一天。<br>在<code>refreshAndPersist</code>操作中，同步搜索在提供者<em>slapd</em>实例中保持不变。对主副本的进一步更新将生成<code>searchResultEntry</code> 到消费者slapd作为搜索响应的持续同步搜索。</p>
<p>如果在复制期间发生错误，消费者将尝试根据重试参数重新连接，该重试参数是&lt;retry interval&gt;和&lt;＃of retries&gt; pair的列表。例如，retry =“60 10 300 3”可让消费者重新开始前10次，每60秒重试一次，然后在停止重试之前每300秒重试三次。+在&lt;＃重试次数&gt;中意味着无限期的重试，直到成功。</p>
<p>可以通过打开<code>schemachecking</code>参数，在LDAP Sync使用者站点上强制执行模式检查。如果它被打开，则每个复制的条目将被检查其模式，因为条目存储在副本内容中。副本中的每个条目都应包含模式定义所需的属性。如果它被关闭，条目将被存储，而不检查模式一致性。默认是关闭。</p>
<p><code>network-timeout</code>参数设置，消费者将等待多长时间来建立网络连接到提供商。一旦建立连接，<code>timeout</code>参数确定消费者等待初始绑定请求完成的时间。这些参数的默认值来自<em>ldap.conf</em>（5）。</p>
<p><code>binddn</code>参数给出了DN绑定为进行syncrepl搜索到提供者的slapd。它应该是具有对主数据库中的复制内容的读取访问权限的DN。</p>
<p><code>bindmethod</code>是<code>simple</code>还是<code>SASL</code>，取决于是否简单基于密码的认证或SASL连接到提供商<em>slapd</em>实例时要使用身份验证。</p>
<p>除非有足够的数据完整性和机密性保护（例如TLS或IPsec），否则不应使用简单认证。简单的身份验证需要指定<code>binddn</code>和<code>credentials</code>参数。</p>
<p>通常建议使用SASL认证。SASL身份验证需要使用<code>saslmech</code>参数来指定机制。根据机制，可以分别使用<code>authcid</code>和<code>credentials</code>来指定身份验证身份和/或凭据。所述<code>authzid</code>参数可以被用来指定一个授权身份。</p>
<p><code>realm</code>参数指定其中的某些机制认证中的身份的境界。该<code>secprops</code>参数指定赛勒斯SASL安全属性。</p>
<p><code>keepalive</code>参数设定空闲，探针和间隔用于检查套接字是否是活的值; 空闲是TCP开始发送keepalive探测之前连接需要保持空闲的秒数;<br>探测器是TCP连接之前应发送的Keepalive探测器的最大数量; 间隔是个体保持性探测之间的间隔（以秒为单位）。只有一些系统支持定制这些值; 否则将忽略keepalive参数，并使用系统范围的设置。例如，在240秒的空闲活动之后，keepalive =“240：10：30”将发送10次，每30秒钟一次Keepalive。如果没有收到对探测器的响应，则连接将被丢弃。</p>
<p><code>starttls</code>参数指定使用扩展操作认证的供应商之前建立TLS会话启动TLS的。如果提供了<code>critical</code>参数，则如果StartTLS请求失败，则该会话将中止。否则syncrepl会话继续而不使用TLS。tls_reqcert设置默认为<code>“demand”</code>，其他TLS设置默认与主slapd TLS设置相同。</p>
<p><code>suffixmassage</code>参数允许用户从远程目录中其DN后缀从本地目录不同拉条目。与搜索库匹配的远程条目DN的部分将被后缀名称DN替换。</p>
<p>消费者不是复制整个条目，而是可以查询数据修改的日志。这种操作模式称为<em>delta syncrepl</em>。除了上述参数之外，<br>必须对要使用的日志适当地设置<code>logbase</code>和<code>logfilter</code>参数。所述<code>syncdata</code>参数必须设置为<code>“accesslog”</code>如果日志符合<em>slapo-accesslog</em>（5）日志格式，<br>或<code>“更改日志”</code>如果日志符合过时的<em>更改日志</em>的格式。如果<code>syncdata</code>参数被省略或设置为<code>“default”</code> ，则日志参数将被忽略。</p>
<p><em>syncrepl</em> 复制机制是由支持<em>BDB</em>，<em>hdb</em>，以及<em>MDB</em>后端。</p>
<p>有关如何使用此指令的详细信息，请参阅本指南的“ <a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/replication.html#LDAP%20Sync%20Replication">LDAP同步复制”</a>一章。</p>
<h4 id="6-2-3-8-updateref-lt-URL-gt"><a href="#6-2-3-8-updateref-lt-URL-gt" class="headerlink" title="6.2.3.8 updateref &lt;URL&gt;"></a>6.2.3.8 updateref &lt;URL&gt;</h4><p>此伪指令仅适用于<em>从属</em>（或<em>阴影</em>）<em>slapd</em>（8）实例。它指定返回到在副本上提交更新请求的客户端的URL。如果指定多次，每个网址 被提供。</p>
<p>例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateref       ldap://master.example.net</span><br></pre></td></tr></table></figure>

<h3 id="6-2-4-BDB和HDB数据库指令"><a href="#6-2-4-BDB和HDB数据库指令" class="headerlink" title="6.2.4 BDB和HDB数据库指令"></a>6.2.4 BDB和HDB数据库指令</h3><p>此类别中的指令仅适用于 BDB 和 HDB数据库。也就是说，它们必须遵循“数据库bdb”或“数据库hdb”行，并在任何后续的“后端”或“数据库”行之前。有关BDB / HDB配置指令的完整参考，请参见<em>slapd-bdb</em>（5）。</p>
<h4 id="6-2-4-1-directory-lt-directory-gt"><a href="#6-2-4-1-directory-lt-directory-gt" class="headerlink" title="6.2.4.1 directory &lt;directory&gt;"></a>6.2.4.1 directory &lt;directory&gt;</h4><p>此伪指令指定包含数据库和关联索引的BDB文件的目录。</p>
<p>默认：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directory /usr/local/var/openldap-data</span><br></pre></td></tr></table></figure>

<h2 id="6-3-配置文件示例"><a href="#6-3-配置文件示例" class="headerlink" title="6.3 配置文件示例"></a>6.3 配置文件示例</h2><p>以下是一个示例配置文件，其中插有说明文字。它定义了两个数据库来处理不同的部分X.500树; 两者都是BDB数据库实例。显示的行号仅供参考，不包括在实际文件中。首先，全局配置部分：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.    # example config file - global configuration section</span><br><span class="line">2.    include /usr/local/etc/schema/core.schema</span><br><span class="line">3.    referral ldap://root.openldap.org</span><br><span class="line">4.    access to * by * read</span><br></pre></td></tr></table></figure>

<p>第1行是一条评论。第2行包含另一个包含<em>核心</em>模式定义的配置文件。第3行的<code>referral</code>指令意味着不属于下面定义的数据库之一的查询将被引用到在主机<code>root.openldap.org</code>上的标准端口（389）上运行的LDAP服务器。</p>
<p>第4行是一个全局访问控制。它适用于所有条目（在任何适用的特定于数据库的访问控制之后）。</p>
<p>配置文件的下一部分定义了一个BDB后端，它将处理对树的“<code>dc=example,dc=com</code>”部分中的内容的查询。数据库将被复制到两个从属 slapds，一个在叛逃，另一个在判断日。指数将被维护为几个属性，并且<code>userPassword</code>属性被保护免受未经授权的访问。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> 5.    # BDB definition for the example.com</span><br><span class="line"> 6.    database bdb</span><br><span class="line"> 7.    suffix &quot;dc=example,dc=com&quot;</span><br><span class="line"> 8.    directory /usr/local/var/openldap-data</span><br><span class="line"> 9.    rootdn &quot;cn=Manager,dc=example,dc=com&quot;</span><br><span class="line">10.    rootpw secret</span><br><span class="line">11.    # indexed attribute definitions</span><br><span class="line">12.    index uid pres,eq</span><br><span class="line">13.    index cn,sn pres,eq,approx,sub</span><br><span class="line">14.    index objectClass eq</span><br><span class="line">15.    # database access control definitions</span><br><span class="line">16.    access to attrs=userPassword</span><br><span class="line">17.        by self write</span><br><span class="line">18.        by anonymous auth</span><br><span class="line">19.        by dn.base=&quot;cn=Admin,dc=example,dc=com&quot; write</span><br><span class="line">20.        by * none</span><br><span class="line">21.    access to *</span><br><span class="line">22.        by self write</span><br><span class="line">23.        by dn.base=&quot;cn=Admin,dc=example,dc=com&quot; write</span><br><span class="line">24.        by * read</span><br></pre></td></tr></table></figure>

<p>第5行是一条评论。数据库定义的开始由第6行的数据库关键字标记。第7行指定查询传递到此数据库的DN后缀。第8行指定数据库文件将在哪个目录。</p>
<p>第9行和第10行标识数据库<em>超级用户</em>条目和相关密码。此条目不受访问控制或大小或时间限制的限制。</p>
<p>第12至14行表示维持各种属性的索引。</p>
<p>第16到24行为此数据库中的条目指定访问控制。对于所有适用的条目，<code>userPassword</code>属性可由条目本身和“admin”条目写入。它可以用于认证/授权目的，但是不可读。所有其他属性可由条目和“admin”条目写入，但可由所有用户（经过身份验证或不被认证）读取。</p>
<p>示例配置文件的下一部分定义了另一个BDB数据库。这个处理涉及<code>dc=example,dc=net</code> subtree的查询<code>，</code>但是由与第一个数据库相同的实体进行管理。请注意，没有第39行，由于第4行的全局访问规则，读访问将被允许。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">33.    # BDB definition for example.net</span><br><span class="line">34.    database bdb</span><br><span class="line">35.    suffix &quot;dc=example,dc=net&quot;</span><br><span class="line">36.    directory /usr/local/var/openldap-data-net</span><br><span class="line">37.    rootdn &quot;cn=Manager,dc=example,dc=com&quot;</span><br><span class="line">38.    index objectClass eq</span><br><span class="line">39.    access to * by users read</span><br></pre></td></tr></table></figure>

<h2 id="7-运行slapd"><a href="#7-运行slapd" class="headerlink" title="7 运行slapd"></a>7 运行slapd</h2><p><em>slapd</em>（8）被设计为作为独立服务运行。这允许服务器利用缓存，管理底层数据库的并发问题，并节省系统资源。从<em>inetd</em>（8）运行<em>不是</em>一个选项。</p>
<h3 id="7-1-命令行选项"><a href="#7-1-命令行选项" class="headerlink" title="7.1 命令行选项"></a>7.1 命令行选项</h3><p><em>slapd</em>（8）支持手册页中详细说明的许多命令行选项。本节详细介绍了一些常用的选项。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-f &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<p>此选项指定slapd的备用配置文件。默认值通常是<code>/usr/local/etc/openldap/slapd.conf</code>。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-F &lt;slapd-config-directory&gt;</span><br></pre></td></tr></table></figure>

<p>指定slapd配置目录。默认值为<code>/usr/local/etc/openldap/slapd.d</code>。</p>
<p>如果指定了<code>-f</code>和<code>-F</code>，则配置文件将被读取并转换为config目录格式并写入指定的目录。如果未指定任何选项，slapd将尝试读取默认配置目录，然后再尝试使用默认配置文件。如果存在有效的配置目录，那么默认配置文件将被忽略。所有使用配置选项的拍照工具都遵循同样的行为。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-h &lt;URLs&gt;</span><br></pre></td></tr></table></figure>

<p>此选项指定备用侦听器配置。默认值是<code>ldap:///</code>这意味着LDAP 过度 TCP您可以指定特定的主机端口对或其他协议方案（如<code>ldaps://</code>或<code>ldapi://</code>）。</p>
<table>
<thead>
<tr>
<th><strong>网址</strong></th>
<th><strong>协议</strong></th>
<th><strong>传输</strong></th>
</tr>
</thead>
<tbody><tr>
<td>LDAP：///</td>
<td>LDAP</td>
<td>TCP端口389</td>
</tr>
<tr>
<td>LDAPS：///</td>
<td>LDAP over SSL</td>
<td>TCP端口636</td>
</tr>
<tr>
<td>ldapi：///</td>
<td>LDAP</td>
<td>IPC（Unix域套接字）</td>
</tr>
</tbody></table>
<p>例如，-h<code>ldaps:// ldap://127.0.0.1:666</code>将创建两个监听器：一个用于默认<code>ldaps</code>上的所有接口上的（非标准）方案<code>ldaps：//</code>端口 636 ，另外一个用于端口666 上<code>localhost</code>（<em>loopback</em>）接口上的标准<code>ldap://</code>方案。主机可以使用主机名或 IPv4 要么 IPv6 地址。端口值必须是数字。</p>
<p>对于通过IPC的LDAP，可以在URL中编码Unix域套接字的路径名。请注意，目录分隔符必须与URL特殊的任何其他字符进行URL编码。因此，套接字<code>/usr/local/var/ldapi</code>必须编码为</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapi://%2Fusr%2Flocal%2Fvar%2Fldapi</span><br></pre></td></tr></table></figure>

<p>ldapi：在<em>使用LDAP机制</em>中详细描述[ <a target="_blank" rel="noopener" href="http://tools.ietf.org/html/draft-chu-ldap-ldapi-00">Chu-LDAPI</a> ]</p>
<p>请注意，ldapi：///传输没有被广泛实现：非OpenLDAP客户端可能无法使用它。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-n &lt;service-name&gt;</span><br></pre></td></tr></table></figure>

<p>此选项指定用于记录和其他目的的服务名称。默认的服务名称是<code>slapd</code>。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-l &lt;syslog-local-user&gt;</span><br></pre></td></tr></table></figure>

<p>此选项指定<em>syslog</em>（8）设施的本地用户。值可以是<code>LOCAL0</code>，<code>LOCAL1</code>，<code>LOCAL2</code>，…和<code>LOCAL7</code>。默认值为<code>LOCAL4</code>。所有系统可能不支持此选项。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-u user -g group</span><br></pre></td></tr></table></figure>

<p>这些选项分别指定用户和组作为运行。<code>用户</code>可以是用户名或uid。<code>组</code>可以是组名或gid。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r directory</span><br></pre></td></tr></table></figure>

<p>此选项指定运行时目录。打开侦听器之后，slapd将在读取任何配置文件或初始化任何后端之前将<em>chroot</em>（2）<em>chroot</em>（2）转到此目录。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-d &lt;level&gt; | ?</span><br></pre></td></tr></table></figure>

<p>此选项将slapd调试级别设置为&lt;level&gt;。当级别是’？’ 字符，打印各种调试级别并退出slapd，无论您提供任何其他选项。当前的调试级别是</p>
<p><strong>表7.1：调试级别:</strong></p>
<table>
<thead>
<tr>
<th><strong>水平</strong></th>
<th><strong>关键词</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>-1</td>
<td>任何</td>
<td>启用所有调试</td>
</tr>
<tr>
<td>0</td>
<td></td>
<td>没有调试</td>
</tr>
<tr>
<td>1</td>
<td>（0x1跟踪）</td>
<td>跟踪函数调用</td>
</tr>
<tr>
<td>2</td>
<td>（0x2数据包）</td>
<td>调试数据包处理</td>
</tr>
<tr>
<td>4</td>
<td>（0x4 args）</td>
<td>重调查</td>
</tr>
<tr>
<td>8</td>
<td>（0x8连接）</td>
<td>连接管理</td>
</tr>
<tr>
<td>16</td>
<td>（0x10 BER）</td>
<td>打印发送和接收的数据包</td>
</tr>
<tr>
<td>32</td>
<td>（0x20过滤器）</td>
<td>搜索过滤处理</td>
</tr>
<tr>
<td>64</td>
<td>（0x40配置）</td>
<td>配置处理</td>
</tr>
<tr>
<td>128</td>
<td>（0x80 ACL）</td>
<td>访问控制列表处理</td>
</tr>
<tr>
<td>256</td>
<td>（0x100统计）</td>
<td>统计日志连接/操作/结果</td>
</tr>
<tr>
<td>512</td>
<td>（0x200 stats2）</td>
<td>统计日志条目发送</td>
</tr>
<tr>
<td>1024</td>
<td>（0x400 shell）</td>
<td>打印与后台的通讯</td>
</tr>
<tr>
<td>2048</td>
<td>（0x800解析）</td>
<td>打印输入解析调试</td>
</tr>
<tr>
<td>16384</td>
<td>（0x4000同步）</td>
<td>syncrepl消费者处理</td>
</tr>
<tr>
<td>32768</td>
<td>（0x8000无）</td>
<td>只有设置了记录日志级别的消息</td>
</tr>
</tbody></table>
<p>您可以通过为每个所需级别指定一次调试选项来启用多个级别。或者，由于调试级别相加，您可以自己做数学。也就是说，如果要跟踪函数调用并观察正在处理的配置文件，可以将级别设置为这两级的总和（在这种情况下为<code>-d 65</code>）。或者，您可以让slapd做数学，（例如<code>-d 1 -d 64</code>）。有关详细信息，请<code>参阅&lt;ldap_log.h&gt;</code>。</p>
<p><strong>注意：</strong> slapd必须已经使用<code>--enable-debug</code>进行编译，以便在两个统计级别之外的任何调试信息都可用（默认值）定义。</p>
<h3 id="7-2-开始slapd"><a href="#7-2-开始slapd" class="headerlink" title="7.2 开始slapd"></a>7.2 开始slapd</h3><p>一般来说，slapd是这样运行的：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/libexec/slapd [&lt;option&gt;]*</span><br></pre></td></tr></table></figure>

<p>其中<code>/usr/local/libexec</code>由<code>configure</code>确定，&lt;option&gt;是上述选项之一（或<em>slapd</em>（8））。除非你已经指定了一个调试级别（包括<code>0</code>级），否则slapd会自动从控制终端进行分支和分离，并在后台运行。</p>
<h3 id="7-3-停止slapd"><a href="#7-3-停止slapd" class="headerlink" title="7.3 停止slapd"></a>7.3 停止slapd</h3><p>要安全地杀死<em>slapd</em>（8），你应该给出这样的命令</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -INT`cat /usr/local/var/slapd.pid`</span><br></pre></td></tr></table></figure>

<p>其中<code>/usr/local/var</code>由<code>configure</code>决定。</p>
<p>通过更加激烈的方法杀死slapd可能会导致信息丢失或数据库损坏。</p>
<h2 id="8-访问控制"><a href="#8-访问控制" class="headerlink" title="8 访问控制"></a>8 访问控制</h2><h3 id="8-1-介绍"><a href="#8-1-介绍" class="headerlink" title="8.1 介绍"></a>8.1 介绍</h3><p>随着目录被越来越多的灵敏度数据填充，控制授予目录的访问种类变得越来越重要。例如，目录可能包含您可能需要通过合同或法律保护的机密性质的数据。或者，如果使用目录来控制对其他服务的访问，则对目录的不当访问可能会对您的站点的安全性造成攻击，从而对您的资产造成毁灭性破坏。</p>
<p>可以通过两种方法配置您的目录访问，第一种使用<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/slapdconfig.html">slapd配置文件</a>，第二种使用<em>slapd-config</em>（5）格式（<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/slapdconf2.html">配置slapd</a>）。</p>
<p>默认访问控制策略允许所有客户端读取。无论什么访问控制策略被定义，<em>rootdn</em>总是允许在一切和任何事情上的完全权限（即验证，搜索，比较，读取和写入）。</p>
<p>因此，在&lt;<em>by</em>&gt;子句中明确列出 <em>rootdn</em> 是无用的（并导致性能损失）。</p>
<p>以下部分将更详细地描述访问控制列表，并附有一些示例和建议。有关详细信息，请参阅<em>slapd.access</em>（5）。</p>
<h3 id="8-2-通过静态配置访问控制"><a href="#8-2-通过静态配置访问控制" class="headerlink" title="8.2 通过静态配置访问控制"></a>8.2 通过静态配置访问控制</h3><p>访问条目和属性由访问配置文件指令控制。访问线路的一般形式是：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;access directive&gt; ::= access to &lt;what&gt;</span><br><span class="line">    [by &lt;who&gt; [&lt;access&gt;] [&lt;control&gt;] ]+</span><br><span class="line">&lt;what&gt; ::= * |</span><br><span class="line">    [dn[.&lt;basic-style&gt;]=&lt;regex&gt; | dn.&lt;scope-style&gt;=&lt;DN&gt;]</span><br><span class="line">    [filter=&lt;ldapfilter&gt;] [attrs=&lt;attrlist&gt;]</span><br><span class="line">&lt;basic-style&gt; ::= regex | exact</span><br><span class="line">&lt;scope-style&gt; ::= base | one | subtree | children</span><br><span class="line">&lt;attrlist&gt; ::= &lt;attr&gt; [val[.&lt;basic-style&gt;]=&lt;regex&gt;] | &lt;attr&gt; , &lt;attrlist&gt;</span><br><span class="line">&lt;attr&gt; ::= &lt;attrname&gt; | entry | children</span><br><span class="line">&lt;who&gt; ::= * | [anonymous | users | self</span><br><span class="line">        | dn[.&lt;basic-style&gt;]=&lt;regex&gt; | dn.&lt;scope-style&gt;=&lt;DN&gt;]</span><br><span class="line">    [dnattr=&lt;attrname&gt;]</span><br><span class="line">    [group[/&lt;objectclass&gt;[/&lt;attrname&gt;][.&lt;basic-style&gt;]]=&lt;regex&gt;]</span><br><span class="line">    [peername[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [sockname[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [domain[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [sockurl[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [set=&lt;setspec&gt;]</span><br><span class="line">    [aci=&lt;attrname&gt;]</span><br><span class="line">&lt;access&gt; ::= [self]&#123;&lt;level&gt;|&lt;priv&gt;&#125;</span><br><span class="line">&lt;level&gt; ::= none | disclose | auth | compare | search | read | write | manage</span><br><span class="line">&lt;priv&gt; ::= &#123;=|+|-&#125;&#123;m|w|r|s|c|x|d|0&#125;+</span><br><span class="line">&lt;control&gt; ::= [stop | continue | break]</span><br></pre></td></tr></table></figure>

<p>其中<code>&lt;what&gt;</code>部分选择访问适用的条目和 / 或属性，<code>&lt;who&gt;</code>部分指定哪些实体被授予访问权限，并且<code>&lt;access&gt;</code>部分指定所授予的访问权限。支持多个<code>&lt;who&gt; &lt;access&gt; &lt;control&gt;</code>三元组，允许许多实体被授予对同一组条目和属性的不同访问权限。不是所有这些访问控制选项都在这里描述; 有关更多详细信息，请参阅<em>slapd.access</em>（5）手册页。</p>
<h4 id="8-2-1-什么来控制访问"><a href="#8-2-1-什么来控制访问" class="headerlink" title="8.2.1 什么来控制访问"></a>8.2.1 什么来控制访问</h4><p>访问规范的&lt;what&gt;部分确定访问控制适用于的条目和属性。条目通常以两种方式进行选择：通过DN和过滤器。以下限定符通过DN选择条目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">to *</span><br><span class="line">to dn[.&lt;basic-style&gt;]=&lt;regex&gt;</span><br><span class="line">to dn.&lt;scope-style&gt;=&lt;DN&gt;</span><br></pre></td></tr></table></figure>

<p>第一个表单用于选择所有条目。第二种形式可以用于通过将正则表达式与目标条目的<em>标准化DN</em>相匹配来选择条目。（本文档中没有进一步讨论第二种形式。）第三种形式用于选择DN请求范围内的条目。<code>&lt;DN&gt;</code>是可分辨名称的字符串表示形式，如<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4514.txt">RFC4514所述</a>。</p>
<p>范围可以是<code>base</code>，<code>one</code>，<code>subtree</code>或<code>children</code>。当<code>基地</code>只提供DN的条目相匹配，<code>one</code>匹配，其父母为所提供的DN的条目，<code>subtree</code>的所有条目匹配，其根源在于所提供的DN子树，和<code>children</code>的所有条目匹配的DN下（但不是以项名为DN）。</p>
<p>例如，如果目录包含名为的条目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0: o=suffix</span><br><span class="line">1: cn=Manager,o=suffix</span><br><span class="line">2: ou=people,o=suffix</span><br><span class="line">3: uid=kdz,ou=people,o=suffix</span><br><span class="line">4: cn=addresses,uid=kdz,ou=people,o=suffix</span><br><span class="line">5: uid=hyc,ou=people,o=suffix</span><br></pre></td></tr></table></figure>

<p>然后：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dn.base=&quot;ou=people,o=suffix&quot; match 2;</span><br><span class="line">dn.one=&quot;ou=people,o=suffix&quot; match 3, and 5;</span><br><span class="line">dn.subtree=&quot;ou=people,o=suffix&quot; match 2, 3, 4, and 5; and</span><br><span class="line">dn.children=&quot;ou=people,o=suffix&quot; match 3, 4, and 5.</span><br></pre></td></tr></table></figure>

<p>也可以使用过滤器选择条目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to filter=&lt;ldap filter&gt;</span><br></pre></td></tr></table></figure>

<p>其中<code>&lt;ldap filter&gt;</code>是LDAP搜索过滤器的字符串表示形式，如<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4515.txt">RFC4515中所述</a>。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to filter=(objectClass=person)</span><br></pre></td></tr></table></figure>

<p>请注意，可以通过在<code>&lt;what&gt;</code>子句中包含两个限定符来由DN和过滤器选择条目。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to dn.one=&quot;ou=people,o=suffix&quot; filter=(objectClass=person)</span><br></pre></td></tr></table></figure>

<p>请注意，可以通过在<code>&lt;what&gt;</code>子句中包含两个限定符来由DN和过滤器选择条目。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attrs=&lt;attribute list&gt;</span><br></pre></td></tr></table></figure>

<p>通过使用单个属性名称并使用值选择器来选择属性的特定值：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attrs=&lt;attribute&gt; val[.&lt;style&gt;]=&lt;regex&gt;</span><br></pre></td></tr></table></figure>

<p>有两个特殊的<em>伪</em>属性<code>条目</code>和<code>子项</code>。要读取（并返回）目标条目，主体必须具有对目标<em>条目</em>属性的<code>读取</code>访问权限。要执行搜索，主题必须具有对搜索库<em>条目</em>属性的<code>搜索</code>访问权限。要添加或删除条目，主体必须<code>写入</code>到条目的访问<code>入口</code>属性，必须有<code>写</code>访问条目的父级的<code>子级</code>属性。要重命名的条目，主题必须<code>写</code>进入的访问<code>入口</code>属性并且具有对旧父级和新父级的<code>子级</code>属性的<code>写</code>访问权限。本节末尾的完整示例应该有助于清除。</p>
<p>最后，有一个特殊的条目选择器<code>“*”</code>用于选择任何条目。当没有提供其他<code>&lt;what&gt;</code>选择器时使用它。这相当于“<code>dn=.*</code> ”</p>
<h4 id="8-2-2-谁授予访问权限"><a href="#8-2-2-谁授予访问权限" class="headerlink" title="8.2.2 谁授予访问权限"></a>8.2.2 谁授予访问权限</h4><p>&lt;who&gt;部分标识被授予访问权限的实体或实体。请注意，访问权限授予“实体”而不是“条目”。下表总结了实体说明符：</p>
<table>
<thead>
<tr>
<th><strong>Specifier</strong></th>
<th><strong>Entities</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>*</code></td>
<td>全部，包括匿名和经过身份验证的用户</td>
</tr>
<tr>
<td><code>anonymous</code></td>
<td>匿名（未认证）用户</td>
</tr>
<tr>
<td><code>users</code></td>
<td>认证用户</td>
</tr>
<tr>
<td><code>self</code></td>
<td>与目标条目关联的用户</td>
</tr>
<tr>
<td><code>dn[.&lt;basic-style&gt;]=&lt;regex&gt;</code></td>
<td>用户匹配正则表达式</td>
</tr>
<tr>
<td><code>dn.&lt;scope-style&gt;=&lt;DN&gt;</code></td>
<td>DN范围内的用户</td>
</tr>
</tbody></table>
<p>DN说明符的行为非常类似于&lt;what&gt;子句DN说明符。</p>
<p>还支持其他控制因素。例如，<code>&lt;who&gt;</code>可以被访问应用的条目中的DN值属性中列出的条目限制：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnattr=&lt;dn-valued attribute name&gt;</span><br></pre></td></tr></table></figure>

<p>dnattr规范用于授予访问其DN在条目的属性中的条目的访问权限（例如，授予访问组条目以列为组条目的所有者的任何用户的访问权限）。</p>
<p>在所有环境（或任何）环境中，某些因素可能不合适。例如，域名依赖于IP到域名查找。因为这些可以很容易被欺骗，因此应该避免领域因素。</p>
<h4 id="8-2-3-获得授权"><a href="#8-2-3-获得授权" class="headerlink" title="8.2.3 获得授权"></a>8.2.3 获得授权</h4><p>授予的&lt;access&gt;类型可以是以下之一：</p>
<p><strong>表6.4：访问级别:</strong></p>
<table>
<thead>
<tr>
<th><strong>Level</strong></th>
<th><strong>权限</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>none        =</td>
<td>0</td>
<td>无法访问</td>
</tr>
<tr>
<td>disclose    =</td>
<td>d</td>
<td>需要信息披露的错误</td>
</tr>
<tr>
<td>auth        =</td>
<td>dx</td>
<td>需要验证（绑定）</td>
</tr>
<tr>
<td>compare     =</td>
<td>cdx</td>
<td>需要比较</td>
</tr>
<tr>
<td>search      =</td>
<td>scdx</td>
<td>需要应用搜索过滤器</td>
</tr>
<tr>
<td>read        =</td>
<td>rscdx</td>
<td>需要阅读搜索结果</td>
</tr>
<tr>
<td>write       =</td>
<td>wrscdx</td>
<td>需要修改/重命名</td>
</tr>
<tr>
<td>manage      =</td>
<td>mwrscdx</td>
<td>需要管理</td>
</tr>
</tbody></table>
<p>每个级别意味着所有较低级别的访问。因此，例如，给予某人<code>写</code>访问的入口也授予他们<code>阅读</code>，<code>搜索</code>，<code>比较</code>，<code>权威性</code>和<code>公开</code>访问。但是，可以使用特权说明符来授予特定权限。</p>
<h4 id="8-2-4-访问控制评估"><a href="#8-2-4-访问控制评估" class="headerlink" title="8.2.4 访问控制评估"></a>8.2.4 访问控制评估</h4><p>当评估某个请求者是否需要访问条目和/或属性时，slapd将条目和/或属性与配置文件中给出的<code>&lt;what&gt;</code>选择器进行比较。对于每个条目，<br>数据库中提供的存储条目的访问控制（或全局访问指令，如果不保存在任何数据库中）首先应用，然后应用全局访问指令。然而，当处理访问列表时，<br>由于全局访问列表被有效地附加到每个每个数据库列表中，所以如果结果列表不为空，则访问列表将以<code>* by * none</code>指令的隐式<code>访问</code>结束。如果没有适用于后端的访问指令，则使用默认读取。</p>
<p>在这个优先级中，访问指令按照它们在配置文件中出现的顺序进行检查。Slapd与第一个匹配条目和/或属性的<code>&lt;what&gt;</code>选择器停止。相应的访问指令是用于评估访问的一个slapd。</p>
<p>接下来，slapd将请求访问的实体与上面选择的访问指令中的<code>&lt;who&gt;</code>选择器按其出现顺序进行比较。它与第一个<code>&lt;who&gt;</code>选择符匹配请求者停止。这决定了请求访问的实体对入口和/或属性的访问。</p>
<p>最后，slapd将选定的<code>&lt;access&gt;</code>子句中授予的访问权限与客户端请求的访问进行比较。如果允许访问权限更大或相等，则授予访问权限。否则访问被拒绝。</p>
<p>访问指令的评估顺序使得它们在配置文件中的位置重要。如果一个访问指令比另一个访问指令更具体，那么它应该首先显示在配置文件中。类似地，如果一个<code>&lt;who&gt;</code>选择器比另一个更具体，那么它应该在access指令中首先出现。下面给出的访问控制示例应该有助于清楚。</p>
<h4 id="8-2-5-访问控制示例"><a href="#8-2-5-访问控制示例" class="headerlink" title="8.2.5 访问控制示例"></a>8.2.5 访问控制示例</h4><p>上述访问控制设施相当强大。本节显示了用于描述目的的一些示例。</p>
<p>一个简单的例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access to * by * read</span><br></pre></td></tr></table></figure>

<p>此访问指令授予对所有人的读访问权限。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">    by self write</span><br><span class="line">    by anonymous auth</span><br><span class="line">    by * read</span><br></pre></td></tr></table></figure>

<p>该指令允许用户修改其条目，允许匿名者对这些条目进行身份验证，并允许所有其他人读取这些条目。请注意，只有第一个<code>通过&lt;who&gt;</code>子句匹配。因此，匿名用户被授予<code>认证</code>，而不是<code>阅读</code>。最后一个条款也可以“<code>被用户阅读</code> ”。</p>
<p>通常希望根据现有的保护级别来限制操作。以下显示如何使用安全强度因子（SSF）。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">    by ssf=128 self write</span><br><span class="line">    by ssf=64 anonymous auth</span><br><span class="line">    by ssf=64 users read</span><br></pre></td></tr></table></figure>

<p>如果已建立强度为128或更好的安全保护，允许用户修改自己的条目，允许对匿名用户进行身份验证，并在已建立64或更好的安全保护时读取访问权限。如果客户端尚未建立足够的安全保护，则将使用隐含<code>的* none</code>子句。</p>
<p>以下示例显示了使用样式说明符在两个访问指令中按顺序选择DN的条目。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">access to dn.children=&quot;dc=example,dc=com&quot;</span><br><span class="line">     by * search</span><br><span class="line">access to dn.children=&quot;dc=com&quot;</span><br><span class="line">     by * read</span><br></pre></td></tr></table></figure>

<p>读取访问权限被授予<code>dc = com</code>子树下的条目，除了<code>dc = example，dc = com</code>子树之下的条目，授予搜索访问权限。由于两个访问指令都不匹配此DN，<br>因此无法访问<code>dc = com</code>。如果这些访问指令的顺序被颠倒，则将永远不会达到尾随指令，因为<code>dc = example，dc = com</code>下的所有条目也都在<code>dc = com</code>条目下。</p>
<p>另请注意，如果没有<code>访问</code>指令与<code>&lt;who&gt;</code>子句匹配或否，<strong>访问被拒绝</strong>。也就是说，每个<code>对</code>指令的<code>访问都以``* none</code>子句隐含。<br>当处理访问列表时，因为全局访问列表被有效地附加到每个数据库列表中，如果结果列表不为空，则访问列表将以<code>* by * none</code>指令的隐式<code>访问</code>结束。如果没有适用于后端的访问指令，则使用默认读取。</p>
<p>下一个例子再次显示了对访问指令和<code>&lt;who&gt;</code>子句的排序的重要性。它还显示了使用属性选择器来授予对特定属性和各种<code>&lt;who&gt;</code>选择器的访问权限。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">access to dn.subtree=&quot;dc=example,dc=com&quot; attrs=homePhone</span><br><span class="line">    by self write</span><br><span class="line">    by dn.children=&quot;dc=example,dc=com&quot; search</span><br><span class="line">    by peername.regex=IP=10\..+ read</span><br><span class="line">access to dn.subtree=&quot;dc=example,dc=com&quot;</span><br><span class="line">    by self write</span><br><span class="line">    by dn.children=&quot;dc=example,dc=com&quot; search</span><br><span class="line">    by anonymous auth</span><br></pre></td></tr></table></figure>

<p>此示例适用于“<code>dc = example，dc = com</code> ”子树中的条目。对于除<code>homePhone</code>之外的所有属性，一个条目可以写入自己，<br><code>example.com</code>条目下的条目可以由他们进行搜索，任何人除了认证/授权（总是匿名完成）之外没有访问权限（<code>由* none</code>隐含）。<br>所述<code>HOMEPHONE</code>属性由条目，通过条目搜索下是可写<code>example.com</code>，通过从网络10连接的客户端可读的，否则不读取（隐式<code>由*无</code>）。所有其他访问被<code>* *</code>的隐式访问所拒绝。</p>
<p>有时，允许特定的DN从属性中添加或删除自己是有用的。例如，如果要创建一个组，并允许人们从成员属性中添加和删除其自己的DN，则可以使用如下所示的访问指令来实现：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access to attrs=member,entry</span><br><span class="line">     by dnattr=member selfwrite</span><br></pre></td></tr></table></figure>

<p>dnattr<code>&lt;who&gt;</code>选择器表示该访问适用于<code>成员</code>属性中列出的条目。自<code>写</code>访问选择器说，这样的成员只能从属性添加或删除自己的DN，而不是其他值。添加条目属性是必需的，因为访问该条目需要访问条目的任何属性。</p>
<h3 id="8-3-通过动态配置访问控制"><a href="#8-3-通过动态配置访问控制" class="headerlink" title="8.3 通过动态配置访问控制"></a>8.3 通过动态配置访问控制</h3><p>对slapd条目和属性的访问由olcAccess属性控制，其值是一系列访问指令。olcAccess配置的一般形式是：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: &lt;access directive&gt;</span><br><span class="line">&lt;access directive&gt; ::= to &lt;what&gt;</span><br><span class="line">    [by &lt;who&gt; [&lt;access&gt;] [&lt;control&gt;] ]+</span><br><span class="line">&lt;what&gt; ::= * |</span><br><span class="line">    [dn[.&lt;basic-style&gt;]=&lt;regex&gt; | dn.&lt;scope-style&gt;=&lt;DN&gt;]</span><br><span class="line">    [filter=&lt;ldapfilter&gt;] [attrs=&lt;attrlist&gt;]</span><br><span class="line">&lt;basic-style&gt; ::= regex | exact</span><br><span class="line">&lt;scope-style&gt; ::= base | one | subtree | children</span><br><span class="line">&lt;attrlist&gt; ::= &lt;attr&gt; [val[.&lt;basic-style&gt;]=&lt;regex&gt;] | &lt;attr&gt; , &lt;attrlist&gt;</span><br><span class="line">&lt;attr&gt; ::= &lt;attrname&gt; | entry | children</span><br><span class="line">&lt;who&gt; ::= * | [anonymous | users | self</span><br><span class="line">        | dn[.&lt;basic-style&gt;]=&lt;regex&gt; | dn.&lt;scope-style&gt;=&lt;DN&gt;]</span><br><span class="line">    [dnattr=&lt;attrname&gt;]</span><br><span class="line">    [group[/&lt;objectclass&gt;[/&lt;attrname&gt;][.&lt;basic-style&gt;]]=&lt;regex&gt;]</span><br><span class="line">    [peername[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [sockname[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [domain[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [sockurl[.&lt;basic-style&gt;]=&lt;regex&gt;]</span><br><span class="line">    [set=&lt;setspec&gt;]</span><br><span class="line">    [aci=&lt;attrname&gt;]</span><br><span class="line">&lt;access&gt; ::= [self]&#123;&lt;level&gt;|&lt;priv&gt;&#125;</span><br><span class="line">&lt;level&gt; ::= none | disclose | auth | compare | search | read | write | manage</span><br><span class="line">&lt;priv&gt; ::= &#123;=|+|-&#125;&#123;m|w|r|s|c|x|d|0&#125;+</span><br><span class="line">&lt;control&gt; ::= [stop | continue | break]</span><br></pre></td></tr></table></figure>

<p>其中&lt;what&gt;部分选择访问适用的条目和/或属性，<code>&lt;who&gt;</code>部分指定哪些实体被授予访问权限，并且<code>&lt;access&gt;</code>部分指定所授予的访问权限。<br>支持多个<code>&lt;who&gt; &lt;access&gt; &lt;control&gt;</code>三元组，允许许多实体被授予对同一组条目和属性的不同访问权限。不是所有这些访问控制选项都在这里描述; 有关更多详细信息，请参阅<em>slapd.access</em>（5）手册页。</p>
<h4 id="8-3-1-什么来控制访问"><a href="#8-3-1-什么来控制访问" class="headerlink" title="8.3.1 什么来控制访问"></a>8.3.1 什么来控制访问</h4><p>访问规范的&lt;what&gt;部分确定访问控制适用于的条目和属性。条目通常以两种方式进行选择：通过DN和过滤器。以下限定符通过DN选择条目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">to *</span><br><span class="line">to dn[.&lt;basic-style&gt;]=&lt;regex&gt;</span><br><span class="line">to dn.&lt;scope-style&gt;=&lt;DN&gt;</span><br></pre></td></tr></table></figure>

<p>第一个表单用于选择所有条目。第二种形式可以用于通过将正则表达式与目标条目的<em>标准化DN</em>相匹配来选择条目。<br>（本文档中没有进一步讨论第二种形式。）第三种形式用于选择DN请求范围内的条目。&lt;DN&gt;是可分辨名称的字符串表示形式，如<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4514.txt">RFC4514所述</a>。</p>
<p>范围可以是<code>base</code>，<code>one</code>，<code>subtree</code>或<code>children</code>。当<code>基地</code>只提供DN的条目相匹配，<code>one</code>匹配，其父母为所提供的DN的条目，<code>subtree</code>的所有条目匹配，其根源在于所提供的DN子树，和<code>children</code>的所有条目匹配的DN下（但不是以项名为DN）。</p>
<p>例如，如果目录包含名为的条目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0: o=suffix</span><br><span class="line">1: cn=Manager,o=suffix</span><br><span class="line">2: ou=people,o=suffix</span><br><span class="line">3: uid=kdz,ou=people,o=suffix</span><br><span class="line">4: cn=addresses,uid=kdz,ou=people,o=suffix</span><br><span class="line">5: uid=hyc,ou=people,o=suffix</span><br></pre></td></tr></table></figure>

<p>然后：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dn.base=&quot;ou=people,o=suffix&quot; match 2;</span><br><span class="line">dn.one=&quot;ou=people,o=suffix&quot; match 3, and 5;</span><br><span class="line">dn.subtree=&quot;ou=people,o=suffix&quot; match 2, 3, 4, and 5; and</span><br><span class="line">dn.children=&quot;ou=people,o=suffix&quot; match 3, 4, and 5.</span><br></pre></td></tr></table></figure>

<p>也可以使用过滤器选择条目：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to filter=&lt;ldap filter&gt;</span><br></pre></td></tr></table></figure>

<p>其中&lt;ldap filter&gt;是LDAP搜索过滤器的字符串表示形式，如<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4515.txt">RFC4515中所述</a>。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to filter=(objectClass=person)</span><br></pre></td></tr></table></figure>

<p>请注意，可以通过在&lt;what&gt;子句中包含两个限定符来由DN和过滤器选择条目。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to dn.one=&quot;ou=people,o=suffix&quot; filter=(objectClass=person)</span><br></pre></td></tr></table></figure>

<p>通过在&lt;what&gt;选择器中包含逗号分隔的属性名称列表来选择条目中的属性：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attrs=&lt;attribute list&gt;</span><br></pre></td></tr></table></figure>

<p>通过使用单个属性名称并使用值选择器来选择属性的特定值：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attrs=&lt;attribute&gt; val[.&lt;style&gt;]=&lt;regex&gt;</span><br></pre></td></tr></table></figure>

<p>有两个特殊的<em>伪</em>属性<code>条目</code>和<code>子项</code>。要读取（并返回）目标条目，主体必须具有对目标<em>条目</em>属性的<code>读取</code>访问权限。要执行搜索，主题必须具有对搜索库<em>条目</em>属性的<code>搜索</code>访问权限。要添加或删除条目，主体必须<code>写入</code>到条目的访问<code>入口</code>属性，必须有<code>写</code>访问条目的父级的<code>子级</code>属性。要重命名的条目，主题必须<code>写</code>进入的访问<code>入口</code>属性并且具有对旧父级和新父级的<code>子级</code>属性的<code>写</code>访问权限。本节末尾的完整示例应该有助于清除。</p>
<p>最后，有一个特殊的条目选择器<code>“*”</code>用于选择任何条目。当没有提供其他<code>&lt;what&gt;</code>选择器时使用它。这相当于“<code>dn =。*</code> ”</p>
<h4 id="8-3-2-谁授予访问权限"><a href="#8-3-2-谁授予访问权限" class="headerlink" title="8.3.2 谁授予访问权限"></a>8.3.2 谁授予访问权限</h4><p>&lt;who&gt;部分标识被授予访问权限的实体或实体。请注意，访问权限授予“实体”而不是“条目”。下表总结了实体说明符：</p>
<p><strong>表5.3：访问实体指定符:</strong></p>
<table>
<thead>
<tr>
<th><strong>Specifier</strong></th>
<th><strong>Entities</strong></th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>全部，包括匿名和经过身份验证的用户</td>
</tr>
<tr>
<td>anonymous</td>
<td>匿名（未认证）用户</td>
</tr>
<tr>
<td>users</td>
<td>认证用户</td>
</tr>
<tr>
<td>self</td>
<td>与目标条目关联的用户</td>
</tr>
<tr>
<td>dn[.&lt;basic-style&gt;]=&lt;regex&gt;</td>
<td>用户匹配正则表达式</td>
</tr>
<tr>
<td>dn.&lt;scope-style&gt;=&lt;DN&gt;</td>
<td>DN范围内的用户</td>
</tr>
</tbody></table>
<p>DN说明符的行为非常类似于&lt;what&gt;子句DN说明符。</p>
<p>还支持其他控制因素。例如，<code>&lt;who&gt;</code>可以被访问应用的条目中的DN值属性中列出的条目限制：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnattr=&lt;dn-valued attribute name&gt;</span><br></pre></td></tr></table></figure>

<p>dnattr规范用于授予访问其DN在条目的属性中的条目的访问权限（例如，授予访问组条目以列为组条目的所有者的任何用户的访问权限）。</p>
<p>在所有环境（或任何）环境中，某些因素可能不合适。例如，域名依赖于IP到域名查找。因为这些可以很容易被欺骗，因此应该避免领域因素。</p>
<h4 id="8-3-3-获得授权"><a href="#8-3-3-获得授权" class="headerlink" title="8.3.3 获得授权"></a>8.3.3 获得授权</h4><p>授予的&lt;access&gt;类型可以是以下之一：</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>权限</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>none</td>
<td>=0</td>
<td>无法访问</td>
</tr>
<tr>
<td>disclose</td>
<td>=d</td>
<td>需要信息披露的错</td>
</tr>
<tr>
<td>auth</td>
<td>=dx</td>
<td>需要验证（绑定）</td>
</tr>
<tr>
<td>compare</td>
<td>=cdx</td>
<td>需要比较</td>
</tr>
<tr>
<td>search</td>
<td>=scdx</td>
<td>需要应用搜索过滤器</td>
</tr>
<tr>
<td>read</td>
<td>=rscdx</td>
<td>需要阅读搜索结果</td>
</tr>
<tr>
<td>write</td>
<td>=wrscdx</td>
<td>需要修改/重命名</td>
</tr>
<tr>
<td>manage</td>
<td>=mwrscdx</td>
<td>需要管理</td>
</tr>
</tbody></table>
<p>每个级别意味着所有较低级别的访问。因此，例如，给予某人<code>写</code>访问的入口也授予他们<code>阅读</code>，<code>搜索</code>，<code>比较</code>，<code>权威性</code>和<code>公开</code>访问。但是，可以使用特权说明符来授予特定权限。</p>
<h4 id="8-3-4-访问控制评估"><a href="#8-3-4-访问控制评估" class="headerlink" title="8.3.4 访问控制评估"></a>8.3.4 访问控制评估</h4><p>当评估某个请求者是否需要访问条目和/或属性时，slapd将条目和/或属性与配置中给出的<code>&lt;what&gt;</code>选择器进行比较。<br>对于每个条目，在数据库中提供的存储条目的访问控制（或全局访问指令，如果不保存在任何数据库中）首先应用，<br>然后应用全局访问指令（保存在<code>前端</code>数据库定义中）。然而，当处理访问列表时，由于全局访问列表被有效地附加到每个每个数据库列表中，<br>所以如果结果列表不为空，则访问列表将以<code>* by * none</code>指令的隐式<code>访问</code>结束。如果没有适用于后端的访问指令，则使用默认读取。</p>
<p>在此优先级内，按照配置属性中显示的顺序检查访问指令。Slapd与第一个匹配条目和/或属性的<code>&lt;what&gt;</code>选择器停止。相应的访问指令是用于评估访问的一个slapd。</p>
<p>接下来，slapd将请求访问的实体与上面选择的访问指令中的<code>&lt;who&gt;</code>选择器按其出现顺序进行比较。它与第一个<code>&lt;who&gt;</code>选择符匹配请求者停止。这决定了请求访问的实体对入口和/或属性的访问。</p>
<p>最后，slapd将选定的<code>&lt;access&gt;</code>子句中授予的访问权限与客户端请求的访问进行比较。如果允许访问权限更大或相等，则授予访问权限。否则访问被拒绝。</p>
<p>访问指令的评估顺序使得它们在配置文件中的位置重要。如果一个访问指令在其选择的条目方面比其他访问指令更具体，那么它应该首先显示在配置中。类似地，如果一个<code>&lt;who&gt;</code>选择器比另一个更具体，那么它应该在access指令中首先出现。下面给出的访问控制示例应该有助于清楚。</p>
<h4 id="8-3-5-访问控制示例"><a href="#8-3-5-访问控制示例" class="headerlink" title="8.3.5 访问控制示例"></a>8.3.5 访问控制示例</h4><p>上述访问控制设施相当强大。本节显示了用于描述目的的一些示例。</p>
<p>一个简单的例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: to * by * read</span><br></pre></td></tr></table></figure>

<p>此访问指令授予对所有人的读访问权限。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: to *</span><br><span class="line">    by self write</span><br><span class="line">    by anonymous auth</span><br><span class="line">    by * read</span><br></pre></td></tr></table></figure>

<p>该指令允许用户修改其条目，允许匿名者对这些条目进行身份验证，并允许所有其他人读取这些条目。请注意，只有第一个<code>通过&lt;who&gt;</code>子句匹配。因此，匿名用户被授予<code>认证</code>，而不是<code>阅读</code>。最后一个条款也可以“<code>被用户阅读</code> ”。</p>
<p>通常希望根据现有的保护级别来限制操作。以下显示如何使用安全强度因子（SSF）。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: to *</span><br><span class="line">    by ssf=128 self write</span><br><span class="line">    by ssf=64 anonymous auth</span><br><span class="line">    by ssf=64 users read</span><br></pre></td></tr></table></figure>

<p>该指令允许用户修改自己的条目，如果强度为128或更好的安全保护已建立，允许对匿名用户的身份验证访问，并且在强度达到64或更好的安全保护建立时读取访问权限。如果客户端尚未建立足够的安全保护，则将使用隐含的<code>by * none</code>子句。</p>
<p>以下示例显示了使用样式说明符在两个访问指令中选择DN的条目，其中排序很重要。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: to dn.children=&quot;dc=example,dc=com&quot;</span><br><span class="line">     by * search</span><br><span class="line">olcAccess: to dn.children=&quot;dc=com&quot;</span><br><span class="line">     by * read</span><br></pre></td></tr></table></figure>

<p>读取访问权限被授予<code>dc = com</code>子树下的条目，除了<code>dc = example，dc = com</code>子树之下的条目，授予搜索访问权限。由于两个访问指令都不匹配此DN，<br>因此无法访问<code>dc = com</code>。如果这些访问指令的顺序被颠倒，则将永远不会达到尾随指令，因为<code>dc = example，dc = com</code>下的所有条目也都在<code>dc = com</code>条目下。</p>
<p>另请注意，如果没有<code>olcAccess：to</code>指令匹配或否<code>由&lt;who&gt;</code>子句，<strong>访问被拒绝</strong>。当处理访问列表时，因为全局访问列表被有效地附加到每个数据库列表中，<br>如果结果列表不为空，则访问列表将以<code>* by * none</code>指令的隐式<code>访问</code>结束。如果没有适用于后端的访问指令，则使用默认读取。</p>
<p>下一个例子再次显示了对访问指令和<code>&lt;who&gt;</code>子句的排序的重要性。它还显示了使用属性选择器来授予对特定属性和各种<code>&lt;who&gt;</code>选择器的访问权限。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: to dn.subtree=&quot;dc=example,dc=com&quot; attrs=homePhone</span><br><span class="line">    by self write</span><br><span class="line">    by dn.children=dc=example,dc=com&quot; search</span><br><span class="line">    by peername.regex=IP=10\..+ read</span><br><span class="line">olcAccess: to dn.subtree=&quot;dc=example,dc=com&quot;</span><br><span class="line">    by self write</span><br><span class="line">    by dn.children=&quot;dc=example,dc=com&quot; search</span><br><span class="line">    by anonymous auth</span><br></pre></td></tr></table></figure>

<p>此示例适用于“<code>dc = example，dc = com</code> ”子树中的条目。对于除<code>homePhone</code>之外的所有属性，一个条目可以写入自己，<br><code>example.com</code>条目下的条目可以由他们进行搜索，任何人除了认证/授权（总是匿名完成）之外没有访问权限（<code>由* none</code>隐含）。<br>所述<code>HOMEPHONE</code>属性由条目，通过条目搜索下是可写<code>example.com</code>，通过从网络10连接的客户端可读的，否则不读取（隐式<code>由*无</code>）。所有其他访问被<code>* *</code>的隐式访问所拒绝。</p>
<p>有时，允许特定的DN从属性中添加或删除自己是有用的。例如，如果要创建一个组，并允许人们从成员属性中添加和删除其自己的DN，则可以使用如下所示的访问指令来实现：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: to attrs=member,entry</span><br><span class="line">     by dnattr=member selfwrite</span><br></pre></td></tr></table></figure>

<p>dnattr<code>&lt;who&gt;</code>选择器表示该访问适用于<code>成员</code>属性中列出的条目。自<code>写</code>访问选择器说，这样的成员只能从属性添加或删除自己的DN，而不是其他值。添加条目属性是必需的，因为访问该条目需要访问条目的任何属性。</p>
<h4 id="8-3-6-访问控制订购"><a href="#8-3-6-访问控制订购" class="headerlink" title="8.3.6 访问控制订购"></a>8.3.6 访问控制订购</h4><p>由于<code>olcAccess</code>指令的排序对其正确的评估至关重要，但LDAP属性通常不会保留其值的排序，因此OpenLDAP使用自定义模式扩展来维护这些值的固定排序。<br>通过为每个值预先添加一个<code>“&#123;X&#125;”</code>数字索引来维护此顺序，与用于排序配置条目的方法类似。这些索引标签由slapd自动保存，在最初定义值时不需要指定。例如，创建设置时</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: to attrs=member,entry</span><br><span class="line">     by dnattr=member selfwrite</span><br><span class="line">olcAccess: to dn.children=&quot;dc=example,dc=com&quot;</span><br><span class="line">     by * search</span><br><span class="line">olcAccess: to dn.children=&quot;dc=com&quot;</span><br><span class="line">     by * read</span><br></pre></td></tr></table></figure>

<p>当您使用slapcat或ldapsearch读取它们时，它们将包含</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: &#123;0&#125;to attrs=member,entry</span><br><span class="line">     by dnattr=member selfwrite</span><br><span class="line">olcAccess: &#123;1&#125;to dn.children=&quot;dc=example,dc=com&quot;</span><br><span class="line">     by * search</span><br><span class="line">olcAccess: &#123;2&#125;to dn.children=&quot;dc=com&quot;</span><br><span class="line">     by * read</span><br></pre></td></tr></table></figure>

<p>数字索引可用于指定使用ldapmodify编辑访问规则时要更改的特定值。可以使用该索引来代替（或除了）实际的访问值。当管理多个访问规则时，使用此数字索引非常有用。</p>
<p>例如，如果我们需要更改上面的第二个规则来授予写访问权限而不是搜索，我们可以尝试这个LDIF：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">changetype: modify</span><br><span class="line">delete: olcAccess</span><br><span class="line">olcAccess: to dn.children=&quot;dc=example,dc=com&quot; by * search</span><br><span class="line">-</span><br><span class="line">add: olcAccess</span><br><span class="line">olcAccess: to dn.children=&quot;dc=example,dc=com&quot; by * write</span><br><span class="line">-</span><br></pre></td></tr></table></figure>

<p>但是，此示例<strong>不能</strong>保证现有值保持原始顺序，因此很可能会导致安全配置不正确。相反，应使用数字索引：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">changetype: modify</span><br><span class="line">delete: olcAccess</span><br><span class="line">olcAccess: &#123;1&#125;</span><br><span class="line">-</span><br><span class="line">add: olcAccess</span><br><span class="line">olcAccess: &#123;1&#125;to dn.children=&quot;dc=example,dc=com&quot; by * write</span><br><span class="line">-</span><br></pre></td></tr></table></figure>

<p>此示例删除<code>olcAccess</code>属性（不管其值）的值＃1中的任何规则，并添加明确插入为值＃1的新值。结果将是</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">olcAccess: &#123;0&#125;to attrs=member,entry</span><br><span class="line">     by dnattr=member selfwrite</span><br><span class="line">olcAccess: &#123;1&#125;to dn.children=&quot;dc=example,dc=com&quot;</span><br><span class="line">     by * write</span><br><span class="line">olcAccess: &#123;2&#125;to dn.children=&quot;dc=com&quot;</span><br><span class="line">     by * read</span><br></pre></td></tr></table></figure>

<p>这正是目的。</p>
<h3 id="8-4-访问控制常见示例"><a href="#8-4-访问控制常见示例" class="headerlink" title="8.4 访问控制常见示例"></a>8.4 访问控制常见示例</h3><h4 id="8-4-1-基本ACL"><a href="#8-4-1-基本ACL" class="headerlink" title="8.4.1 基本ACL"></a>8.4.1 基本ACL</h4><p>一般应该从一些基本的ACL开始，如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">access to attrs=userPassword</span><br><span class="line">    by self =xw</span><br><span class="line">    by anonymous auth</span><br><span class="line">    by * none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  access to *</span><br><span class="line">    by self write</span><br><span class="line">    by users read</span><br><span class="line">    by * none</span><br></pre></td></tr></table></figure>

<p>第一个ACL允许用户更新（而不是读取）他们的密码，匿名用户对此属性进行身份验证，并且（隐含地）拒绝所有对他人的访问。</p>
<p>第二个ACL允许用户完全访问其条目，经过身份验证的用户读取任何内容，并（隐式）拒绝对其他人（在本例中为匿名用户）的所有访问。</p>
<h4 id="8-4-2-匹配匿名和经过身份验证的用户"><a href="#8-4-2-匹配匿名和经过身份验证的用户" class="headerlink" title="8.4.2 匹配匿名和经过身份验证的用户"></a>8.4.2 匹配匿名和经过身份验证的用户</h4><p>匿名用户具有空DN。虽然可以使用<em>dn.exact =“”</em>或<em>dn.regex =“^ $”</em>，但<em>slapd</em>（8））提供了一个匿名的简写，而应该使用它。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">  by anonymous none</span><br><span class="line">  by * read</span><br></pre></td></tr></table></figure>

<p>拒绝所有访问匿名用户，同时授予他人阅读。</p>
<p>经过身份验证的用户拥有主题DN。虽然<em>dn.regex =“。+”</em>将匹配任何经过身份验证的用户，但OpenLDAP为用户提供了短用的代码。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">  by users read</span><br><span class="line">  by * none</span><br></pre></td></tr></table></figure>

<p>此ACL在拒绝其他用户（即：匿名用户））时向已验证的用户授予读取权限。</p>
<h4 id="8-4-3-控制rootdn访问"><a href="#8-4-3-控制rootdn访问" class="headerlink" title="8.4.3 控制rootdn访问"></a>8.4.3 控制rootdn访问</h4><p>您可以在<em>slapd.conf</em>（5）或<em>slapd.d中</em>指定<em>rootdn</em>，而不指定<em>rootpw</em>。那么你必须添加一个具有相同dn的实际目录条目，例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Manager,o=MyOrganization</span><br><span class="line">cn: Manager</span><br><span class="line">sn: Manager</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: top</span><br><span class="line">userPassword: &#123;SSHA&#125;someSSHAdata</span><br></pre></td></tr></table></figure>

<p>然后绑定为<em>rootdn</em>将需要对该DN进行常规绑定，这又需要对该条目的DN和<em>userPassword进行</em>身份验证访问，这可以通过ACL进行限制。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access to dn.base=&quot;cn=Manager,o=MyOrganization&quot;</span><br><span class="line">  by peername.regex=127\.0\.0\.1 auth</span><br><span class="line">  by peername.regex=192\.168\.0\..* auth</span><br><span class="line">  by users none</span><br><span class="line">  by * none</span><br></pre></td></tr></table></figure>

<p>上面的ACL只允许使用roothost从localhost和192.168.0.0/24进行绑定。</p>
<h4 id="8-4-4-使用组管理访问"><a href="#8-4-4-使用组管理访问" class="headerlink" title="8.4.4 使用组管理访问"></a>8.4.4 使用组管理访问</h4><p>有几种方法可以做到这一点。这里说明了一种方法。考虑以下DIT布局：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+-dc=example,dc=com</span><br><span class="line">+---cn=administrators,dc=example,dc=com</span><br><span class="line">+---cn=fred blogs,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>和以下组对象（LDIF格式）：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=administrators,dc=example,dc=com</span><br><span class="line">cn: administrators of this region</span><br><span class="line">objectclass: groupOfNames  (important for the group acl feature)</span><br><span class="line">member: cn=fred blogs,dc=example,dc=com</span><br><span class="line">member: cn=somebody else,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>然后，可以通过将适当<em>的group</em>子句添加到<em>slapd.conf</em>（5）中的访问指令，来授予对此组的成员的访问权限。例如，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">access to dn.children=&quot;dc=example,dc=com&quot;</span><br><span class="line">    by self write</span><br><span class="line">    by group.exact=&quot;cn=Administrators,dc=example,dc=com&quot; write</span><br><span class="line">    by * auth</span><br></pre></td></tr></table></figure>

<p>像<em>dn</em>子句一样，还可以使用<em>expand</em>来根据目标的正则表达式匹配来扩展组名，也就是到<em>dn.regex</em>。例如，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access to dn.regex=&quot;(.+,)?ou=People,(dc=[^,]+,dc=[^,]+)$&quot;</span><br><span class="line">         attrs=children,entry,uid</span><br><span class="line">    by group.expand=&quot;cn=Managers,$2&quot; write</span><br><span class="line">    by users read</span><br><span class="line">    by * auth</span><br></pre></td></tr></table></figure>

<p>以上图示假定要在<em>groupOfNames</em>对象类的<em>成员</em>属性类型中找到组成员。如果您需要使用不同的组对象和/或不同的属性类型，请使用以下<em>slapd.conf</em>（5）（缩写）语法：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access to &lt;what&gt;</span><br><span class="line">        by group/&lt;objectclass&gt;/&lt;attributename&gt;=&lt;DN&gt; &lt;access&gt;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">  by group/organizationalRole/roleOccupant=&quot;cn=Administrator,dc=example,dc=com&quot; write</span><br></pre></td></tr></table></figure>

<p>在这种情况下，我们有一个ObjectClass <em>organizationalRole</em>，其中包含<em>roleOccupant</em>属性中的管理员DN 。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Administrator,dc=example,dc=com</span><br><span class="line">cn: Administrator</span><br><span class="line">objectclass: organizationalRole</span><br><span class="line">roleOccupant: cn=Jane Doe,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>指定的成员属性类型必须为DN或<em>NameAndOptionalUID</em>语法，并且指定的对象类SHOULD允许属性类型。</p>
<h4 id="8-4-5-授予对属性子集的访问权限"><a href="#8-4-5-授予对属性子集的访问权限" class="headerlink" title="8.4.5 授予对属性子集的访问权限"></a>8.4.5 授予对属性子集的访问权限</h4><p>您可以通过在ACL <em>to</em>子句中指定属性名称列表来授予对一组属性的访问权限。为了有用，您还需要授予对该<em>条目</em>本身的访问权限。还要注意<em>儿童</em>如何控制添加，删除和重命名条目的能力。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># mail: self may write, authenticated users may read</span><br><span class="line">access to attrs=mail</span><br><span class="line">  by self write</span><br><span class="line">  by users read</span><br><span class="line">  by * none</span><br><span class="line"></span><br><span class="line"># cn, sn: self my write, all may read</span><br><span class="line">access to attrs=cn,sn</span><br><span class="line">  by self write</span><br><span class="line">  by * read</span><br><span class="line"></span><br><span class="line"># immediate children: only self can add/delete entries under this entry</span><br><span class="line">access to attrs=children</span><br><span class="line">  by self write</span><br><span class="line"></span><br><span class="line"># entry itself: self may write, all may read</span><br><span class="line">access to attrs=entry</span><br><span class="line">  by self write</span><br><span class="line">  by * read</span><br><span class="line"></span><br><span class="line"># other attributes: self may write, others have no access</span><br><span class="line">access to *</span><br><span class="line">  by self write</span><br><span class="line">  by * none</span><br></pre></td></tr></table></figure>

<p>也可以在此列表中指定ObjectClass名称，这将影响该<em>objectClass</em>所需和/或允许的所有属性。实际上，以前缀为*@* 是 <em>attrlist</em>中的名称直接被视为objectClass名称。一个名字作为前缀<em>！</em>也被视为一个对象类，但在这种情况下，访问规则影响不需要的，也不由允许的属性<em>对象类</em>。</p>
<h4 id="8-4-6-允许用户写入其下的所有条目"><a href="#8-4-6-允许用户写入其下的所有条目" class="headerlink" title="8.4.6 允许用户写入其下的所有条目"></a>8.4.6 允许用户写入其下的所有条目</h4><p>对于用户可以写入自己的记录及其所有子项的设置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access to dn.regex=&quot;(.+,)?(uid=[^,]+,o=Company)$&quot;</span><br><span class="line">   by dn.exact,expand=&quot;$2&quot; write</span><br><span class="line">   by anonymous auth</span><br></pre></td></tr></table></figure>

<p>（添加上面的更多示例）</p>
<h4 id="8-4-7-允许创建条目"><a href="#8-4-7-允许创建条目" class="headerlink" title="8.4.7 允许创建条目"></a>8.4.7 允许创建条目</h4><p>假设你有这样的想法：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">o=&lt;basedn&gt;</span><br><span class="line">    ou=domains</span><br><span class="line">        associatedDomain=&lt;somedomain&gt;</span><br><span class="line">            ou=users</span><br><span class="line">                uid=&lt;someuserid&gt;</span><br><span class="line">                uid=&lt;someotheruserid&gt;</span><br><span class="line">            ou=addressbooks</span><br><span class="line">                uid=&lt;someuserid&gt;</span><br><span class="line">                    cn=&lt;someone&gt;</span><br><span class="line">                    cn=&lt;someoneelse&gt;</span><br></pre></td></tr></table></figure>

<p>而另一个域&lt;someotherdomain&gt;：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">o=&lt;basedn&gt;</span><br><span class="line">    ou=domains</span><br><span class="line">        associatedDomain=&lt;someotherdomain&gt;</span><br><span class="line">            ou=users</span><br><span class="line">                uid=&lt;someuserid&gt;</span><br><span class="line">                uid=&lt;someotheruserid&gt;</span><br><span class="line">            ou=addressbooks</span><br><span class="line">                uid=&lt;someotheruserid&gt;</span><br><span class="line">                    cn=&lt;someone&gt;</span><br><span class="line">                    cn=&lt;someoneelse&gt;</span><br></pre></td></tr></table></figure>

<p>那么，如果你想用户*的uid = &lt;someuserid&gt;*以<strong>ONLY</strong>创造自己的事项，你可以写一个这样的ACL：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># this rule lets users of &quot;associatedDomain=&lt;matcheddomain&gt;&quot;</span><br><span class="line"># write under &quot;ou=addressbook,associatedDomain=&lt;matcheddomain&gt;,ou=domains,o=&lt;basedn&gt;&quot;,</span><br><span class="line"># i.e. a user can write ANY entry below its domain&#x27;s address book;</span><br><span class="line"># this permission is necessary, but not sufficient, the next</span><br><span class="line"># will restrict this permission further</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">access to dn.regex=&quot;^ou=addressbook,associatedDomain=([^,]+),ou=domains,o=&lt;basedn&gt;$&quot; attrs=children</span><br><span class="line">        by dn.regex=&quot;^uid=([^,]+),ou=users,associatedDomain=$1,ou=domains,o=&lt;basedn&gt;$$&quot; write</span><br><span class="line">        by * none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Note that above the &quot;by&quot; clause needs a &quot;regex&quot; style to make sure</span><br><span class="line"># it expands to a DN that starts with a &quot;uid=&lt;someuserid&gt;&quot; pattern</span><br><span class="line"># while substituting the associatedDomain submatch from the &quot;what&quot; clause.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># This rule lets a user with &quot;uid=&lt;matcheduid&gt;&quot; of &quot;&lt;associatedDomain=matcheddomain&gt;&quot;</span><br><span class="line"># write (i.e. add, modify, delete) the entry whose DN is exactly</span><br><span class="line"># &quot;uid=&lt;matcheduid&gt;,ou=addressbook,associatedDomain=&lt;matcheddomain&gt;,ou=domains,o=&lt;basedn&gt;&quot;</span><br><span class="line"># and ANY entry as subtree of it</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">access to dn.regex=&quot;^(.+,)?uid=([^,]+),ou=addressbook,associatedDomain=([^,]+),ou=domains,o=&lt;basedn&gt;$&quot;</span><br><span class="line">        by dn.exact,expand=&quot;uid=$2,ou=users,associatedDomain=$3,ou=domains,o=&lt;basedn&gt;&quot; write</span><br><span class="line">        by * none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Note that above the &quot;by&quot; clause uses the &quot;exact&quot; style with the &quot;expand&quot;</span><br><span class="line"># modifier because now the whole pattern can be rebuilt by means of the</span><br><span class="line"># submatches from the &quot;what&quot; clause, so a &quot;regex&quot; compilation and evaluation</span><br><span class="line"># is no longer required.</span><br></pre></td></tr></table></figure>

<h4 id="8-4-8-在Access-Control中使用正则表达式的提示"><a href="#8-4-8-在Access-Control中使用正则表达式的提示" class="headerlink" title="8.4.8 在Access Control中使用正则表达式的提示"></a>8.4.8 在Access Control中使用正则表达式的提示</h4><p>当您打算使用正则表达式匹配时，始终使用*dn.regex = &lt;pattern&gt;<em>。</em>dn = &lt;pattern&gt;<em>单独默认为</em>dn.exact &lt;pattern&gt;*。</p>
<p>当您想要至少匹配一个字符时，使用<em>（.+）</em>而不是<em>（.*）</em>。<em>（.*）也</em>匹配空字符串。</p>
<p>不要使用正则表达式，否则可以以更安全和更便宜的方式进行匹配。例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dn.regex=&quot;.*dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>是不安全和昂贵的：</p>
<ul>
<li>不安全，因为包含<em>dc=example，dc=com的</em>任何字符串都不会匹配，而不是以所需的模式结束的字符串; 使用** dc=example，dc=com $*。</li>
<li>不安全，因为它将允许任何<em>attributeType</em>以<em>dc</em>结尾为字符串中第一个RDN的命名属性，例如自定义的attributeType <em>mydc</em>也会匹配。如果真的需要一个正则表达式，它只允许<em>dc=example，dc=com</em>或其任何子树，请使用*^(,+,)？dc = example，dc = com $*，这意味着：dc=…（如果有的话（括号内的模式后面的问号）必须以逗号结尾;</li>
<li>昂贵，因为如果你不需要submatches，你可以使用范围设计样式，例如</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dn.subtree=&quot;dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>在匹配模式中包括<em>dc = example，dc = com</em>，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dn.children=&quot;dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>从匹配模式中排除<em>dc = example，dc = com</em>，或者</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dn.onelevel=&quot;dc=example,dc=com&quot;</span><br></pre></td></tr></table></figure>

<p>只允许一个子级匹配。</p>
<p>因为 <code>ou =（.+），ou =（.+），ou=addressbooks，o=basedn</code> 将匹配 <code>something=bla，ou=xxx，ou=yyy，ou=addressbooks</code> ，总是在正则表达式中使用 <code>^</code> 和 <code>$</code>，<code>o=basedn中，ou=addressbooks，o= BaseDN中，dc=some，dc=org</code></p>
<p>始终使用 <code>(\[^，\] +)</code> 来表示一个RDN，因为 <code>().+)</code> 可以包含任意数量的RDN; 例如 <code>ou =（。+），dc = example，dc = com</code> 将匹配 <code>ou = My，o = Org，dc = example，dc = com</code> ，这可能不是你想要的。</p>
<p>不要将rootdn添加到by子句中。对于使用rootdn身份执行的操作，ACL甚至不会被处理（否则根本就没有理由定义rootdn）。</p>
<p>使用shorthands。用户指令与经过身份验证的用户匹配，匿名指令与匿名用户匹配。</p>
<p>如果您需要的是范围和/或子字符串替换，则不要使用 <code>dn.regex</code> 表单来执行<code>&lt;by&gt;</code>子句。使用范围设计样式（例如，<em>精确</em>，<em>一级</em>，<em>子级</em>或<em>子树</em>），并且样式修饰符将展开以引起子字符串扩展。</p>
<p>例如，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access to dn.regex=&quot;.+,dc=([^,]+),dc=([^,]+)$&quot;</span><br><span class="line">  by dn.regex=&quot;^[^,],ou=Admin,dc=$1,dc=$2$$&quot; write</span><br></pre></td></tr></table></figure>

<p>虽然正确，可以安全有效地代替</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access to dn.regex=&quot;.+,(dc=[^,]+,dc=[^,]+)$&quot;</span><br><span class="line">  by dn.onelevel,expand=&quot;ou=Admin,$1&quot; write</span><br></pre></td></tr></table></figure>

<p>其中*&lt;what&gt;<em>子句中的正则表达式更紧凑，并且</em>&lt;by&gt;*子句中的正则表达式被具有子字符串扩展的更高效的一级方法范围取代。</p>
<h4 id="8-4-9-基于安全强度因素（ssf）授予和拒绝访问权限"><a href="#8-4-9-基于安全强度因素（ssf）授予和拒绝访问权限" class="headerlink" title="8.4.9 基于安全强度因素（ssf）授予和拒绝访问权限"></a>8.4.9 基于安全强度因素（ssf）授予和拒绝访问权限</h4><p>您可以根据安全强度因子（SSF）限制访问</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access to dn=&quot;cn=example,cn=edu&quot;</span><br><span class="line">      by * ssf=256 read</span><br></pre></td></tr></table></figure>

<p>0（零）意味着没有保护，1表示完整性保护，56 DES或其他弱密码，112三重DES和其他强密码，128 RC4，Blowfish等现代强密码。</p>
<p>其他可能性：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">transport_ssf=&lt;n&gt;</span><br><span class="line">tls_ssf=&lt;n&gt;</span><br><span class="line">sasl_ssf=&lt;n&gt;</span><br></pre></td></tr></table></figure>

<p>建议使用256。</p>
<p>请参见<em>slapd.conf中</em>的信息（5）<em>SSF</em>。</p>
<h4 id="8-4-10-当事情不按预期工作时"><a href="#8-4-10-当事情不按预期工作时" class="headerlink" title="8.4.10 当事情不按预期工作时"></a>8.4.10 当事情不按预期工作时</h4><p>考虑这个例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">  by anonymous auth</span><br><span class="line"></span><br><span class="line">access to *</span><br><span class="line">  by self write</span><br><span class="line"></span><br><span class="line">access to *</span><br><span class="line">  by users read</span><br></pre></td></tr></table></figure>

<p>您可能认为这将允许任何用户登录，阅读所有内容并更改自己的数据，如果他已经登录。但是在这个例子中，只有登录工作，并且ldapsearch不返回任何数据。问题是，SLAPD逐行执行其访问配置，并在访问规则的一部分找到匹配后立即停止（这里：***）</p>
<p>要获得我们想要的文件必须阅读：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">  by anonymous auth</span><br><span class="line">  by self write</span><br><span class="line">  by users read</span><br></pre></td></tr></table></figure>

<p>一般规则是：“特殊访问规则第一，通用访问规则最后”</p>
<p>另请参见<em>slapd.access</em>（5），loglevel 128和<em>slapacl</em>（8）来调试信息。</p>
<h3 id="8-5-集-根据关系授予权限"><a href="#8-5-集-根据关系授予权限" class="headerlink" title="8.5 集 - 根据关系授予权限"></a>8.5 集 - 根据关系授予权限</h3><p>集合通过示例最好地说明。以下部分将介绍几个ACL示例，以便于他们的理解。</p>
<p>（设置在访问控制FAQ条目：<a target="_blank" rel="noopener" href="http://www.openldap.org/faq/data/cache/1133.html">http</a> : <a target="_blank" rel="noopener" href="http://www.openldap.org/faq/data/cache/1133.html">//www.openldap.org/faq/data/cache/1133.html</a>）</p>
<p><strong>注意：</strong>集合被认为是实验性的。</p>
<h4 id="8-5-1-群组"><a href="#8-5-1-群组" class="headerlink" title="8.5.1 群组"></a>8.5.1 群组</h4><p>组的OpenLDAP ACL不会扩展组内的组，它们是具有另一组作为成员的组。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=sudoadm,ou=group,dc=example,dc=com</span><br><span class="line">cn: sudoadm</span><br><span class="line">objectClass: groupOfNames</span><br><span class="line">member: uid=john,ou=people,dc=example,dc=com</span><br><span class="line">member: cn=accountadm,ou=group,dc=example,dc=com</span><br><span class="line"></span><br><span class="line">dn: cn=accountadm,ou=group,dc=example,dc=com</span><br><span class="line">cn: accountadm</span><br><span class="line">objectClass: groupOfNames</span><br><span class="line">member: uid=mary,ou=people,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>如果我们使用具有上述条目的标准组ACL，并允许<code>sudoadm</code>组的成员写入某个地方，则不会包括<code>mary</code>：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access to dn.subtree=&quot;ou=sudoers,dc=example,dc=com&quot;</span><br><span class="line">        by group.exact=&quot;cn=sudoadm,ou=group,dc=example,dc=com&quot; write</span><br><span class="line">        by * read</span><br></pre></td></tr></table></figure>

<p>使用集合，我们可以使ACL成为递归，并在组内考虑组。因此，对于每个成员，它进一步扩展：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access to dn.subtree=&quot;ou=sudoers,dc=example,dc=com&quot;</span><br><span class="line">      by set=&quot;[cn=sudoadm,ou=group,dc=example,dc=com]/member* &amp; user&quot; write</span><br><span class="line">      by * read</span><br></pre></td></tr></table></figure>

<p>此设置ACL意味着：取<code>cn = sudoadm</code> DN，检查其<code>成员</code>属性（“<code>*</code> ”表示递归），并将结果与经过身份验证的用户DN相交。如果结果不为空，则将ACL视为匹配，并授予写访问权限。</p>
<p>下图解释了如何构建这个集合：</p>
<p><img src="https://qiniu.iclouds.work/FoylQKTYLfguYkfrAUxV1bcWeofE.png" alt="图XY：填充递归组集"></p>
<p>首先我们得到<code>uid = john</code> DN。此条目没有<code>成员</code>属性，因此扩展在此停止。现在我们来到<code>cn = accountadm</code>。这个确实有一个<code>成员</code>属性，这是<code>uid = mary</code>。该<code>UID =玛丽</code>项，然而，没有成员，所以我们在这里再次停止。最后的比较是：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;uid=john,ou=people,dc=example,dc=com&quot;,&quot;uid=mary,ou=people,dc=example,dc=com&quot;&#125; &amp; user</span><br></pre></td></tr></table></figure>

<p>如果经过身份验证的用户的DN是其中的任何一个，则授予写访问权限。所以这集将包括<code>玛丽</code>中<code>sudoadm</code>组，她将被允许写访问。</p>
<h4 id="8-5-2-没有DN语法的组ACL"><a href="#8-5-2-没有DN语法的组ACL" class="headerlink" title="8.5.2 没有DN语法的组ACL"></a>8.5.2 没有DN语法的组ACL</h4><p>传统的组ACL，甚至上一个关于递归组的例子，都要求成员被指定为DN而不是用户名。</p>
<p>然而，使用集合，也可以在组ACL中使用简单的名称，如该示例所示。</p>
<p>假设我们要允许<code>sudoadm</code>组的成员写入我们树的<code>ou = suders</code>分支。但是我们现在的组定义是使用<code>memberUid</code>作为组成员：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=sudoadm,ou=group,dc=example,dc=com</span><br><span class="line">cn: sudoadm</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">gidNumber: 1000</span><br><span class="line">memberUid: john</span><br></pre></td></tr></table></figure>

<p>使用这种类型的组，我们不能使用组ACL。但是使用一组ACL，我们可以授予所需的访问权限：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access to dn.subtree=&quot;ou=sudoers,dc=example,dc=com&quot;</span><br><span class="line">      by set=&quot;[cn=sudoadm,ou=group,dc=example,dc=com]/memberUid &amp; user/uid&quot; write</span><br><span class="line">      by * read</span><br></pre></td></tr></table></figure>

<p>我们使用一个简单的交集，我们将连接（和认证）用户的<code>uid</code>属性与组的<code>memberUid</code>属性进行比较。如果匹配，交叉路口不为空，ACL将授予写入权限。</p>
<p>当连接用户被认证为<code>uid = john，ou = people，dc = example，dc = com</code>时，此图说明了该集合：</p>
<p><img src="https://qiniu.iclouds.work/Fn9FyhrGdS01P9RVlzfAuSJLfmUH.png" alt="图XY：使用`memberUid进行`设置"></p>
<p>在这种情况下，这是一场比赛。然而，如果它是<code>mary</code>验证的，她将被拒绝对<code>ou = sudoers的</code>写入权限，因为她的<code>uid</code>属性没有列在该组的<code>memberUid中</code>。</p>
<h4 id="8-5-3-以下参考"><a href="#8-5-3-以下参考" class="headerlink" title="8.5.3 以下参考"></a>8.5.3 以下参考</h4><p>现在我们将展示一个非常强大的例子，说明可以用套来做什么。这个例子倾向于使OpenLDAP管理员在理解它及其含义之后微笑。</p>
<p>我们从一个用户条目开始：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dn: uid=john,ou=people,dc=example,dc=com</span><br><span class="line">uid: john</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">givenName: John</span><br><span class="line">sn: Smith</span><br><span class="line">cn: john</span><br><span class="line">manager: uid=mary,ou=people,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>编写ACL以允许管理员更新某些属性是非常简单的使用集合：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access to dn.exact=&quot;uid=john,ou=people,dc=example,dc=com&quot;</span><br><span class="line">   attrs=carLicense,homePhone,mobile,pager,telephoneNumber</span><br><span class="line">   by self write</span><br><span class="line">   by set=&quot;this/manager &amp; user&quot; write</span><br><span class="line">   by * read</span><br></pre></td></tr></table></figure>

<p>在该集合中，<code>这</code>扩展到被访问的条目，以便在访问约翰条目时，<code>该/ manager</code>扩展为<code>uid = mary，ou = people，dc = example，dc = com</code>。如果经理自己正在访问约翰的条目，则ACL将匹配，并且将授予对这些属性的写访问权限。</p>
<p>到目前为止，使用<code>dnattr</code>关键字可以获得同样的行为。然而，使用集合，我们可以进一步增强此ACL。假设我们想允许经理的秘书也更新这些属性。这是我们的做法：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">access to dn.exact=&quot;uid=john,ou=people,dc=example,dc=com&quot;</span><br><span class="line">   attrs=carLicense,homePhone,mobile,pager,telephoneNumber</span><br><span class="line">   by self write</span><br><span class="line">   by set=&quot;this/manager &amp; user&quot; write</span><br><span class="line">   by set=&quot;this/manager/secretary &amp; user&quot; write</span><br><span class="line">   by * read</span><br></pre></td></tr></table></figure>

<p>现在我们需要一张照片来帮助解释这里发生了什么（为了清楚起见，条目缩短）：</p>
<p><img src="https://qiniu.iclouds.work/FpRVHSwbdNwpOccDGg141q4ayWKR.png" alt="图XY：设置跳过条目"></p>
<p>在这个例子中，简是玛丽的秘书，是约翰的经理。这个整体关系由<code>经理</code>和<code>秘书</code>属性定义，它们都是distinguishedName语法（即，完整的DN）。因此，当<code>uid = john</code>条目被访问时，<code>这个/ manager / secretary</code>集合变为<code>&#123;“uid = jane，ou = people，dc = example，dc = com”</code> }（遵循图片中的引用）：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">this = [uid=john,ou=people,dc=example,dc=com]</span><br><span class="line">this/manager = \</span><br><span class="line">  [uid=john,ou=people,dc=example,dc=com]/manager = uid=mary,ou=people,dc=example,dc=com</span><br><span class="line">this/manager/secretary = \</span><br><span class="line">  [uid=mary,ou=people,dc=example,dc=com]/secretary = uid=jane,ou=people,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>最终的结果是当Jane访问John的条目时，她将被授予对指定属性的写访问权限。更好的是，这将会发生在她访问的任何一个玛丽作为经理。</p>
<p>这是很酷和好，但也许给秘书太多的权力。也许我们需要进一步限制。例如，让我们只允许执行秘书有这样的权力：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">access to dn.exact=&quot;uid=john,ou=people,dc=example,dc=com&quot;</span><br><span class="line">  attrs=carLicense,homePhone,mobile,pager,telephoneNumber</span><br><span class="line">  by self write</span><br><span class="line">  by set=&quot;this/manager &amp; user&quot; write</span><br><span class="line">  by set=&quot;this/manager/secretary &amp;</span><br><span class="line">          [cn=executive,ou=group,dc=example,dc=com]/member* &amp;</span><br><span class="line">          user&quot; write</span><br><span class="line">  by * read</span><br></pre></td></tr></table></figure>

<p>它与以前几乎是一样的ACL，但我们现在也要求连接用户是（可能嵌套的）<code>cn =executive</code>组的成员。</p>
<h2 id="13-模式规范"><a href="#13-模式规范" class="headerlink" title="13 模式规范"></a>13 模式规范</h2><p>本章介绍如何扩展<em>slapd</em>（8）使用的用户模式。本章假设读者熟悉了LDAP/X.500 信息模型。</p>
<p>第一部分，<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/schema.html#Distributed%20Schema%20Files">分布式模式文件</a>详细说明了分发中提供的可选模式定义以及获取其他定义的位置。<br>第二部分“ <a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/schema.html#Extending%20Schema">扩展架构</a> ”详细介绍了如何定义新的架构项目。</p>
<p>本章不讨论如何扩展<em>slapd</em>（8）使用的系统模式，因为这需要源代码修改。系统架构包括所有操作属性类型或允许或需要操作属性（直接或间接）的任何对象类。</p>
<h3 id="13-1-分布式模式文件"><a href="#13-1-分布式模式文件" class="headerlink" title="13.1 分布式模式文件"></a>13.1 分布式模式文件</h3><p>OpenLDAP软件分布有一组模式规范供您使用。每个集合都在一个适合包含（使用<code>include</code>指令）的文件中定义在您的<em>slapd.conf</em>（5）文件中。这些模式文件通常安装在<code>/usr/local/etc/openldap/schema</code>目录中。</p>
<table>
<thead>
<tr>
<th><strong>File</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>core.schema</td>
<td>OpenLDAP <em>core</em> (required)</td>
</tr>
<tr>
<td>cosine.schema</td>
<td>Cosine and Internet X.500 (useful)</td>
</tr>
<tr>
<td>inetorgperson.schema</td>
<td>InetOrgPerson (useful)</td>
</tr>
<tr>
<td>misc.schema</td>
<td>Assorted (experimental)</td>
</tr>
<tr>
<td>nis.schema</td>
<td>Network Information Services (FYI)</td>
</tr>
<tr>
<td>openldap.schema</td>
<td>OpenLDAP Project (experimental)</td>
</tr>
</tbody></table>
<p>要使用任何这些模式文件，您只需要将所需的文件包含在<em>slapd.conf</em>（5）文件的全局定义部分中。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># include schema</span><br><span class="line">include /usr/local/etc/openldap/schema/core.schema</span><br><span class="line">include /usr/local/etc/openldap/schema/cosine.schema</span><br><span class="line">include /usr/local/etc/openldap/schema/inetorgperson.schema</span><br></pre></td></tr></table></figure>

<p>其他文件可能可用。请咨询OpenLDAP常问问题（<a target="_blank" rel="noopener" href="http://www.openldap.org/faq/">http://www.openldap.org/faq/</a>）。</p>
<p><strong>注意：</strong>不应修改提供的文件中定义的任何模式项。</p>
<h3 id="13-2-扩展架构"><a href="#13-2-扩展架构" class="headerlink" title="13.2 扩展架构"></a>13.2 扩展架构</h3><p>可以扩展<em>slapd</em>（8）使用的模式，以支持其他语法，匹配规则，属性类型和对象类。本章详细介绍了如何使用slapd支持的语法和匹配规则添加用户应用程序属性类型和对象类。slapd也可以扩展以支持额外的语法，匹配规则和系统模式，但这需要一些编程，因此这里不讨论。</p>
<p>定义新模式有五个步骤：</p>
<ol>
<li>获取对象标识符</li>
<li>选择名称前缀</li>
<li>创建本地架构文件</li>
<li>定义自定义属性类型（如有必要）</li>
<li>定义自定义对象类</li>
</ol>
<h4 id="13-2-1-对象标识符"><a href="#13-2-1-对象标识符" class="headerlink" title="13.2.1 对象标识符"></a>13.2.1 对象标识符</h4><p>每个架构元素由全局唯一标识 对象标识符（OID）。OID也用于识别其他对象。它们通常用协议描述ASN.1。特别是，它们被大量使用简单网络管理协议（SNMP）。由于OID是分级的，您的组织可以获得一个OID，并根据需要进行分支。例如，如果您的组织分配了OID<code>1.1</code>，则可以按如下方式分支树：</p>
<p><strong>表8.2：OID层次结构示例:</strong></p>
<table>
<thead>
<tr>
<th><strong>OID</strong></th>
<th><strong>Assignment</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1.1</td>
<td>Organization’s OID</td>
</tr>
<tr>
<td>1.1.1</td>
<td>SNMP Elements</td>
</tr>
<tr>
<td>1.1.2</td>
<td>LDAP Elements</td>
</tr>
<tr>
<td>1.1.2.1</td>
<td>AttributeTypes</td>
</tr>
<tr>
<td>1.1.2.1.1</td>
<td>x-my-Attribute</td>
</tr>
<tr>
<td>1.1.2.2</td>
<td>ObjectClasses</td>
</tr>
<tr>
<td>1.1.2.2.1</td>
<td>x-my-ObjectClass</td>
</tr>
</tbody></table>
<p>当然，您可以自由地设计适合您组织OID下的组织需求的层次结构。不管你选择什么层次结构，你应该保留一个你所做的作业的注册表。这可以是一个简单的平面文件或更复杂的一些，例如<em>OpenLDAP OID Registry</em>（<a target="_blank" rel="noopener" href="http://www.openldap.org/faq/index.cgi?file=197">http://www.openldap.org/faq/index.cgi?file=197</a>）。</p>
<p>有关对象标识符（以及列表服务）的更多信息，请参见<a target="_blank" rel="noopener" href="http://www.alvestrand.no/objectid/">http://www.alvestrand.no/objectid/</a>。</p>
<p>为了获得注册的OID在<em>没有成本</em>，申请下OID <a target="_blank" rel="noopener" href="http://www.iana.org/">互联网编号分配机构</a>（ORG：IANA）维护<em>民营企业</em>的弧线。任何私营企业（组织）可以要求私营企业号（PEN）被分配在这个弧。只需填写IANA表单，<a target="_blank" rel="noopener" href="http://pen.iana.org/pen/PenApplication.page">网址</a>为<a target="_blank" rel="noopener" href="http://pen.iana.org/pen/PenApplication.page">http://pen.iana.org/pen/PenApplication.page</a>，您的官方笔会通常在几天内发送给您。您的基地OID将像<code>1.3.6.1.4.1.X</code>这样的<code>X</code>，其中<code>X</code>是一个整数。</p>
<p>注意：使用此表单获取的PEN可用于任何目的，包括识别LDAP模式元素。</p>
<p>或者，OID名称空间可以从国家机构获得（例如，<a target="_blank" rel="noopener" href="http://www.ansi.org/">ANSI</a>，<a target="_blank" rel="noopener" href="http://www.bsi-global.com/">BSI</a>）。</p>
<h4 id="13-2-2-命名元素"><a href="#13-2-2-命名元素" class="headerlink" title="13.2.2 命名元素"></a>13.2.2 命名元素</h4><p>除了为每个架构元素分配唯一的对标识符之外，还应为每个元素提供至少一个文本名称。名称应该向<a target="_blank" rel="noopener" href="http://www.iana.org/">IANA</a>注册，或者以“x-”为前缀，放在“私人使用”的名称空间中。</p>
<p>该名称应该是描述性的，不可能与其他模式元素的名称冲突。特别地，您选择的任何名称不应与现在或将来的标准曲目名称冲突（如果您以“x-”开头注册名称或使用名称），则可以保证。</p>
<p>请注意，您可以获得自己的注册名称前缀，以避免不必单独注册您的姓名。有关详细信息，请参阅<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4520.txt">RFC4520</a>。</p>
<p>在下面的例子中，我们使用了一个短的前缀’<code>x-my-</code> ‘。这样一个短的前缀只适合于一个非常大的全球组织。一般来说，我们建议像“<code>x-de-Firm-</code> ”（德国公司）或“<code>x-com-Example</code> ”（与<code>example.com</code>相关的组织相关的元素）。</p>
<h4 id="13-2-3-本地架构文件"><a href="#13-2-3-本地架构文件" class="headerlink" title="13.2.3 本地架构文件"></a>13.2.3 本地架构文件</h4><p>该<code>对象类</code>和<code>attributeTypes</code>配置文件指令可以被用来在目录中的条目定义模式规则。通常要创建一个文件来包含自定义模式项的定义。我们建议您在<code>/usr/local/etc/openldap/schema/local.schema中</code>创建一个文件<code>local.schema</code>，然后在其他模式<code>include</code>指令之后立即将此文件包含在<em>slapd.conf</em>（5）文件中。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># include schema</span><br><span class="line">include /usr/local/etc/openldap/schema/core.schema</span><br><span class="line">include /usr/local/etc/openldap/schema/cosine.schema</span><br><span class="line">include /usr/local/etc/openldap/schema/inetorgperson.schema</span><br><span class="line"># include local schema</span><br><span class="line">include /usr/local/etc/openldap/schema/local.schema</span><br></pre></td></tr></table></figure>

<h4 id="13-2-4-属性类型规范"><a href="#13-2-4-属性类型规范" class="headerlink" title="13.2.4 属性类型规范"></a>13.2.4 属性类型规范</h4><p>该<em>属性类型</em>指令用于定义一个新的属性类型。该伪指令使用在子模式子条目中找到的attributeTypes属性使用的相同属性类型说明（如<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4512.txt">RFC4512中</a>定义），例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributetype &lt;RFC4512 Attribute Type Description&gt;</span><br></pre></td></tr></table></figure>

<p>其中属性类型描述由以下定义 ABNF：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">AttributeTypeDescription = &quot;(&quot; whsp</span><br><span class="line">      numericoid whsp              ; AttributeType identifier</span><br><span class="line">    [ &quot;NAME&quot; qdescrs ]             ; name used in AttributeType</span><br><span class="line">    [ &quot;DESC&quot; qdstring ]            ; description</span><br><span class="line">    [ &quot;OBSOLETE&quot; whsp ]</span><br><span class="line">    [ &quot;SUP&quot; woid ]                 ; derived from this other</span><br><span class="line">                                   ; AttributeType</span><br><span class="line">    [ &quot;EQUALITY&quot; woid              ; Matching Rule name</span><br><span class="line">    [ &quot;ORDERING&quot; woid              ; Matching Rule name</span><br><span class="line">    [ &quot;SUBSTR&quot; woid ]              ; Matching Rule name</span><br><span class="line">    [ &quot;SYNTAX&quot; whsp noidlen whsp ] ; Syntax OID</span><br><span class="line">    [ &quot;SINGLE-VALUE&quot; whsp ]        ; default multi-valued</span><br><span class="line">    [ &quot;COLLECTIVE&quot; whsp ]          ; default not collective</span><br><span class="line">    [ &quot;NO-USER-MODIFICATION&quot; whsp ]; default user modifiable</span><br><span class="line">    [ &quot;USAGE&quot; whsp AttributeUsage ]; default userApplications</span><br><span class="line">    whsp &quot;)&quot;</span><br><span class="line"></span><br><span class="line">AttributeUsage =</span><br><span class="line">    &quot;userApplications&quot;     /</span><br><span class="line">    &quot;directoryOperation&quot;   /</span><br><span class="line">    &quot;distributedOperation&quot; / ; DSA-shared</span><br><span class="line">    &quot;dSAOperation&quot;          ; DSA-specific, value depends on server</span><br></pre></td></tr></table></figure>

<p>其中whsp是空格（’``’），numericoid是点分十进制形式的全局唯一OID（例如<code>1.1.0</code>），qdescrs是一个或多个名称，wid是名称或OID，可选地后跟一个长度说明符（例如<code>&#123;10</code> }）。</p>
<p>例如，属性类型<code>名称</code>和<code>cn</code>在<code>core.schema</code>中定义为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">attributeType ( 2.5.4.41 NAME &#x27;name&#x27;</span><br><span class="line">        DESC &#x27;name(s) associated with the object&#x27;</span><br><span class="line">        EQUALITY caseIgnoreMatch</span><br><span class="line">        SUBSTR caseIgnoreSubstringsMatch</span><br><span class="line">        SYNTAX 1.3.6.1.4.1.1466.115.121.1.15&#123;32768&#125; )</span><br><span class="line">attributeType ( 2.5.4.3 NAME ( &#x27;cn&#x27; &#x27;commonName&#x27; )</span><br><span class="line">        DESC &#x27;common name(s) associated with the object&#x27;</span><br><span class="line">        SUP name )</span><br></pre></td></tr></table></figure>

<p>请注意，每个定义属性的OID，提供一个简短的名称和一个简短的描述。每个名称都是OID的别名。返回结果时，<em>slapd</em>（8）返回第一个列出的名称。</p>
<p>第一个属性<code>name名称</code>包含<code>directoryString</code>（UTF-8编码Unicode）语法。语法由OID指定（1.3.6.1.4.1.1466.115.121.1.15标识directoryString语法）。指定了32768的长度建议。服务器应支持此长度的值，但可能支持更长的值。该字段不指定大小约束，因此在不强加这种大小限制的服务器（例如slapd）上被忽略。此外，相等和子串匹配使用案例忽略规则。以下是列出常用语法和匹配规则的表（<em>slapd</em>（8）支持这些和更多）。</p>
<h2 id="15-使用SASL"><a href="#15-使用SASL" class="headerlink" title="15 使用SASL"></a>15 使用SASL</h2><p>OpenLDAP客户端和服务器能够通过认证 简单的认证和安全层 （SASL）框架，详见<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc4422.txt">RFC4422</a>。本章介绍如何在OpenLDAP中使用SASL。</p>
<p>有几种可以与SASL一起使用的行业标准认证机制，包括 GSSAPI 对于 Kerberos V， DIGEST-MD5，和 PLAIN 和 EXTERNAL 用于 传输层安全 （TLS）。</p>
<p>OpenLDAP软件提供的标准客户端工具（如<em>ldapsearch</em>（1）和<em>ldapmodify</em>（1））将默认尝试将用户认证为LDAP目录服务器使用SASL。基本身份验证服务可以由LDAP管理员设置几个步骤，允许用户对slapd服务器作为其LDAP条目进行身份验证。通过几个额外的步骤，可以允许一些用户和服务利用SASL的代理授权功能，允许他们自己进行身份验证，然后将其身份切换到另一个用户或服务的身份。</p>
<p>本章假设您已阅读<em>Cyrus SASL（系统管理员）</em>，并附带<a target="_blank" rel="noopener" href="http://asg.web.cmu.edu/sasl/sasl-library.html">Cyrus SASL</a>软件包（<code>doc / sysadmin.html</code>），并安装了Cyrus SASL。您应该使用Cyrus SASL<code>sample_client</code>和<code>sample_server</code>来测试您的SASL安装，然后再尝试使用OpenLDAP软件。</p>
<p>请注意，在以下文本中，术语<em>用户</em>用于描述通过LDAP客户端（如<em>ldapsearch</em>（1））连接到LDAP服务器的人员或应用程序实体。也就是说，术语<em>用户</em>不仅适用于使用LDAP客户端的个人，而且适用于在没有直接用户控制的情况下发出LDAP客户端操作的应用程序实体。例如，使用LDAP操作访问LDAP服务器中保存的信息的电子邮件服务器是应用程序实体。</p>
<h3 id="15-1-SASL安全注意事项"><a href="#15-1-SASL安全注意事项" class="headerlink" title="15.1 SASL安全注意事项"></a>15.1 SASL安全注意事项</h3><p>SASL提供了许多不同的认证机制。本节简要概述了安全考虑。</p>
<p>一些机制，例如PLAIN和LOGIN，提供比LDAP <em>简单</em>认证更大的安全性。像LDAP <em>简单</em>认证一样，除非您有足够的安全保护，否则不应使用此类机制。建议这些机制只能与之配合使用传输层安全（TLS）。本文档不再详细讨论PLAIN和LOGIN的使用。</p>
<p>DIGEST-MD5机制是LDAPv3的强制实施认证机制。虽然与受信任的第三方认证系统相比，DIGEST-MD5不是一种强大的认证机制Kerberos的或公共密钥系统），它确实提供了对许多攻击的重大保护。不一样CRAM-MD5机制，防止选择明文攻击。DIGEST-MD5优于使用明文密码机制。CRAM-MD5机制不赞成使用DIGEST-MD5。下面讨论<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/sasl.html#DIGEST-MD5">DIGEST-MD5的</a>使用。</p>
<p>GSSAPI机制使用 GSS-API Kerberos的V提供安全认证服务。KERBEROS_V4机制适用于使用Kerberos IV的机构。Kerberos被视为适合小型和大型企业的安全的分布式认证系统。下面讨论<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/sasl.html#GSSAPI">GSSAPI</a>和<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/sasl.html#KERBEROS_V4">KERBEROS_V4</a>使用。</p>
<p>EXTERNAL机制利用诸如下级网络服务提供的认证服务 传输层安全 （TLS）。与TLS X.509的公钥技术配合使用时，EXTERNAL提供强大的认证。TLS在“ <a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/tls.html">使用TLS”</a>一章中讨论。</p>
<p>EXTERNAL也可以与<code>ldapi：///</code>传输一起使用，因为Unix-domain sockets可以报告客户端进程的UID和GID。</p>
<p>还有其他强大的认证机制可供选择，包括 OTP （一次密码）和 SRP（安全远程密码）。这些机制在本文档中没有讨论。</p>
<h3 id="15-2-SASL认证"><a href="#15-2-SASL认证" class="headerlink" title="15.2 SASL认证"></a>15.2 SASL认证</h3><p>获取基本的SASL认证运行涉及到几个步骤。第一步配置您的slapd服务器环境，以便可以使用您网站上的安全系统与客户端程序进行通信。<br>这通常涉及设置服务密钥，公钥或其他形式的秘密。第二步涉及将身份验证身份映射到LDAPDN这取决于条目在目录中的布局。<br>将在下一节中使用Kerberos V4作为示例机制给出第一步的说明。您站点身份验证机制所需的步骤将是类似的，但SASL可用的每种机制的指南超出了本章的范围。<br>第二步在“ <a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/sasl.html#Mapping%20Authentication%20Identities">映射身份验证身份</a> ”一节中描述。</p>
<h4 id="15-2-1-GSSAPI"><a href="#15-2-1-GSSAPI" class="headerlink" title="15.2.1 GSSAPI"></a>15.2.1 GSSAPI</h4><p>本节介绍SASL GSSAPI机制和Kerberos V与OpenLDAP的使用。将假设您已部署Kerberos V，您熟悉系统的操作，并且您的用户受到使用的培训。本节还假定您已经熟悉GSSAPI机制的使用，方法是阅读<em>配置GSSAPI和Cyrus SASL</em>（<code>doc / gssapi</code>文件中的<em>Cyrus SASL</em>提供），并成功实验了Cyrus提供的<code>sample_server</code>和<code>sample_client</code>应用程序。有关Kerberos的一般信息，请访问<a target="_blank" rel="noopener" href="http://web.mit.edu/kerberos/www/">http://web.mit.edu/kerberos/www/</a>。</p>
<p>要使用具有<em>slapd</em>（8）的GSSAPI机制，必须在服务运行的主机的领域内为<em>ldap</em>服务的主体创建一个服务密钥。例如，如果在<code>directory.example.com</code>上运行<em>slapd</em>，并且您的领域是<code>EXAMPLE.COM</code>，则需要使用主体创建服务密钥：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldap/directory.example.com@EXAMPLE.COM</span><br></pre></td></tr></table></figure>

<p>当<em>slapd</em>（8）运行时，它必须具有访问该键的权限。这通常通过将密钥放入keytab文件<code>/etc/krb5.keytab</code>。有关keytab位置设置的信息，请参阅Kerberos和Cyrus SASL文档。</p>
<p>要使用GSSAPI机制对目录进行身份验证，用户将在运行LDAP客户端之前获取授权单（TGT）。当使用OpenLDAP客户端工具时，用户可以通过将<code>-Y GSSAPI</code>指定为命令选项来<code>强制</code>使用GSSAPI机制。</p>
<p>为了进行认证和授权，<em>slapd</em>（8）将认证请求DN与以下形式相关联：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=&lt;primary[/instance]&gt;,cn=&lt;realm&gt;,cn=gssapi,cn=auth</span><br></pre></td></tr></table></figure>

<p>继续我们的例子，具有Kerberos主体<code>kurt@EXAMPLE.COM</code>的用户将具有相关的DN：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=kurt,cn=example.com,cn=gssapi,cn=auth</span><br></pre></td></tr></table></figure>

<p>并且主体<code>ursula/admin@FOREIGN.REALM</code>将具有关联的DN：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=ursula/admin,cn=foreign.realm,cn=gssapi,cn=auth</span><br></pre></td></tr></table></figure>

<p>认证请求DN可以直接使用ACL和<code>groupOfNames</code> “member”属性，因为它是合法的LDAP DN格式。或者，可以在使用之前映射认证DN。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/sasl.html#Mapping%20Authentication%20Identities">映射身份验证身份</a>部分。</p>
<h4 id="15-2-2-KERBEROS-V4"><a href="#15-2-2-KERBEROS-V4" class="headerlink" title="15.2.2 KERBEROS_V4"></a>15.2.2 KERBEROS_V4</h4><p>本节介绍使用SASL KERBEROS_V4机制与OpenLDAP。将假定您熟悉Kerberos IV安全系统的运行情况，并且您的站点部署了Kerberos IV。您的用户应该熟悉身份验证策略，如何在Kerberos票证缓存中接收凭据，以及如何刷新过期凭证。</p>
<p><strong>注意：</strong> KERBEROS_V4和Kerberos IV不赞成使用GSSAPI和Kerberos V.</p>
<p>客户端程序需要能够获取会话密钥，以便在连接到LDAP服务器时使用。这允许LDAP服务器知道用户的身份，并允许客户端知道它正在连接到合法的服务器。如果要使用加密层，会话密钥也可以用来帮助协商该选项。</p>
<p>slapd服务器运行名为“ <em>ldap</em> ” 的服务，服务器将需要具有服务密钥的srvtab文件。SASL感知的客户端程序将获得带有用户票证授予票据（TGT）的“ldap”服务票证，其中票据的实例与OpenLDAP服务器的主机名相匹配。例如，如果您的<code>域名</code>为<code>EXAMPLE.COM</code>，并且slapd服务器正在名为<code>directory.example.com</code>的主机上运行，则服务器上的<code>/etc/srvtab</code>文件将具有服务密钥</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldap.directory@EXAMPLE.COM</span><br></pre></td></tr></table></figure>

<p>当LDAP客户端使用KERBEROS_IV机制将用户认证到目录时，它将从票据缓存或通过从Kerberos服务器获取一个新请求来为同一主体请求会话密钥。这将需要TGT在缓存中可用和有效。如果它不存在或已经过期，客户端可能打印出消息：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldap_sasl_interactive_bind_s: Local error</span><br></pre></td></tr></table></figure>

<p>获得服务票证后，将作为用户身份证明传递给LDAP服务器。服务器将使用SASL库调用从服务票证中提取身份和领域，并将其转换为表单的<em>身份验证请求DN</em></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=&lt;username&gt;,cn=&lt;realm&gt;,cn=&lt;mechanism&gt;,cn=auth</span><br></pre></td></tr></table></figure>

<p>所以在上面的例子中，如果用户的名字是“adamson”，认证请求DN将是：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=adamsom,cn=example.com,cn=kerberos_v4,cn=auth</span><br></pre></td></tr></table></figure>

<p>该认证请求DN可以直接使用ACL，也可以在使用前进行映射。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/sasl.html#Mapping%20Authentication%20Identities">映射身份验证身份</a>部分。</p>
<h4 id="15-2-3-DIGEST-MD5"><a href="#15-2-3-DIGEST-MD5" class="headerlink" title="15.2.3 DIGEST-MD5"></a>15.2.3 DIGEST-MD5</h4><p>本节介绍使用SASL DIGEST-MD5机制，使用存储在目录本身或Cyrus SASL自己的数据库中的秘密。DIGEST-MD5依赖于客户端和服务器共享“秘密”，通常是密码。服务器产生一个挑战，并且客户端的响应证明它知道共享的秘密。这比通过电线发送秘密更安全。</p>
<p>赛勒斯SASL支持几种共享秘密机制。为此，它需要访问明文密码（不同于通过线路传递明文密码的机制，服务器可以存储散列版本的密码）。</p>
<p>服务器的共享密钥副本可以存储在Cyrus SASL自己的<em>sasldb</em>数据库中，在通过<em>saslauthd</em>访问的外部系统中或LDAP数据库本身中。在这两种情况下，应用文件访问控制和LDAP访问控制来防止密码暴露是非常重要的。本节讨论的配置和命令假设使用Cyrus SASL 2.1。</p>
<p>要使用存储在<em>sasldb中的</em>秘密，只需使用<em>saslpasswd2</em>命令添加用户：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">saslpasswd2 -c &lt;username&gt;</span><br></pre></td></tr></table></figure>

<p>必须使用<em>saslpasswd2</em>命令管理此类用户的密码。</p>
<p>要使用存储在LDAP目录中的秘密，请将明文密码放在<code>userPassword</code>属性中。有必要为<code>slapd.conf</code>添加一个选项，以确保使用LDAP密码修改操作设置的密码以明文形式存储：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password-hash   &#123;CLEARTEXT&#125;</span><br></pre></td></tr></table></figure>

<p>以这种方式存储的密码可以使用<em>ldappasswd</em>（1）或简单地修改<code>userPassword</code>属性进行管理。无论存储密码在哪里，都需要从认证请求DN到用户DN的映射。</p>
<p>DIGEST-MD5机制产生以下形式的身份验证ID：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=&lt;username&gt;,cn=&lt;realm&gt;,cn=digest-md5,cn=auth</span><br></pre></td></tr></table></figure>

<p>如果使用默认领域，则从ID中省略领域名称，给出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=&lt;username&gt;,cn=digest-md5,cn=auth</span><br></pre></td></tr></table></figure>

<p>有关可选的身份映射的信息，请参阅下面的<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/sasl.html#Mapping%20Authentication%20Identities">映射身份验证</a>身份。</p>
<p>使用合适的映射，用户可以在执行LDAP操作时指定SASL ID，并且将使用存储在<em>sasldb</em>或目录本身中的密码来验证身份验证。例如，由目录条目标识的用户：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Andrew Findlay+uid=u000997,dc=example,dc=com</span><br><span class="line">objectclass: inetOrgPerson</span><br><span class="line">objectclass: person</span><br><span class="line">sn: Findlay</span><br><span class="line">uid: u000997</span><br><span class="line">userPassword: secret</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>在上述每种情况下，都没有提供授权身份（例如<code>-X</code>）。除非您正在尝试<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/sasl.html#SASL%20Proxy%20Authorization">SASL代理授权</a>，否则不应指定授权身份。服务器将从认证身份推断授权身份（如下所述）。</p>
<h4 id="15-2-4-EXTERNAL"><a href="#15-2-4-EXTERNAL" class="headerlink" title="15.2.4 EXTERNAL"></a>15.2.4 EXTERNAL</h4><p>SASL EXTERNAL机制利用较低级协议进行的认证：通常 TLS 或Unix IPC</p>
<p>每个传输协议以其自己的格式返回验证身份：</p>
<h5 id="15-2-4-1-TLS认证身份格式"><a href="#15-2-4-1-TLS认证身份格式" class="headerlink" title="15.2.4.1 TLS认证身份格式"></a>15.2.4.1 TLS认证身份格式</h5><p>这是客户端证书的主题DN。请注意，DN由LDAP和X.509显示不同，因此颁发了证书</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C=gb, O=The Example Organisation, CN=A Person</span><br></pre></td></tr></table></figure>

<p>将产生以下认证身份：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cn=A Person,o=The Example Organisation,c=gb</span><br></pre></td></tr></table></figure>

<p>请注意，您必须为TLSVerifyClient设置合适的值，以使服务器请求使用客户端证书。没有这个，SASL EXTERNAL机制将不会被提供。有关详细信息，请参阅<a target="_blank" rel="noopener" href="http://www.openldap.org/doc/admin24/tls.html">使用TLS</a>一章。</p>
<h5 id="15-2-4-2-IPC-ldapi-Identity-Format"><a href="#15-2-4-2-IPC-ldapi-Identity-Format" class="headerlink" title="15.2.4.2 IPC (ldapi:///) Identity Format"></a>15.2.4.2 IPC (ldapi:///) Identity Format</h5><p>这是由客户端进程的Unix UID和GID组成的：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gidNumber=&lt;number&gt;+uidNumber=&lt;number&gt;,cn=peercred,cn=external,cn=auth</span><br></pre></td></tr></table></figure>

<p>因此，以<code>root</code>身份运行的客户端进程将是：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br></pre></td></tr></table></figure>

<h4 id="15-2-5-映射身份验证身份"><a href="#15-2-5-映射身份验证身份" class="headerlink" title="15.2.5 映射身份验证身份"></a>15.2.5 映射身份验证身份</h4><p>slapd服务器中的认证机制将使用SASL库调用来获取经过身份验证的用户的“用户名”，这取决于所使用的基本身份验证机制。该用户名位于身份验证机制的命名空间中，而不在正常的LDAP命名空间中。如上述部分所述，该用户名重新格式化为表单的认证请求DN</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=&lt;username&gt;,cn=&lt;realm&gt;,cn=&lt;mechanism&gt;,cn=auth</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=&lt;username&gt;,cn=&lt;mechanism&gt;,cn=auth</span><br></pre></td></tr></table></figure>

<p>这取决于&lt;mechanism&gt;是否采用“realms”的概念。还要注意，如果认证中使用了默认领域，则会忽略该领域部分。</p>
<p>所述<em>ldapwhoami命令</em>（1）命令可以被用来确定与用户相关联的身份。确定映射的正确功能非常有用。</p>
<p>您不应该将上述表单的LDAP条目添加到LDAP数据库。您可能有机会为LDAP中的每个人员提供一个LDAP条目，并将其放置在目录树中，树不会从cn = auth开始。但是，如果您的站点在该用户的“用户名”和LDAP条目之间有明确的映射，则可以配置LDAP服务器以自动将认证请求DN映射到用户的<em>身份验证DN</em>。</p>
<p><strong>注意：</strong>不要求认证请求DN和映射导致的用户认证DN指的是目录中保存的条目。但是，可以使用其他功能（见下文）。</p>
<p>LDAP管理员需要告诉slapd服务器如何将身份验证请求DN映射到用户的身份验证DN。这通过在<em>slapd.conf</em>（5）文件中添加一个或多个<code>authz-regexp</code>指令来完成。这个指令有两个参数：**</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authz-regexp &lt;搜索模式&gt; &lt;替换模式&gt;</span><br></pre></td></tr></table></figure>

<p>使用正则表达式函数<em>regcomp</em>（）和<em>regexec</em>（）将认证请求DN与搜索模式进行比较，如果匹配，则将其重写为替换模式。如果存在多个<code>authz-regexp</code>指令，则只使用其搜索模式与身份验证身份匹配的第一个。从替换模式输出的字符串应该是用户的认证DN或LDAP URL。如果替换字符串产生DN，则此DN命名的条目不需要由此服务器持有。如果替换字符串生成LDAP URL，则该LDAP URL必须评估为此服务器所保留的唯一一个条目。</p>
<p>搜索模式可以包含<em>regexec</em>（3C）中列出的任何正则表达式字符。注意的主要特征是点“”，星号“*”和开放的圆括号“（”和“）”。本质上，点匹配任何字符，星号允许紧接在前一个字符或模式的零个或多个重复，括号中的术语被记住替换模式。</p>
<p>替换模式将产生指向用户的DN或URL。与搜索模式中的括号中的字符串匹配的认证请求DN中的任何内容都存储在变量“$ 1”中。该变量“$ 1”可以出现在替换模式中，并将被来自认证请求DN的字符串替换。如果搜索模式中有多组括号，则使用变量$ 2，$ 3等。</p>
<h4 id="15-2-6-直接映射"><a href="#15-2-6-直接映射" class="headerlink" title="15.2.6 直接映射"></a>15.2.6 直接映射</h4><p>在可能的情况下，通常建议将认证请求DN直接映射到用户的DN。除了避免搜索用户DN的费用外，还允许将映射到指向不属于此服务器的条目的DN。</p>
<p>假设认证请求DN被写为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=adamson,cn=example.com,cn=gssapi,cn=auth</span><br></pre></td></tr></table></figure>

<p>用户的实际LDAP条目为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=adamson,ou=people,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>那么<em>slapd.conf</em>（5）中的以下<code>authz-regexp</code>指令将提供直接映射。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authz-regexp</span><br><span class="line">  uid=([^,]*),cn=example.com,cn=gssapi,cn=auth</span><br><span class="line">  uid=$1,ou=people,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>一个更宽松的规则可以写成</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authz-regexp</span><br><span class="line">  uid=([^,]*),cn=[^,]*,cn=auth</span><br><span class="line">  uid=$1,ou=people,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>但是，请仔细设定搜索模式，因为它可能会错误地允许人们认证为不能访问的DN。写一些严格的指令比一个具有安全漏洞的宽松指令更好。如果您的站点上只有一个身份验证机制，以及零个或一个使用的领域，则可以使用单个<code>authz-regexp</code>指令在身份验证身份和LDAP DN之间进行映射。</p>
<p>不要忘记允许省略领域的情况以及具有明确指定领域的情况。对于每种情况，这可能需要单独的<code>authz-regexp</code>指令，其中首先列出显式领域条目。</p>
<h4 id="15-2-7-基于搜索的映射"><a href="#15-2-7-基于搜索的映射" class="headerlink" title="15.2.7 基于搜索的映射"></a>15.2.7 基于搜索的映射</h4><p>有一些情况下映射到LDAP URL可能是适当的。例如，一些站点可能具有位于LDAP树的多个区域中的人物对象，例如，如果存在<code>ou=accounting</code>树和<code>ou=engineering</code>树，并且人物之间散布着它们。或者，也许所需的映射必须基于用户信息中的信息。考虑需要将上述认证请求DN映射到其条目如下的用户：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Mark Adamson,ou=People,dc=Example,dc=COM</span><br><span class="line">objectclass: person</span><br><span class="line">cn: Mark Adamson</span><br><span class="line">uid: adamson</span><br></pre></td></tr></table></figure>

<p>认证请求DN中的信息不足以允许直接导出用户的DN，而是必须搜索用户的DN。对于这些情况，可以在<code>authz-regexp</code>指令中使用生成LDAP URL的替换模式。然后，此URL将用于执行LDAP数据库的内部搜索以查找该人的身份验证DN。</p>
<p>与其他网址相似的LDAP网址为形式</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldap://&lt;host&gt;/&lt;base&gt;?&lt;attrs&gt;?&lt;scope&gt;?&lt;filter&gt;</span><br></pre></td></tr></table></figure>

<p>这包含执行LDAP搜索所需的所有元素：服务器的名称&lt;host&gt;，LDAP DN搜索库&lt;base&gt;，要检索的LDAP属性&lt;attrs&gt;，搜索范围&lt;scope&gt;是三个选项“base”，“one”或“sub”，最后是LDAP搜索过滤器&lt;filter&gt;。由于搜索是当前服务器中的LDAP DN，所以&lt;host&gt;部分应为空。&lt;attrs&gt;字段也被忽略，因为只有DN值得关注。这两个元素以URL的格式保留，以保持字符串中哪些信息的清晰度。</p>
<p>假设上述示例中的人实际上具有“adamson”的身份验证用户名，并且该信息保存在其LDAP条目的属性“uid”中。在<code>authz-regexp</code>指令可以写成</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authz-regexp</span><br><span class="line">  uid=([^,]*),cn=example.com,cn=gssapi,cn=auth</span><br><span class="line">  ldap:///ou=people,dc=example,dc=com??one?(uid=$1)</span><br></pre></td></tr></table></figure>

<p>这将启动对slapd服务器内的LDAP数据库的内部搜索。如果搜索只返回一个条目，则它被接受为用户的DN。如果返回多个条目，或者返回零条目，则认证失败，并将用户的连接作为认证请求DN绑定。</p>
<p>在URL中的搜索过滤器 <code>&lt;filter&gt;</code> 中使用的属性应该被编入索引，以便更快地搜索。如果不是，认证步骤单独可能会持续很长时间，用户可能会认为服务器关闭。</p>
<p>一个更复杂的站点可能有几个领域的使用，每个映射到目录中的不同的子树。这些可以用以下形式的语句处理：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Match Engineering realm</span><br><span class="line">authz-regexp</span><br><span class="line">   uid=([^,]*),cn=engineering.example.com,cn=digest-md5,cn=auth</span><br><span class="line">   ldap:///dc=eng,dc=example,dc=com??one?(&amp;(uid=$1)(objectClass=person))</span><br><span class="line"></span><br><span class="line"># Match Accounting realm</span><br><span class="line">authz-regexp</span><br><span class="line">   uid=([^,].*),cn=accounting.example.com,cn=digest-md5,cn=auth</span><br><span class="line">   ldap:///dc=accounting,dc=example,dc=com??one?(&amp;(uid=$1)(objectClass=person))</span><br><span class="line"></span><br><span class="line"># Default realm is customers.example.com</span><br><span class="line">authz-regexp</span><br><span class="line">   uid=([^,]*),cn=digest-md5,cn=auth</span><br><span class="line">   ldap:///dc=customers,dc=example,dc=com??one?(&amp;(uid=$1)(objectClass=person))</span><br></pre></td></tr></table></figure>

<p>请注意，首先处理明确命名的域，以避免域名成为UID的一部分。还要注意使用范围和过滤器来限制匹配到所需条目。</p>
<p>请注意，<code>authz-regexp</code>内部搜索需要访问控制。具体来说，认证身份必须具有<code>auth</code>访问权限。</p>
<p>有关更多详细信息，请参阅<em>slapd.conf</em>（5）。</p>
<h3 id="15-3-SASL代理授权"><a href="#15-3-SASL代理授权" class="headerlink" title="15.3 SASL代理授权"></a>15.3 SASL代理授权</h3><p>SASL提供了一种被称为<em>代理授权</em>的功能，允许经过身份验证的用户请求他们代表另一个用户行事。此步骤发生在用户获得认证DN之后，并涉及向服务器发送授权标识。然后，服务器将决定是否允许发生授权。如果允许，则将用户的LDAP连接切换为具有从授权标识导出的绑定DN，并且LDAP会话继续访问新的授权DN。</p>
<p>允许进行授权的决定取决于运行LDAP的站点的规则和策略，因此不能由SASL单独进行。SASL库可以让服务器做出决定。LDAP管理员通过向LDAP数据库条目中添加信息来设置谁可以授权哪些身份的准则。默认情况下，授权功能被禁用，使用前必须由LDAP管理员明确配置。</p>
<h4 id="15-3-1-代理授权的使用"><a href="#15-3-1-代理授权的使用" class="headerlink" title="15.3.1 代理授权的使用"></a>15.3.1 代理授权的使用</h4><p>当一个实体需要代表许多其他用户行事时，这种服务是有用的。例如，用户可能被引导到网页以在其LDAP条目中对其个人信息进行更改。用户向Web服务器进行身份验证以建立其身份，但是由于该用户对其进行更改，因此，Web服务器CGI无法向LDAP服务器进行身份验证。相反，Web服务器将其自身认证为LDAP服务器作为服务标识，比如说，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cn=WebUpdate,dc=example,dc=com</span><br></pre></td></tr></table></figure>

<p>然后将SASL授权给用户的DN。一旦这样授权，CGI会更改用户的LDAP条目，只要slapd服务器能够识别其ACL，则用户本身就在连接的另一端。用户可以直接连接到LDAP服务器，并自己认证，但这需要用户更多地了解LDAP客户端，网页提供的知识更容易。</p>
<p>还可以使用代理授权来限制对具有对数据库的更大访问权限的帐户的访问。这样的帐户，甚至是<em>slapd.conf</em>（5）中指定的根DN ，可以有一个严格的可以授权给该DN的人员列表。那么LDAP数据库的更改只能由该DN允许，并且为了成为该DN，用户必须首先认证为列表中的人员之一。这样可以更好地审核谁对LDAP数据库进行了更改。如果允许人们通过<code>rootpw</code><em>slapd.conf</em>（5）指令或通过<code>userPassword</code>属性直接向特权帐户进行身份验证，则审核变得更加困难。</p>
<p>请注意，在成功的代理授权之后，LDAP连接的原始身份验证DN将被授权请求中的新DN覆盖。如果服务程序能够自己认证为自己的认证DN，然后授权给其他DN，并且计划在一个LDAP会话期间切换到几个不同的身份，则每次在授权给另一个DN之前需要对其进行身份验证（或使用不同的代理授权机制）。slapd服务器不记录服务程序切换到其他DN的能力。在Kerberos这样的认证机制上，由于用户的TGT和“ldap”</p>
<h4 id="15-3-2-SASL授权身份"><a href="#15-3-2-SASL授权身份" class="headerlink" title="15.3.2 SASL授权身份"></a>15.3.2 SASL授权身份</h4><p>SASL授权身份通过<em>ldapsearch</em>（1）的<code>-X</code>开关和其他工具或在<em>lutil_sasl_defaults</em>（）调用的<code>* authzid</code>参数中发送到LDAP服务器。身份可以是两种形式之一</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u:&lt;username&gt;</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dn:&lt;dn&gt;</span><br></pre></td></tr></table></figure>

<p>在第一种形式中，<code>&lt;username&gt;</code> 来自与上述身份验证身份相同的命名空间。它是由底层身份验证机制引用的用户的用户名。该表单的授权身份通过与认证过程相同的功能转换成DN格式，生成表单的<em>授权请求DN</em></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=&lt;username&gt;,cn=&lt;realm&gt;,cn=&lt;mechanism&gt;,cn=auth</span><br></pre></td></tr></table></figure>

<p>然后，该授权请求DN通过相同的<code>authz-regexp</code>进程运行，以将其转换为数据库中的合法授权DN。如果由于LDAP URL中的搜索失败而无法转换，则授权请求将失败，并显示“不当访问”。否则，DN字符串现在是准备好批准的合法授权DN。</p>
<p>如果以第二种形式提供授权身份，则使用<code>“dn：”</code>前缀，前缀后面的字符串已经处于授权DN形式，准备进行批准。</p>
<h4 id="15-3-3-代理授权规则"><a href="#15-3-3-代理授权规则" class="headerlink" title="15.3.3 代理授权规则"></a>15.3.3 代理授权规则</h4><p>一旦slapd具有授权DN，则开始实际的批准过程。LDAP管理员可以将两个属性放入LDAP条目以允许授权：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">authzTo</span><br><span class="line">authzFrom</span><br></pre></td></tr></table></figure>

<p>两者都可以是多值的。该<code>authzTo</code>属性是源规则，将其置入与认证DN告诉DNS的认证DN被允许什么授权承担相关的条目。第二个属性是目标规则，它被放置到与请求的授权DN相关联的条目中，以告知哪些已验证的DN可以承担它。</p>
<p>选择要使用的授权策略属性取决于管理员。源代码规则首先在人员的身份验证DN条目中检查，并且如果<code>authzTo</code>规则中没有一个指定允许授权，则会检查授权DN条目中的<code>authzFrom</code>规则。如果两个案例都不指定请求被遵守，则该请求被拒绝。由于默认行为是拒绝授权请求，因此规则只指定允许请求; 没有消极的规则告诉什么授权拒绝。</p>
<p>两个属性中的值与<code>authz-regexp</code>伪指令的替换模式的输出形式相同：DN或LDAP URL。例如，如果<code>authzTo</code>值是DN，则该DN是经过身份验证的用户可以授权的DN。另一方面，如果<code>authzTo</code>值是LDAP URL，则该URL将用作LDAP数据库的内部搜索，并且已验证的用户可以成为搜索返回的任何DN。如果LDAP条目看起来像：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=WebUpdate,dc=example,dc=com</span><br><span class="line">authzTo: ldap:///dc=example,dc=com??sub?(objectclass=person)</span><br></pre></td></tr></table></figure>

<p>那么认证为<code>cn = WebUpdate，dc = example，dc = com的</code>任何用户可以授权给具有objectClass of<code>Person</code>的搜索库<code>dc = example，dc = com</code>下的任何其他LDAP条目。``</p>
<h5 id="15-3-3-1-代理授权规则说明"><a href="#15-3-3-1-代理授权规则说明" class="headerlink" title="15.3.3.1 代理授权规则说明"></a>15.3.3.1 代理授权规则说明</h5><p><code>authzTo</code>或<code>authzFrom</code>属性中的LDAP URL 将返回一组DN。每个返回的DN将被检查。返回一个大集合的搜索可能会导致授权过程变得不舒服很长时间。此外，应该对由slapd建立索引的属性执行搜索。</p>
<p>为了帮助为<code>authzFrom</code>和<code>authzTo</code>生成更多清晰的规则，这些属性的值可以是其中具有正则表达式字符的DN。这意味着一个源规则</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authzTo: dn.regex:^uid=[^,]*,dc=example,dc=com$</span><br></pre></td></tr></table></figure>

<p>将允许经过身份验证的用户授权给与给定的正则表达式模式匹配的任何DN。这种正则表达式比较可以比LDAP搜索<code>（uid = *）</code>快得多。</p>
<p>另请注意，授权规则中的值必须是以下两种形式之一：LDAP URL或DN（带或不带正则表达式字符）。任何不以“<code>ldap：//</code> ” 开头的内容都将被视为DN。不允许输入形式“<code>u：&lt;username&gt;</code> ”的另一个授权身份作为授权规则。</p>
<h5 id="15-3-3-2-策略配置"><a href="#15-3-3-2-策略配置" class="headerlink" title="15.3.3.2 策略配置"></a>15.3.3.2 策略配置</h5><p>决定使用哪种类型的规则，<code>authzFrom</code>或<code>authzTo</code>将取决于网站的情况。例如，如果可以成为给定身份的一组人可以容易地被写为搜索过滤器，则可以写入单个目的地规则。如果一组人不容易被搜索过滤器定义，而且一组人很小，可能会更好的是在每个被允许执行代理授权的人的条目中写入源规则。</p>
<p>默认情况下，禁用代理授权规则的处理。在<code>AuthZ的政策</code>指令必须在设定<em>的slapd.conf</em>（5）文件来启用授权。该指令可以设置为<code>无</code>对无规则（默认），<code>以</code>供源的规则，<code>从</code>为目的地的规则，或者<code>两者</code>的源和目标的规则。</p>
<p>源规则非常强大。如果普通用户有权在自己的条目中写入<code>authzTo</code>属性，那么他们可以编写允许他们作为其他人授权的规则。因此，当使用源规则时，<code>authzTo</code>属性应该使用只允许特权用户设置其值的ACL进行保护。</p>
<h2 id="20-监测"><a href="#20-监测" class="headerlink" title="20 监测"></a>20 监测</h2><p><em>slapd</em>（8）支持可选LDAP监视界面，您可以使用它来获取有关<em>slapd</em>实例当前状态的信息。例如，该界面允许您确定当前有多少客户端连接到服务器。监控信息由专门的后端（<em>监视器</em>后端）提供。手册页，<em>slapd-monitor</em>（5）可用。</p>
<p>启用监视界面后，LDAP客户端可能被用于访问由<em>监视器</em>后端提供的信息，受访问和其他控制。</p>
<p>启用后，<em>监视器</em>后端将动态生成并返回对象，以响应 <em>cn=monitor</em> 子树中的搜索请求。每个对象包含有关服务器特定方面的信息。<br>信息以用户应用程序和操作属性的组合方式进行。该信息可以使用<em>ldapsearch（1）</em>，任何通用LDAP浏览器或专门的监控工具进行访问。<br>“ <a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/monitoringslapd.html#Accessing%20Monitoring%20Information">访问监控信息”</a>部分提供了有关如何使用<em>ldapsearch</em>（1）访问监视信息的简要教程监控信息 监控信息基础及其组织部分细节。</p>
<p>虽然支持监视器后端包含在slapd（8）的默认版本中，但该支持需要一些配置才能激活。这可以使用<code>cn=config</code>或 <em>slapd.conf</em>（5）完成。<br>前者在中讨论过通过 cn=config 监视配置本章的一部分。后者<a href="hhttps://www.openldap.org/doc/admin24/monitoringslapd.html#Monitor%20configuration%20via%20slapd.conf(5)">通过</a>本章<br>的<a href="hhttps://www.openldap.org/doc/admin24/monitoringslapd.html#Monitor%20configuration%20via%20slapd.conf(5)">slapd.conf（5）</a>部分<br>在<a href="hhttps://www.openldap.org/doc/admin24/monitoringslapd.html#Monitor%20configuration%20via%20slapd.conf(5)">Monitor配置中</a>讨论。<br>这些部分假设监视器后端内置于<em>slapd中</em>（例如，<code>enable-monitor=yes</code> ，默认值）。如果监视器后端被构建为一个模块（例如，<code>enable-monitor=mod）</code>，<br>则该模块必须加载。在“ <a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/slapdconf2.html">配置slapd</a>和<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/slapdconfig.html">slapd配置文件”</a>章节中讨论了模块的加载。</p>
<h3 id="20-1-通过cn-config-5-监控配置"><a href="#20-1-通过cn-config-5-监控配置" class="headerlink" title="20.1 通过cn=config(5)监控配置"></a>20.1 通过cn=config(5)监控配置</h3><p><em>本节尚未写入。</em></p>
<h3 id="20-2-通过slapd-conf-5-监视配置"><a href="#20-2-通过slapd-conf-5-监视配置" class="headerlink" title="20.2 通过slapd.conf(5)监视配置"></a>20.2 通过slapd.conf(5)监视配置</h3><p>配置slapd.conf（5）来支持LDAP监控非常简单。</p>
<p>首先，确保您的<em>slapd.conf</em>（5）文件包含<em>core.schema</em>模式配置文件。该<em>显示器</em> 后端需要它。</p>
<p>其次，通过在现有数据库部分下方添加 数据库监视器指令来实例化监视器后端。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database monitor</span><br></pre></td></tr></table></figure>

<p>最后，根据需要添加其他全局或数据库指令。</p>
<p>像大多数其他数据库后端一样，监视器后端执行slapd（8）访问和其他管理控制。由于某些监视器信息可能很敏感，因此通常建议对 cn=monitor 进行访问，限于目录管理员及其监控代理。在<em>数据库监视器</em>指令下面添加<em>访问</em>指令是控制访问的一种清晰有效的方法。例如，在<em>数据库监视器</em>指令正下方添加以下<em>访问</em>指令将对监视信息的访问限制到指定的目录管理器。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access to *</span><br><span class="line">        by dn.exact=&quot;cn=Manager,dc=example,dc=com</span><br><span class="line">        by * none</span><br></pre></td></tr></table></figure>

<p>有关<em>slapd</em>（8）访问控制的更多信息，请参阅<a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/slapdconfig.html">“slapd配置文件”</a>一章<em>的访问控制指令</em>部分和<em>slapd.access</em>（5）。</p>
<p>重新启动<em>slapd</em>（8）后，您可以开始探索<code>cn=config</code>中提供的监视信息，如本章“ <a target="_blank" rel="noopener" href="https://www.openldap.org/doc/admin24/monitoringslapd.html#Accessing%20Monitoring%20Information">访问监控信息”</a>部分所述。</p>
<p>可以验证slapd（8）是否被正确地配置为通过尝试读取<code>cn=monitor</code>对象来提供监视信息。例如，如果以下<em>ldapsearch</em>（1）命令返回cn=monitor对象（根据请求，没有属性），它正在运行。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -D &#x27;cn=Manager,dc=example,dc=com&#x27; -W \</span><br><span class="line">        -b &#x27;cn=Monitor&#x27; -s base 1.1</span><br></pre></td></tr></table></figure>

<p>请注意，与通用数据库后端不同，数据库后缀是硬编码的。它总是<code>cn =监视器</code>。所以不应该提供<em>后缀</em>指令。另请注意，通用数据库后端，显示器后端无法多次实例化。也就是说，在服务器配置中只能有一个（或零）<code>数据库监视器</code>出现。</p>
<h3 id="20-3-访问监控信息"><a href="#20-3-访问监控信息" class="headerlink" title="20.3 访问监控信息"></a>20.3 访问监控信息</h3><p>如前所述，当启用时，<em>监视器</em>后端将动态生成并响应<em>cn =监视器</em>子树中的搜索请求返回对象。每个对象包含有关服务器特定方面的信息。信息以用户应用程序和操作属性的组合方式进行。可以使用<em>ldapsearch（1）</em>，任何通用LDAP浏览器或专门的监视工具访问此信息。</p>
<p>本节提供了一个关于如何使用<em>ldapsearch</em>（1）访问监视信息的简要教程。</p>
<p>要检查任何特定的监视器对象，可以使用一个baseObject范围和一个<code>（objectClass = *）</code>过滤器对对象执行搜索操作。由于监视信息包含在用户应用程序和操作属性的组合中，所以应该要求返回所有用户应用程序属性（例如<code>&#39;*&#39;</code>）和所有操作属性（例如<code>&#39;+&#39;</code>）。例如，要读取<code>cn = Monitor</code>对象本身，可以使用<em>ldapsearch</em>（1）命令（修改为适合您的配置）：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -D &#x27;cn=Manager,dc=example,dc=com&#x27; -W \</span><br><span class="line">        -b &#x27;cn=Monitor&#x27; -s base &#x27;(objectClass=*)&#x27; &#x27;*&#x27; &#x27;+&#x27;</span><br></pre></td></tr></table></figure>

<p>当您的服务器运行时，应该产生类似于以下的输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Monitor</span><br><span class="line">objectClass: monitorServer</span><br><span class="line">structuralObjectClass: monitorServer</span><br><span class="line">cn: Monitor</span><br><span class="line">creatorsName:</span><br><span class="line">modifiersName:</span><br><span class="line">createTimestamp: 20061208223558Z</span><br><span class="line">modifyTimestamp: 20061208223558Z</span><br><span class="line">description: This subtree contains monitoring/managing objects.</span><br><span class="line">description: This object contains information about this server.</span><br><span class="line">description: Most of the information is held in operational attributes, which</span><br><span class="line"> must be explicitly requested.</span><br><span class="line">monitoredInfo: OpenLDAP: slapd 2.4 (Dec  7 2006 17:30:29)</span><br><span class="line">entryDN: cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: TRUE</span><br></pre></td></tr></table></figure>

<p>为了减少返回的不感兴趣的属性数量，在请求哪些属性要返回时，可以更有选择性。例如，可以请求返回由<em>monitorServer</em>对象类（例如<code>@objectClass</code>）允许的所有属性，而不是所有用户和所有操作属性：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -D &#x27;cn=Manager,dc=example,dc=com&#x27; -W \</span><br><span class="line">        -b &#x27;cn=Monitor&#x27; -s base &#x27;(objectClass=*)&#x27; &#x27;@monitorServer&#x27;</span><br></pre></td></tr></table></figure>

<p>这将限制输出如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Monitor</span><br><span class="line">objectClass: monitorServer</span><br><span class="line">cn: Monitor</span><br><span class="line">description: This subtree contains monitoring/managing objects.</span><br><span class="line">description: This object contains information about this server.</span><br><span class="line">description: Most of the information is held in operational attributes, which</span><br><span class="line"> must be explicitly requested.</span><br><span class="line">monitoredInfo: OpenLDAP: slapd 2.X (Dec  7 2006 17:30:29)</span><br></pre></td></tr></table></figure>

<p>要返回所有监控对象的名称，可以使用子树范围和<code>（objectClass = *）</code>过滤器执行<code>cn = Monitor</code>的搜索，并且不要求返回任何属性（例如，<code>1.1</code>）。````</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -D &#x27;cn=Manager,dc=example,dc=com&#x27; -W -b &#x27;cn=Monitor&#x27; -s sub 1.1</span><br></pre></td></tr></table></figure>

<p>如果运行此命令，您会发现<em>cn = Monitor</em>子树中有很多对象。以下部分介绍了一些常用的监视对象。</p>
<h3 id="20-4-监控信息"><a href="#20-4-监控信息" class="headerlink" title="20.4 监控信息"></a>20.4 监控信息</h3><p>所述<em>监视器</em>后端提供了丰富的用于监控在设置中的显示屏的对象的slapd（8）的有用信息。每个对象包含有关服务器特定方面的信息，例如后端，连接或线程。一些对象用作其他对象的容器，用于构造对象的层次结构。</p>
<p>在这个层次结构中，最高级的对象是{cn = Monitor}。虽然此对象主要用作其他对象的容器，其中大多数是容器，但此对象提供有关此服务器的信息。特别是它提供了slapd（8）版本字符串。例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Monitor</span><br><span class="line">monitoredInfo: OpenLDAP: slapd 2.X (Dec  7 2006 17:30:29)</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>本节（及其子部分）中的示例已被修剪以仅显示关键信息。</p>
<h4 id="20-4-1-后端"><a href="#20-4-1-后端" class="headerlink" title="20.4.1 后端"></a>20.4.1 后端</h4><p>该<code>cn=Backends</code>，<code>cn=Monitor</code>对象，本身提供了可用后端的列表。所有内置后端的可用后端列表以及模块加载的后端。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Backends,cn=Monitor</span><br><span class="line">monitoredInfo: config</span><br><span class="line">monitoredInfo: ldif</span><br><span class="line">monitoredInfo: monitor</span><br><span class="line">monitoredInfo: bdb</span><br><span class="line">monitoredInfo: hdb</span><br></pre></td></tr></table></figure>

<p>这表示<em>config</em>，<em>ldif</em>，<em>monitor</em>，<em>bdb</em>和<em>hdb</em>后端可用。</p>
<p><code>cn=Backends</code>，<code>cn=Monitor</code>对象也是可用的后端对象的容器。每个可用的后端对象包含有关特定后端的信息。例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Backend 0,cn=Backends,cn=Monitor</span><br><span class="line">monitoredInfo: config</span><br><span class="line">monitorRuntimeConfig: TRUE</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.2</span><br><span class="line">seeAlso: cn=Database 0,cn=Databases,cn=Monitor</span><br><span class="line"></span><br><span class="line">dn: cn=Backend 1,cn=Backends,cn=Monitor</span><br><span class="line">monitoredInfo: ldif</span><br><span class="line">monitorRuntimeConfig: TRUE</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.2</span><br><span class="line"></span><br><span class="line">dn: cn=Backend 2,cn=Backends,cn=Monitor</span><br><span class="line">monitoredInfo: monitor</span><br><span class="line">monitorRuntimeConfig: TRUE</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.2</span><br><span class="line">seeAlso: cn=Database 2,cn=Databases,cn=Monitor</span><br><span class="line"></span><br><span class="line">dn: cn=Backend 3,cn=Backends,cn=Monitor</span><br><span class="line">monitoredInfo: bdb</span><br><span class="line">monitorRuntimeConfig: TRUE</span><br><span class="line">supportedControl: 1.3.6.1.1.12</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.2</span><br><span class="line">supportedControl: 1.3.6.1.4.1.4203.666.5.2</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.319</span><br><span class="line">supportedControl: 1.3.6.1.1.13.1</span><br><span class="line">supportedControl: 1.3.6.1.1.13.2</span><br><span class="line">supportedControl: 1.3.6.1.4.1.4203.1.10.1</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1413</span><br><span class="line">supportedControl: 1.3.6.1.4.1.4203.666.11.7.2</span><br><span class="line">seeAlso: cn=Database 1,cn=Databases,cn=Monitor</span><br><span class="line"></span><br><span class="line">dn: cn=Backend 4,cn=Backends,cn=Monitor</span><br><span class="line">monitoredInfo: hdb</span><br><span class="line">monitorRuntimeConfig: TRUE</span><br><span class="line">supportedControl: 1.3.6.1.1.12</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.2</span><br><span class="line">supportedControl: 1.3.6.1.4.1.4203.666.5.2</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.319</span><br><span class="line">supportedControl: 1.3.6.1.1.13.1</span><br><span class="line">supportedControl: 1.3.6.1.1.13.2</span><br><span class="line">supportedControl: 1.3.6.1.4.1.4203.1.10.1</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1413</span><br><span class="line">supportedControl: 1.3.6.1.4.1.4203.666.11.7.2</span><br></pre></td></tr></table></figure>

<p>对于每个这些对象，monitorInfo指示对象中的哪个后端信息是关于的。例如，<code>cn=Backend 3</code>，<code>cn=Backends</code>，<code>cn=Monitor</code>对象包含（在示例中）有关<em>bdb</em>后端的信息。</p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>monitoredInfo</td>
<td>后端名称</td>
</tr>
<tr>
<td>supportedControl</td>
<td>支持LDAP控制扩展</td>
</tr>
<tr>
<td>seeAlso</td>
<td>这个后端实例的数据库对象</td>
</tr>
</tbody></table>
<h4 id="20-4-2-Connections"><a href="#20-4-2-Connections" class="headerlink" title="20.4.2 Connections"></a>20.4.2 Connections</h4><p>主条目为空; 它应该包含一些关于连接数的统计信息。</p>
<p>为每个打开的连接创建动态子条目，并对该连接上的活动进行统计（稍后将对其进行详细说明）。有两个特殊的子条目分别显示总数和当前连接的数量。</p>
<p>例如：</p>
<p>总连接数：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Total,cn=Connections,cn=Monitor</span><br><span class="line">structuralObjectClass: monitorCounterObject</span><br><span class="line">monitorCounter: 4</span><br><span class="line">entryDN: cn=Total,cn=Connections,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<p>当前连接：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Current,cn=Connections,cn=Monitor</span><br><span class="line">structuralObjectClass: monitorCounterObject</span><br><span class="line">monitorCounter: 2</span><br><span class="line">entryDN: cn=Current,cn=Connections,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<h4 id="20-4-3-Databases"><a href="#20-4-3-Databases" class="headerlink" title="20.4.3 Databases"></a>20.4.3 Databases</h4><p>主条目包含每个配置的数据库的命名上下文; 对于每个数据库，子条目包含类型和命名上下文。</p>
<p>例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Database 2,cn=Databases,cn=Monitor</span><br><span class="line">structuralObjectClass: monitoredObject</span><br><span class="line">monitoredInfo: monitor</span><br><span class="line">monitorIsShadow: FALSE</span><br><span class="line">monitorContext: cn=Monitor</span><br><span class="line">readOnly: FALSE</span><br><span class="line">entryDN: cn=Database 2,cn=Databases,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<h4 id="20-4-4-Listener"><a href="#20-4-4-Listener" class="headerlink" title="20.4.4 Listener"></a>20.4.4 Listener</h4><p>它包含服务器当前正在侦听的设备的描述：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Listener 0,cn=Listeners,cn=Monitor</span><br><span class="line">structuralObjectClass: monitoredObject</span><br><span class="line">monitorConnectionLocalAddress: IP=0.0.0.0:389</span><br><span class="line">entryDN: cn=Listener 0,cn=Listeners,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<h4 id="20-4-5-Log"><a href="#20-4-5-Log" class="headerlink" title="20.4.5 Log"></a>20.4.5 Log</h4><p>它包含当前活动的日志项目。该<em>日志</em>子系统允许用户修改的操作<em>描述</em>属性，其值<em>必须</em>在admittable日志切换列表：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Trace</span><br><span class="line">Packets</span><br><span class="line">Args</span><br><span class="line">Conns</span><br><span class="line">BER</span><br><span class="line">Filter</span><br><span class="line">Config</span><br><span class="line">ACL</span><br><span class="line">Stats</span><br><span class="line">Stats2</span><br><span class="line">Shell</span><br><span class="line">Parse</span><br><span class="line">Sync</span><br></pre></td></tr></table></figure>

<p>这些值可以添加，替换或删除; 它们会影响发送到syslog设备的消息。可以通过自定义模块添加自定义值。</p>
<h4 id="20-4-6-Operations"><a href="#20-4-6-Operations" class="headerlink" title="20.4.6 Operations"></a>20.4.6 Operations</h4><p>它显示了服务器执行的操作的一些统计信息：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Initiated</span><br><span class="line">Completed</span><br></pre></td></tr></table></figure>

<p>对于每个操作类型，即：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Bind</span><br><span class="line">Unbind</span><br><span class="line">Add</span><br><span class="line">Delete</span><br><span class="line">Modrdn</span><br><span class="line">Modify</span><br><span class="line">Compare</span><br><span class="line">Search</span><br><span class="line">Abandon</span><br><span class="line">Extended</span><br></pre></td></tr></table></figure>

<p>有太多的类型列出这里的例子，所以请尝试为自己使用 监控搜索示例</p>
<h4 id="20-4-7-Overlays"><a href="#20-4-7-Overlays" class="headerlink" title="20.4.7 Overlays"></a>20.4.7 Overlays</h4><p>主条目包含运行时可用的覆盖类型; 每个叠加层的子条目包含叠加层的类型。</p>
<p>如果启用动态覆盖，它也应该包含已加载的模块：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Overlays, Monitor</span><br><span class="line">dn: cn=Overlays,cn=Monitor</span><br><span class="line">structuralObjectClass: monitorContainer</span><br><span class="line">monitoredInfo: syncprov</span><br><span class="line">monitoredInfo: accesslog</span><br><span class="line">monitoredInfo: glue</span><br><span class="line">entryDN: cn=Overlays,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: TRUE</span><br></pre></td></tr></table></figure>

<h4 id="20-4-8-SASL"><a href="#20-4-8-SASL" class="headerlink" title="20.4.8 SASL"></a>20.4.8 SASL</h4><p>目前空</p>
<h4 id="20-4-9-Statistics"><a href="#20-4-9-Statistics" class="headerlink" title="20.4.9 Statistics"></a>20.4.9 Statistics</h4><p>它显示了服务器发送的数据的一些统计信息：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bytes</span><br><span class="line">PDU</span><br><span class="line">Entries</span><br><span class="line">Referrals</span><br></pre></td></tr></table></figure>

<p>例如</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Entries, Statistics, Monitor</span><br><span class="line">dn: cn=Entries,cn=Statistics,cn=Monitor</span><br><span class="line">structuralObjectClass: monitorCounterObject</span><br><span class="line">monitorCounter: 612248</span><br><span class="line">entryDN: cn=Entries,cn=Statistics,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<h4 id="20-4-10-Threads"><a href="#20-4-10-Threads" class="headerlink" title="20.4.10 Threads"></a>20.4.10 Threads</h4><p>它包含启动时启用的最大线程数和当前的后备负载。</p>
<p>例如</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Max, Threads, Monitor</span><br><span class="line">dn: cn=Max,cn=Threads,cn=Monitor</span><br><span class="line">structuralObjectClass: monitoredObject</span><br><span class="line">monitoredInfo: 16</span><br><span class="line">entryDN: cn=Max,cn=Threads,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<h4 id="20-4-11-Time"><a href="#20-4-11-Time" class="headerlink" title="20.4.11 Time"></a>20.4.11 Time</h4><p>它包含两个子条目，其中包含服务器的开始时间和当前时间。</p>
<p>例如</p>
<p>开始时间：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Start,cn=Time,cn=Monitor</span><br><span class="line">structuralObjectClass: monitoredObject</span><br><span class="line">monitorTimestamp: 20061205124040Z</span><br><span class="line">entryDN: cn=Start,cn=Time,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<p>当前时间：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Current,cn=Time,cn=Monitor</span><br><span class="line">structuralObjectClass: monitoredObject</span><br><span class="line">monitorTimestamp: 20061207120624Z</span><br><span class="line">entryDN: cn=Current,cn=Time,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<h4 id="20-4-12-TLS"><a href="#20-4-12-TLS" class="headerlink" title="20.4.12 TLS"></a>20.4.12 TLS</h4><p>目前空</p>
<h3 id="20-4-13-Waiters"><a href="#20-4-13-Waiters" class="headerlink" title="20.4.13 Waiters"></a>20.4.13 Waiters</h3><p>它包含当前读取服务器的数量。</p>
<p>例如</p>
<p>读服务员：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Read,cn=Waiters,cn=Monitor</span><br><span class="line">structuralObjectClass: monitorCounterObject</span><br><span class="line">monitorCounter: 7</span><br><span class="line">entryDN: cn=Read,cn=Waiters,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<p>写服务员：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=Write,cn=Waiters,cn=Monitor</span><br><span class="line">structuralObjectClass: monitorCounterObject</span><br><span class="line">monitorCounter: 0</span><br><span class="line">entryDN: cn=Write,cn=Waiters,cn=Monitor</span><br><span class="line">subschemaSubentry: cn=Subschema</span><br><span class="line">hasSubordinates: FALSE</span><br></pre></td></tr></table></figure>

<p>在这里添加新的监控事项，并讨论，引用手册页和示例</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/openldap/" rel="tag"># openldap</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/02/14/operations/LVM%20%E4%BD%BF%E7%94%A8/" rel="prev" title="LVM 使用">
                  <i class="fa fa-chevron-left"></i> LVM 使用
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/11/20/documents/mit_kerberos_documentation/" rel="next" title="MIT Kerberos Documentation (1.15.2)">
                  MIT Kerberos Documentation (1.15.2) <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">huagang</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
